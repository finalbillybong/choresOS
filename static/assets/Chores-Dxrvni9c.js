import{c as G,u as ce,a as de,r,b as m,j as s,S as q}from"./index-DbTTv7ag.js";import{M as I}from"./Modal-Bj2NyloF.js";import{P as U}from"./plus-CMcvfJKm.js";import{P as me}from"./pencil-BQTOu3Lq.js";import{T as ue}from"./trash-2-CFkNW02I.js";import{C as K}from"./camera-Dj7jgd-a.js";import{S as xe}from"./star-Dh13X_k5.js";import{R as ge}from"./refresh-cw-Bfk4-XSH.js";import"./index-B4Vs-Szk.js";import"./proxy-B1EfiGkW.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=G("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=G("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Y=[{value:"easy",label:"Easy",level:1},{value:"medium",label:"Medium",level:2},{value:"hard",label:"Hard",level:3},{value:"expert",label:"Expert",level:4}],fe={easy:1,medium:2,hard:3,expert:4},be=[{value:"once",label:"One-time"},{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"custom",label:"Custom Days"}],H=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],X={cleaning:"bg-sky/20 text-sky border-sky/40",cooking:"bg-gold/20 text-gold border-gold/40",outdoor:"bg-emerald/20 text-emerald border-emerald/40",homework:"bg-purple/20 text-purple border-purple/40",pet_care:"bg-crimson/20 text-crimson border-crimson/40",laundry:"bg-sky/20 text-sky border-sky/40",errands:"bg-gold/20 text-gold border-gold/40",default:"bg-cream/10 text-cream/70 border-cream/20"},y="w-full bg-navy-light border-2 border-[#2a2a4a] text-cream p-3 rounded font-body text-lg placeholder:text-cream/30 focus:border-gold focus:outline-none transition-colors",g="bg-navy-light border-2 border-[#2a2a4a] text-cream p-2 rounded font-body text-lg focus:border-gold focus:outline-none transition-colors";function ye({level:l}){const n=typeof l=="string"?fe[l]||1:l||1;return s.jsx("div",{className:"flex items-center gap-0.5",children:[1,2,3,4].map(i=>s.jsx(xe,{size:14,className:i<=n?"text-gold fill-gold":"text-cream/20"},i))})}function je({category:l}){const n=typeof l=="object"?l==null?void 0:l.name:l,i=X[n==null?void 0:n.toLowerCase()]||X.default;return s.jsx("span",{className:`inline-block px-2 py-0.5 rounded-full text-sm border ${i} capitalize`,children:n||"General"})}function ve({recurrence:l,customDays:n}){return!l||l==="once"?null:s.jsxs("div",{className:"flex items-center gap-1 text-cream/50 text-sm",children:[s.jsx(ge,{size:12}),s.jsx("span",{className:"capitalize",children:l}),l==="custom"&&(n==null?void 0:n.length)>0&&s.jsxs("span",{className:"text-cream/40",children:["(",n.map(i=>H[i]||i).join(", "),")"]})]})}const B={title:"",description:"",points:10,difficulty:"easy",category_id:"",recurrence:"once",custom_days:[],requires_photo:!1,assigned_user_ids:[]};function Ae(){const{user:l}=ce(),n=de(),i=(l==null?void 0:l.role)==="parent"||(l==null?void 0:l.role)==="admin",[j,W]=r.useState([]),[E,V]=r.useState([]),[P,T]=r.useState([]),[J,Z]=r.useState(!0),[A,v]=r.useState(""),[N,ee]=r.useState(""),[C,se]=r.useState(""),[p,te]=r.useState(""),[ae,_]=r.useState(!1),[h,w]=r.useState(null),[t,x]=r.useState({...B}),[D,c]=r.useState(""),[F,k]=r.useState(!1),[u,f]=r.useState(null),[z,L]=r.useState(!1),b=r.useCallback(async()=>{try{v("");const e=await m("/api/chores");W(Array.isArray(e)?e:e.chores||e.items||[])}catch(e){v(e.message||"Failed to load quests from the guild board.")}},[]),R=r.useCallback(async()=>{try{const e=await m("/api/chores/categories");V(Array.isArray(e)?e:e.categories||[])}catch{}},[]),Q=r.useCallback(async()=>{if(i)try{const e=await m("/api/stats/family");T(Array.isArray(e)?e:[])}catch{try{const e=await m("/api/admin/users"),a=Array.isArray(e)?e:e.users||[];T(a.filter(o=>o.role==="kid"))}catch{}}},[i]);r.useEffect(()=>{Promise.all([b(),R(),Q()]).finally(()=>Z(!1))},[b,R,Q]);const M=j.filter(e=>{var a,o,O;return!(N&&((a=e.category)==null?void 0:a.name)!==N||C&&e.difficulty!==C||p&&!((o=e.title)!=null&&o.toLowerCase().includes(p.toLowerCase()))&&!((O=e.description)!=null&&O.toLowerCase().includes(p.toLowerCase())))}),$=()=>{w(null),x({...B}),c(""),_(!0)},le=e=>{w(e),x({title:e.title||"",description:e.description||"",points:e.points||10,difficulty:e.difficulty||"easy",category_id:e.category_id||"",recurrence:e.recurrence||"once",custom_days:e.custom_days||[],requires_photo:e.requires_photo||!1,assigned_user_ids:e.assigned_user_ids||e.assigned_kids||e.assigned_to||[]}),c(""),_(!0)},S=()=>{_(!1),w(null),c("")},d=(e,a)=>{x(o=>({...o,[e]:a}))},re=e=>{x(a=>({...a,custom_days:a.custom_days.includes(e)?a.custom_days.filter(o=>o!==e):[...a.custom_days,e]}))},ie=e=>{x(a=>({...a,assigned_user_ids:a.assigned_user_ids.includes(e)?a.assigned_user_ids.filter(o=>o!==e):[...a.assigned_user_ids,e]}))},ne=async()=>{if(!t.title.trim()){c("Every quest needs a name, adventurer!");return}if(t.points<1){c("The reward must be at least 1 XP.");return}k(!0),c("");const e={title:t.title.trim(),description:t.description.trim()||null,points:Number(t.points),difficulty:t.difficulty,category_id:t.category_id?Number(t.category_id):void 0,recurrence:t.recurrence,requires_photo:t.requires_photo,assigned_user_ids:t.assigned_user_ids.length>0?t.assigned_user_ids:[]};if(!e.category_id){c("Please select a category for this quest."),k(!1);return}t.recurrence==="custom"&&(e.custom_days=t.custom_days);try{h?await m(`/api/chores/${h.id}`,{method:"PUT",body:e}):await m("/api/chores",{method:"POST",body:e}),S(),await b()}catch(a){c(a.message||"The quest scroll could not be saved.")}finally{k(!1)}},oe=async()=>{if(u){L(!0);try{await m(`/api/chores/${u.id}`,{method:"DELETE"}),f(null),await b()}catch(e){v(e.message||"Failed to remove the quest.")}finally{L(!1)}}};return J?s.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[s.jsx(q,{size:48,className:"text-gold animate-pulse"}),s.jsx("p",{className:"text-gold font-heading text-xs animate-pulse",children:"Loading quests from the guild board..."})]}):s.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(q,{size:28,className:"text-gold"}),s.jsx("h1",{className:"font-heading text-gold text-sm sm:text-base leading-relaxed",children:i?"Quest Management":"My Quests"})]}),i&&s.jsxs("button",{onClick:$,className:"game-btn game-btn-gold flex items-center gap-2",children:[s.jsx(U,{size:16}),"Create Quest"]})]}),A&&s.jsx("div",{className:"p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-base text-center",children:A}),s.jsx("div",{className:"game-panel p-4",children:s.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[s.jsxs("div",{className:"flex items-center gap-2 text-cream/50",children:[s.jsx(pe,{size:16}),s.jsx("span",{className:"font-body text-base",children:"Filters:"})]}),s.jsxs("div",{className:"relative flex-1 min-w-0",children:[s.jsx(he,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-cream/30"}),s.jsx("input",{type:"text",placeholder:"Search quests...",value:p,onChange:e=>te(e.target.value),className:`${y} pl-9 py-2`})]}),s.jsxs("select",{value:N,onChange:e=>ee(e.target.value),className:g,children:[s.jsx("option",{value:"",children:"All Categories"}),E.map(e=>s.jsx("option",{value:e.name,children:e.name},e.id))]}),s.jsxs("select",{value:C,onChange:e=>se(e.target.value),className:g,children:[s.jsx("option",{value:"",children:"All Difficulties"}),Y.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]})]})}),M.length===0?s.jsxs("div",{className:"game-panel p-10 text-center",children:[s.jsx(q,{size:40,className:"mx-auto text-cream/20 mb-4"}),s.jsx("p",{className:"text-cream/50 text-xl font-body",children:j.length===0?"The quest board is empty. No adventures await... yet!":"No quests match your search. Try adjusting the filters."}),i&&j.length===0&&s.jsxs("button",{onClick:$,className:"game-btn game-btn-gold mt-4 inline-flex items-center gap-2",children:[s.jsx(U,{size:16}),"Post First Quest"]})]}):s.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:M.map(e=>s.jsxs("div",{className:"game-panel p-4 flex flex-col gap-3 cursor-pointer hover:border-gold/40 transition-colors",onClick:()=>n(`/chores/${e.id}`),children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsx("h3",{className:"font-heading text-cream text-[10px] leading-relaxed flex-1",children:e.title}),i&&s.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[s.jsx("button",{onClick:a=>{a.stopPropagation(),le(e)},className:"p-1.5 rounded hover:bg-[#2a2a4a] transition-colors text-cream/40 hover:text-sky","aria-label":"Edit quest",children:s.jsx(me,{size:14})}),s.jsx("button",{onClick:a=>{a.stopPropagation(),f(e)},className:"p-1.5 rounded hover:bg-[#2a2a4a] transition-colors text-cream/40 hover:text-crimson","aria-label":"Delete quest",children:s.jsx(ue,{size:14})})]})]}),e.description&&s.jsx("p",{className:"text-cream/60 text-base font-body line-clamp-2",children:e.description}),s.jsxs("div",{className:"flex items-center flex-wrap gap-2 mt-auto",children:[s.jsxs("span",{className:"flex items-center gap-1 text-gold font-heading text-[10px]",children:[s.jsx("span",{className:"text-lg",children:"â˜…"}),e.points," XP"]}),s.jsx(ye,{level:e.difficulty||1})]}),s.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[s.jsx(je,{category:e.category}),s.jsx(ve,{recurrence:e.recurrence,customDays:e.custom_days}),e.requires_photo&&s.jsxs("span",{className:"flex items-center gap-1 text-cream/40 text-sm",children:[s.jsx(K,{size:12}),"Photo"]})]})]},e.id))}),s.jsx(I,{isOpen:ae,onClose:S,title:h?"Edit Quest Scroll":"New Quest Scroll",actions:[{label:"Cancel",onClick:S,className:"game-btn game-btn-blue"},{label:F?"Saving...":h?"Update Quest":"Create Quest",onClick:ne,className:"game-btn game-btn-gold",disabled:F}],children:s.jsxs("div",{className:"space-y-4",children:[D&&s.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-base",children:D}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-1 tracking-wide",children:"Quest Name"}),s.jsx("input",{type:"text",value:t.title,onChange:e=>d("title",e.target.value),placeholder:"Defeat the Dust Bunnies",className:y})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-1 tracking-wide",children:"Description"}),s.jsx("textarea",{value:t.description,onChange:e=>d("description",e.target.value),placeholder:"Describe the quest details...",rows:3,className:`${y} resize-none`})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-1 tracking-wide",children:"XP Reward"}),s.jsx("input",{type:"number",min:1,value:t.points,onChange:e=>d("points",e.target.value),className:y})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-1 tracking-wide",children:"Difficulty"}),s.jsx("select",{value:t.difficulty,onChange:e=>d("difficulty",e.target.value),className:`${g} w-full p-3`,children:Y.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-1 tracking-wide",children:"Category"}),s.jsxs("select",{value:t.category_id,onChange:e=>d("category_id",e.target.value),className:`${g} w-full p-3`,children:[s.jsx("option",{value:"",children:"Select category..."}),E.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-1 tracking-wide",children:"Recurrence"}),s.jsx("select",{value:t.recurrence,onChange:e=>d("recurrence",e.target.value),className:`${g} w-full p-3`,children:be.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.recurrence==="custom"&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-2 tracking-wide",children:"Quest Days"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:H.map((e,a)=>s.jsx("button",{type:"button",onClick:()=>re(a),className:`px-3 py-1.5 rounded border-2 font-body text-base transition-colors ${t.custom_days.includes(a)?"border-gold bg-gold/20 text-gold":"border-[#2a2a4a] text-cream/40 hover:border-cream/30"}`,children:e},e))})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("label",{className:"text-gold/80 text-sm font-heading tracking-wide flex items-center gap-2",children:[s.jsx(K,{size:14}),"Requires Photo Proof"]}),s.jsx("button",{type:"button",onClick:()=>d("requires_photo",!t.requires_photo),className:`relative w-12 h-6 rounded-full border-2 transition-colors ${t.requires_photo?"bg-gold/20 border-gold":"bg-navy-light border-[#2a2a4a]"}`,children:s.jsx("div",{className:`absolute top-0.5 w-4 h-4 rounded-full transition-all ${t.requires_photo?"left-6 bg-gold":"left-0.5 bg-cream/40"}`})})]}),P.length>0&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-2 tracking-wide",children:"Assign to Heroes"}),s.jsx("div",{className:"space-y-2",children:P.map(e=>s.jsxs("label",{className:"flex items-center gap-3 cursor-pointer p-2 rounded hover:bg-[#2a2a4a]/50 transition-colors",children:[s.jsx("input",{type:"checkbox",checked:t.assigned_user_ids.includes(e.id),onChange:()=>ie(e.id),className:"w-4 h-4 accent-gold"}),s.jsx("span",{className:"text-cream font-body text-lg",children:e.display_name||e.username})]},e.id))})]})]})}),s.jsx(I,{isOpen:!!u,onClose:()=>f(null),title:"Abandon Quest?",actions:[{label:"Keep Quest",onClick:()=>f(null),className:"game-btn game-btn-blue"},{label:z?"Removing...":"Remove Quest",onClick:oe,className:"game-btn game-btn-red",disabled:z}],children:s.jsxs("p",{className:"text-cream/70",children:["Are you sure you want to remove the quest"," ",s.jsxs("span",{className:"text-gold font-heading text-[10px]",children:['"',u==null?void 0:u.title,'"']}),"? This action cannot be undone. All associated records will be archived."]})})]})}export{Ae as default};
