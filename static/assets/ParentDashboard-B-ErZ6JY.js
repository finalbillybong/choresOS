import{u as Y,a as Z,r as i,b as c,j as e,A as ee}from"./index-CRKPRXQ3.js";import{M as se}from"./Modal-DXxDxgzi.js";import{L as u}from"./loader-circle-C0n6L0S0.js";import{U as te}from"./users-BeOPo_Ip.js";import{T as ae}from"./triangle-alert-C2D6ueye.js";import{m as g}from"./proxy-DAeV9c_I.js";import{S as ie}from"./star-COuSHzAw.js";import{F as ne}from"./flame-B2RnXyBV.js";import{C as re}from"./camera-9YqBEvF5.js";import{C as F}from"./circle-check-1K7eXh_Y.js";import{C as O}from"./circle-x-B-51tZTw.js";import{P as le}from"./plus-Cn1GtUwy.js";import{S as ce}from"./sparkles-CsRYr7ET.js";import"./index-C7kt0K0A.js";const oe={hidden:{opacity:0,y:12},visible:v=>({opacity:1,y:0,transition:{delay:v*.06,type:"spring",stiffness:300,damping:28}})},me={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.25}}};function Ce(){const{user:v}=Y(),X=Z(),[h,D]=i.useState([]),[N,K]=i.useState([]),[w,L]=i.useState([]),[T,V]=i.useState(!0),[S,p]=i.useState(null),[f,M]=i.useState({}),[q,j]=i.useState(!1),[y,C]=i.useState(""),[P,_]=i.useState(""),[b,A]=i.useState(""),[z,$]=i.useState(!1),[k,x]=i.useState(""),n=i.useCallback(async()=>{try{p(null);const[s,t,a]=await Promise.all([c("/api/stats/family"),c("/api/rewards/redemptions?status=pending"),c("/api/calendar")]);D(s),K(t);const l=new Date().toISOString().slice(0,10),m=(a.days&&a.days[l]||[]).filter(d=>d.status==="completed");L(m)}catch(s){p(s.message||"Failed to load family data")}finally{V(!1)}},[]);i.useEffect(()=>{n()},[n]),i.useEffect(()=>{const s=()=>{n()};return window.addEventListener("ws:message",s),()=>window.removeEventListener("ws:message",s)},[n]);const r=(s,t)=>{M(a=>({...a,[s]:t}))},U=async s=>{const t=`verify-${s}`;r(t,!0);try{await c(`/api/chores/${s}/verify`,{method:"POST"}),await n()}catch(a){p(a.message||"Failed to verify chore")}finally{r(t,!1)}},G=async s=>{const t=`reject-${s}`;r(t,!0);try{await c(`/api/chores/${s}/uncomplete`,{method:"POST"}),await n()}catch(a){p(a.message||"Failed to reject chore")}finally{r(t,!1)}},I=async s=>{const t=`approve-${s}`;r(t,!0);try{await c(`/api/rewards/redemptions/${s}/approve`,{method:"POST"}),await n()}catch(a){p(a.message||"Failed to approve redemption")}finally{r(t,!1)}},Q=async s=>{const t=`deny-${s}`;r(t,!0);try{await c(`/api/rewards/redemptions/${s}/deny`,{method:"POST"}),await n()}catch(a){p(a.message||"Failed to deny redemption")}finally{r(t,!1)}},H=async()=>{if(x(""),!y){x("Select a kid");return}const s=parseInt(P,10);if(!s||s<=0){x("Enter a positive XP amount");return}if(!b.trim()){x("Enter a description");return}$(!0);try{await c(`/api/points/${y}/bonus`,{method:"POST",body:{amount:s,description:b.trim()}}),C(""),_(""),A(""),j(!1),await n()}catch(t){x(t.message||"Failed to award bonus XP")}finally{$(!1)}};function J({completed:s,total:t}){const a=t>0?Math.round(s/t*100):0;return e.jsx("div",{className:"xp-bar",children:e.jsx(g.div,{className:"xp-bar-fill",initial:{width:0},animate:{width:`${a}%`},transition:{duration:.6,ease:[.22,1,.36,1]}})})}if(T)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(u,{className:"animate-spin text-sky",size:28})});const W=N.length>0||w.length>0;return e.jsxs("div",{className:"max-w-3xl mx-auto space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h1",{className:"font-heading text-cream text-xl font-extrabold",children:"Family Overview"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-muted text-sm",children:[e.jsx(te,{size:16}),e.jsxs("span",{children:[h.length," members"]})]})]}),S&&e.jsxs("div",{className:"game-panel p-3 flex items-center gap-2 border-crimson/30 text-crimson text-sm",children:[e.jsx(ae,{size:16}),e.jsx("span",{children:S})]}),h.length===0?e.jsx("div",{className:"game-panel p-10 text-center",children:e.jsx("p",{className:"text-muted text-sm",children:"No kids in your family yet."})}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:h.map((s,t)=>e.jsxs(g.div,{className:"game-panel p-4",variants:oe,initial:"hidden",animate:"visible",custom:t,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ee,{config:s.avatar_config,size:"md",name:s.display_name}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-cream text-sm font-semibold truncate",children:s.display_name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-gold text-xs font-semibold",children:[e.jsx(ie,{size:12,fill:"currentColor"}),s.points_balance.toLocaleString()," XP"]}),s.current_streak>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-orange-400 text-xs font-semibold",children:[e.jsx(ne,{size:12,fill:"currentColor"}),s.current_streak]})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-muted",children:"Today"}),e.jsxs("span",{className:"text-cream font-medium",children:[s.today_completed,"/",s.today_total," quests"]})]}),e.jsx(J,{completed:s.today_completed,total:s.today_total})]})]},s.id))}),W&&e.jsxs(g.section,{variants:me,initial:"hidden",animate:"visible",children:[e.jsx("h2",{className:"text-cream text-base font-bold mb-3",children:"Pending Approvals"}),e.jsxs("div",{className:"space-y-3",children:[w.map(s=>{var d,R,B,E;const t=`verify-${s.chore_id}`,a=`reject-${s.chore_id}`,l=f[t],o=f[a],m=l||o;return e.jsxs("div",{className:"game-panel p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-cream text-sm font-medium truncate",children:((d=s.chore)==null?void 0:d.title)||"Chore"}),e.jsxs("p",{className:"text-muted text-xs mt-0.5",children:["by ",((R=s.user)==null?void 0:R.display_name)||"Kid",((B=s.chore)==null?void 0:B.requires_photo)&&e.jsxs("span",{className:"inline-flex items-center gap-1 ml-2 text-sky",children:[e.jsx(re,{size:10})," Photo"]}),e.jsxs("span",{className:"ml-2 text-gold font-medium",children:["+",(E=s.chore)==null?void 0:E.points," XP"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{className:"game-btn game-btn-blue !px-3 !py-2",disabled:m,onClick:()=>U(s.chore_id),title:"Approve",children:l?e.jsx(u,{size:14,className:"animate-spin"}):e.jsx(F,{size:16})}),e.jsx("button",{className:"game-btn game-btn-red !px-3 !py-2",disabled:m,onClick:()=>G(s.chore_id),title:"Reject",children:o?e.jsx(u,{size:14,className:"animate-spin"}):e.jsx(O,{size:16})})]})]}),s.photo_proof_path&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:`/api/uploads/${s.photo_proof_path}`,alt:"Photo proof",className:"rounded-lg max-h-48 object-cover border border-border"})})]},`chore-${s.id}`)}),N.map(s=>{var m,d;const t=`approve-${s.id}`,a=`deny-${s.id}`,l=f[t],o=f[a];return e.jsxs("div",{className:"game-panel p-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-cream text-sm font-medium truncate",children:((m=s.reward)==null?void 0:m.title)||"Reward"}),e.jsxs("p",{className:"text-muted text-xs mt-0.5",children:["by ",((d=s.user)==null?void 0:d.display_name)||"Kid"," Â·"," ",s.points_spent," XP"]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{className:"game-btn game-btn-blue !px-3 !py-2",disabled:l||o,onClick:()=>I(s.id),title:"Approve",children:l?e.jsx(u,{size:14,className:"animate-spin"}):e.jsx(F,{size:16})}),e.jsx("button",{className:"game-btn game-btn-red !px-3 !py-2",disabled:l||o,onClick:()=>Q(s.id),title:"Deny",children:o?e.jsx(u,{size:14,className:"animate-spin"}):e.jsx(O,{size:16})})]})]},`redemption-${s.id}`)})]})]}),e.jsxs("section",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsxs("button",{className:"game-btn game-btn-blue flex items-center gap-2 justify-center flex-1",onClick:()=>X("/chores"),children:[e.jsx(le,{size:16}),"Create Quest"]}),e.jsxs("button",{className:"game-btn game-btn-purple flex items-center gap-2 justify-center flex-1",onClick:()=>{x(""),j(!0)},children:[e.jsx(ce,{size:16}),"Award Bonus XP"]})]}),e.jsx(se,{isOpen:q,onClose:()=>j(!1),title:"Award Bonus XP",actions:[{label:"Cancel",onClick:()=>j(!1),className:"game-btn game-btn-red"},{label:z?"Awarding...":"Award XP",onClick:H,disabled:z,className:"game-btn game-btn-gold"}],children:e.jsxs("div",{className:"space-y-4",children:[k&&e.jsx("div",{className:"p-2 rounded-lg border border-crimson/30 bg-crimson/10 text-crimson text-sm text-center",children:k}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream/80 text-sm font-medium mb-1.5",children:"Select Kid"}),e.jsxs("select",{value:y,onChange:s=>C(s.target.value),className:"field-input",children:[e.jsx("option",{value:"",children:"-- Choose --"}),h.map(s=>e.jsx("option",{value:s.id,children:s.display_name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream/80 text-sm font-medium mb-1.5",children:"XP Amount"}),e.jsx("input",{type:"number",min:"1",value:P,onChange:s=>_(s.target.value),placeholder:"50",className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream/80 text-sm font-medium mb-1.5",children:"Reason"}),e.jsx("input",{type:"text",value:b,onChange:s=>A(s.target.value),placeholder:"Great job helping out!",className:"field-input"})]})]})})]})}export{Ce as default};
