import{c as W,r,j as e,b as z,u as Q}from"./index-DbTTv7ag.js";import{S as _}from"./star-Dh13X_k5.js";import{m as M}from"./proxy-B1EfiGkW.js";import{F as $}from"./flame-Y6z8Oy63.js";import{A as G}from"./index-B4Vs-Szk.js";import{L as B}from"./loader-circle-Bxpi28eJ.js";import{T as K}from"./triangle-alert-D4S9KrDU.js";import{C as Y}from"./camera-Dj7jgd-a.js";import{C as Z}from"./check-check-yaJQLjNx.js";import{C as H}from"./circle-check-DW88RjrA.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=W("Skull",[["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M15 22a1 1 0 0 0 1-1v-1a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20v1a1 1 0 0 0 1 1z",key:"1o5pge"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=W("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]);function te({value:t=0,prefix:o="XP"}){const[n,i]=r.useState(t),s=r.useRef(t),d=r.useRef(null);return r.useEffect(()=>{const u=s.current,p=t;if(s.current=t,u===p){i(p);return}const w=p-u,C=Math.min(Math.abs(w)*15,1500),S=performance.now();function y(A){const h=A-S,g=Math.min(h/C,1),b=1-Math.pow(1-g,3),c=Math.round(u+w*b);i(c),g<1&&(d.current=requestAnimationFrame(y))}return d.current=requestAnimationFrame(y),()=>{d.current&&cancelAnimationFrame(d.current)}},[t]),e.jsxs("div",{className:"inline-flex items-center gap-1.5",children:[e.jsx(_,{size:18,className:"text-gold fill-gold"}),e.jsxs("span",{className:"font-heading text-gold text-xs tabular-nums",children:[n.toLocaleString()," ",o]})]})}const se={scale:[1,1.15,.95,1.1,1],rotate:[-2,3,-3,2,0],transition:{duration:.8,repeat:1/0,repeatType:"mirror",ease:"easeInOut"}};function ae(t){return t>=30?{size:32,className:"text-gold drop-shadow-[0_0_8px_rgba(249,215,28,0.6)]"}:t>=7?{size:26,className:"text-gold"}:{size:20,className:"text-gold/80"}}function ne({streak:t=0,longest:o=0}){const[n,i]=r.useState(!1),s=ae(t),d=t>=30;return e.jsxs("div",{className:"relative inline-flex items-center gap-1.5",onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[d?e.jsx(M.div,{animate:se,className:"flex items-center",children:e.jsx($,{size:s.size,className:s.className})}):e.jsx($,{size:s.size,className:s.className}),e.jsx("span",{className:`font-heading text-gold ${d?"text-sm":t>=7?"text-xs":"text-[10px]"}`,children:t}),n&&e.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-navy-mid border border-[#2a2a4a] rounded text-center whitespace-nowrap z-10 shadow-lg",children:[e.jsxs("p",{className:"font-body text-cream text-sm",children:[t," day streak"]}),e.jsxs("p",{className:"font-body text-cream/50 text-xs",children:["Best: ",o]}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-l-[5px] border-l-transparent border-r-[5px] border-r-transparent border-t-[5px] border-t-[#2a2a4a]"})]})]})}const V=["#f9d71c","#2de2a6","#b388ff","#64dfdf","#ff4444"],re=30,L=3;function I(t,o){return Math.random()*(o-t)+t}function oe(){return Array.from({length:re},(t,o)=>{const n=I(0,Math.PI*2),i=I(200,500),s=I(6,14),d=Math.random()>.5?"circle":"rect";return{id:o,color:V[Math.floor(Math.random()*V.length)],x:Math.cos(n)*i,y:Math.sin(n)*i,rotation:I(0,720),size:s,shape:d}})}function U({onComplete:t}){const[o,n]=r.useState(!0),i=r.useMemo(()=>oe(),[]);return r.useEffect(()=>{const s=setTimeout(()=>{n(!1),t==null||t()},L*1e3);return()=>clearTimeout(s)},[t]),e.jsx(G,{children:o&&e.jsx("div",{className:"fixed inset-0 z-[100] pointer-events-none overflow-hidden",children:i.map(s=>e.jsx(M.div,{className:"absolute",style:{left:"50%",top:"40%",width:s.shape==="circle"?s.size:s.size*.7,height:s.size,backgroundColor:s.color,borderRadius:s.shape==="circle"?"50%":"2px"},initial:{x:0,y:0,opacity:1,rotate:0,scale:1},animate:{x:s.x,y:[0,s.y*.4,s.y+300],opacity:[1,1,0],rotate:s.rotation,scale:[1,1.2,.5]},transition:{duration:L,ease:[.25,.46,.45,.94],y:{duration:L,ease:[.22,.61,.36,1]}}},s.id))})})}const D=[{value:1,color:"#ff4444"},{value:5,color:"#f9d71c"},{value:2,color:"#2de2a6"},{value:10,color:"#b388ff"},{value:3,color:"#64dfdf"},{value:15,color:"#ff8c42"},{value:1,color:"#ff6b9d"},{value:25,color:"#f9d71c"},{value:2,color:"#45b7d1"},{value:5,color:"#2de2a6"},{value:3,color:"#b388ff"},{value:10,color:"#ff4444"}],T=360/D.length;function O(t,o,n,i){const s=(i-90)*Math.PI/180;return{x:t+n*Math.cos(s),y:o+n*Math.sin(s)}}function ie(t,o,n,i,s){const d=O(t,o,n,s),u=O(t,o,n,i),p=s-i<=180?"0":"1";return["M",t,o,"L",d.x,d.y,"A",n,n,0,p,0,u.x,u.y,"Z"].join(" ")}function le({onResult:t,disabled:o=!1}){const[n,i]=r.useState(!1),[s,d]=r.useState(0),[u,p]=r.useState(null),[w,C]=r.useState(!1),[S,y]=r.useState(null);r.useRef(!1);const A=r.useCallback(async()=>{if(!(n||o)){i(!0),p(null),y(null);try{const c=await z("/api/spin/spin",{method:"POST"}),j=c.points||c.result||5;let m=D.findIndex(l=>l.value===j);m===-1&&(m=Math.floor(Math.random()*D.length));const P=m*T+T/2,k=5+Math.floor(Math.random()*3),N=s+k*360+(360-P);d(N),setTimeout(()=>{p(j),C(!0),i(!1),t==null||t(j)},3500)}catch(c){y(c.message||"Spin failed!"),i(!1)}}},[n,o,s,t]),h=150,g=150,b=140;return e.jsxs("div",{className:"flex flex-col items-center gap-6",children:[w&&e.jsx(U,{onComplete:()=>C(!1)}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1 z-10",children:e.jsx("div",{className:"w-0 h-0 border-l-[12px] border-l-transparent border-r-[12px] border-r-transparent border-t-[20px] border-t-gold",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.4))"}})}),e.jsx(M.div,{animate:{rotate:s},transition:{duration:3.5,ease:[.2,.8,.3,1]},className:"w-[300px] h-[300px]",children:e.jsxs("svg",{width:"300",height:"300",viewBox:"0 0 300 300",className:"drop-shadow-xl",children:[e.jsx("circle",{cx:h,cy:g,r:b+4,fill:"none",stroke:"#2a2a4a",strokeWidth:"4"}),D.map((c,j)=>{const m=j*T,P=m+T,k=m+T/2,N=O(h,g,b*.65,k);return e.jsxs("g",{children:[e.jsx("path",{d:ie(h,g,b,m,P),fill:c.color,stroke:"#0f0e17",strokeWidth:"2",opacity:.9}),e.jsx("text",{x:N.x,y:N.y,textAnchor:"middle",dominantBaseline:"central",fill:"#0f0e17",fontFamily:"'Press Start 2P', monospace",fontSize:"10",fontWeight:"bold",transform:`rotate(${k}, ${N.x}, ${N.y})`,children:c.value})]},j)}),e.jsx("circle",{cx:h,cy:g,r:22,fill:"#1a1a2e",stroke:"#2a2a4a",strokeWidth:"3"}),e.jsx("circle",{cx:h,cy:g,r:10,fill:"#f9d71c"})]})})]}),u!==null&&e.jsxs("div",{className:"game-panel px-6 py-3 text-center",children:[e.jsx("p",{className:"font-body text-cream/60 text-sm",children:"You won"}),e.jsxs("p",{className:"font-heading text-gold text-lg mt-1",children:[u," XP"]})]}),S&&e.jsx("p",{className:"font-body text-crimson text-sm text-center",children:S}),e.jsx("button",{onClick:A,disabled:n||o,className:`game-btn game-btn-gold text-base px-10 py-3 ${n||o?"opacity-50 cursor-not-allowed":""}`,children:n?"SPINNING...":"SPIN!"})]})}function ce(){const t=new Date,o=t.getDay(),n=o===0?-6:1-o,i=new Date(t);return i.setDate(t.getDate()+n),i.toISOString().slice(0,10)}function de(){return new Date().toISOString().slice(0,10)}function me(t){switch(t){case"easy":return[1];case"medium":return[1,2];case"hard":return[1,2,3];case"expert":return null;default:return[1]}}const xe={hidden:{opacity:0,y:20},visible:t=>({opacity:1,y:0,transition:{delay:t*.06,type:"spring",stiffness:260,damping:24}})},fe={idle:{scale:1},tap:{scale:.92}};function Se(){const{user:t,updateUser:o}=Q(),[n,i]=r.useState([]),[s,d]=r.useState([]),[u,p]=r.useState(null),[w,C]=r.useState(!0),[S,y]=r.useState(null),[A,h]=r.useState(null),[g,b]=r.useState(!1),[c,j]=r.useState({}),m=r.useCallback(async()=>{try{y(null);const l=ce(),x=de(),[a,f,v]=await Promise.all([z("/api/chores"),z(`/api/calendar?week_start=${l}`),z("/api/spin/availability")]);d(a);const E=f.days&&f.days[x]||[];i(E),p(v)}catch(l){y(l.message||"Failed to load quest data")}finally{C(!1)}},[]);r.useEffect(()=>{m()},[m]),r.useEffect(()=>{const l=()=>{m()};return window.addEventListener("ws:message",l),()=>window.removeEventListener("ws:message",l)},[m]);const P=async l=>{const x=l.chore_id,a=l.chore;if(!(a!=null&&a.requires_photo&&!c[x])){h(x);try{if(a!=null&&a.requires_photo&&c[x]){const f=new FormData;f.append("file",c[x]),await z(`/api/chores/${x}/complete`,{method:"POST",body:f})}else await z(`/api/chores/${x}/complete`,{method:"POST"});b(!0),a!=null&&a.points&&t&&o({points_balance:t.points_balance+a.points}),j(f=>{const v={...f};return delete v[x],v}),await m()}catch(f){y(f.message||"Failed to complete quest")}finally{h(null)}}},k=(l,x)=>{j(a=>({...a,[l]:x}))};function N(l){return l==="verified"?e.jsxs("span",{className:"flex items-center gap-1 text-emerald font-heading text-[10px]",children:[e.jsx(Z,{size:16})," Verified"]}):l==="completed"?e.jsxs("span",{className:"flex items-center gap-1 text-emerald font-heading text-[10px]",children:[e.jsx(H,{size:16})," Done"]}):null}return w?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(B,{className:"animate-spin text-gold",size:32})}):e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsx(G,{children:g&&e.jsx(U,{onComplete:()=>b(!1)})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("h1",{className:"font-heading text-gold text-base sm:text-lg leading-relaxed",children:"Quest Board"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"text-gold",size:22,fill:"currentColor"}),e.jsx(te,{value:(t==null?void 0:t.points_balance)??0})]}),e.jsx(ne,{streak:(t==null?void 0:t.current_streak)??0})]})]}),S&&e.jsxs("div",{className:"game-panel p-3 flex items-center gap-2 border-crimson/40 text-crimson text-base",children:[e.jsx(K,{size:18}),e.jsx("span",{children:S})]}),n.length===0&&!w?e.jsxs(M.div,{className:"game-panel p-8 flex flex-col items-center gap-4 text-center",initial:{opacity:0,y:12},animate:{opacity:1,y:0},children:[e.jsx(ee,{size:40,className:"text-cream/30"}),e.jsxs("p",{className:"font-heading text-cream/50 text-[11px] leading-relaxed",children:["No quests for today!",e.jsx("br",{}),"Take a break, adventurer."]})]}):e.jsx("div",{className:"space-y-3",children:n.map((l,x)=>{var q;const a=l.chore;if(!a)return null;const f=l.status==="pending",v=A===a.id,E=me(a.difficulty),X=((q=a.category)==null?void 0:q.colour)||"#64dfdf";return e.jsx(M.div,{className:"game-panel p-4",variants:xe,initial:"hidden",animate:"visible",custom:x,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1 w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:X}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[e.jsx("h3",{className:"font-heading text-cream text-[11px] leading-relaxed truncate",children:a.title}),N(l.status)]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-cream/50",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gold font-body text-base",children:[e.jsx(_,{size:14,fill:"currentColor"}),a.points," XP"]}),e.jsx("span",{className:"flex items-center gap-0.5",children:E?E.map(F=>e.jsx(_,{size:12,className:"text-purple",fill:"currentColor"},F)):e.jsx(J,{size:14,className:"text-crimson"})})]}),a.requires_photo&&f&&e.jsx("div",{className:"mt-2",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-cream/60 cursor-pointer hover:text-cream transition-colors",children:[e.jsx(Y,{size:16}),e.jsx("span",{children:c[a.id]?c[a.id].name:"Attach proof photo"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:F=>{var R;return k(a.id,((R=F.target.files)==null?void 0:R[0])||null)}})]})}),f&&e.jsx(M.button,{className:`game-btn game-btn-gold mt-3 w-full sm:w-auto ${v?"opacity-60 cursor-wait":""} ${a.requires_photo&&!c[a.id]?"opacity-40 cursor-not-allowed":""}`,variants:fe,whileTap:"tap",disabled:v||a.requires_photo&&!c[a.id],onClick:()=>P(l),children:v?e.jsxs("span",{className:"flex items-center gap-2 justify-center",children:[e.jsx(B,{size:14,className:"animate-spin"}),"Completing..."]}):"Complete Quest"})]})]})},l.id)})}),e.jsx("div",{className:"pt-4",children:e.jsx(le,{availability:u,onSpinComplete:()=>{m()}})})]})}export{Se as default};
