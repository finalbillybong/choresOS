import{u as A,r as s,b as c,j as e,d as T}from"./index-D5ND-kNr.js";import{M as $}from"./Modal-BIv3u65-.js";import{P as q}from"./plus-Dxfrd01Q.js";import{L as Z}from"./loader-circle-Dxt2oQ2D.js";import{Z as R}from"./zap-Fdl_5HNI.js";import{P as U}from"./pencil-CP557SBS.js";import{T as W}from"./trash-2-kLCDtE70.js";import"./index-BjHS8g3H.js";import"./proxy-DlynYiss.js";function _(a){return a?new Date(a).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):""}function z(a){return a?new Date(a).toISOString().slice(0,10):""}function te(){const{user:a}=A(),m=(a==null?void 0:a.role)==="parent"||(a==null?void 0:a.role)==="admin",[x,F]=s.useState([]),[u,S]=s.useState(!0),[E,p]=s.useState(""),[L,r]=s.useState(!1),[h,w]=s.useState(null),[g,f]=s.useState(""),[y,b]=s.useState(""),[D,j]=s.useState("1.5"),[d,v]=s.useState(""),[o,N]=s.useState(""),[C,i]=s.useState(""),[k,P]=s.useState(!1),l=s.useCallback(async()=>{S(!0),p("");try{const t=await c("/api/events");F(t||[])}catch(t){p(t.message||"Failed to load events")}finally{S(!1)}},[]);s.useEffect(()=>{l()},[l]),s.useEffect(()=>{const t=()=>{l()};return window.addEventListener("ws:message",t),()=>window.removeEventListener("ws:message",t)},[l]);const M=()=>{w(null),f(""),b(""),j("1.5"),v(""),N(""),i(""),r(!0)},O=t=>{w(t),f(t.title),b(t.description||""),j(String(t.multiplier)),v(z(t.start_date)),N(z(t.end_date)),i(""),r(!0)},I=async()=>{if(!g.trim()){i("Title is required");return}if(!d||!o){i("Start and end dates are required");return}const t=parseFloat(D);if(!t||t<=1){i("Multiplier must be greater than 1");return}if(new Date(o)<=new Date(d)){i("End date must be after start date");return}P(!0),i("");try{const n={title:g.trim(),description:y.trim()||null,multiplier:t,start_date:new Date(d+"T00:00:00").toISOString(),end_date:new Date(o+"T23:59:59").toISOString()};h?await c(`/api/events/${h.id}`,{method:"PUT",body:n}):await c("/api/events",{method:"POST",body:n}),r(!1),l()}catch(n){i(n.message||"Failed to save event")}finally{P(!1)}},X=async t=>{try{await c(`/api/events/${t}`,{method:"DELETE"}),l()}catch(n){p(n.message||"Failed to delete event")}};return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{size:28,className:"text-gold"}),e.jsx("h1",{className:"text-cream text-xl font-extrabold leading-relaxed",children:"Seasonal Events"})]}),m&&e.jsxs("button",{onClick:M,className:"game-btn game-btn-gold flex items-center gap-2",children:[e.jsx(q,{size:14}),"New Event"]})]}),E&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm text-center",children:E}),u&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(Z,{size:32,className:"text-gold animate-spin"})}),!u&&x.length===0&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx(T,{size:48,className:"text-muted mx-auto mb-4"}),e.jsx("p",{className:"text-cream text-lg font-bold",children:"No events yet"}),e.jsx("p",{className:"text-muted text-sm mt-2",children:"Create a seasonal event to boost XP with a multiplier."})]}),!u&&x.length>0&&e.jsx("div",{className:"space-y-3",children:x.map(t=>e.jsx("div",{className:`game-panel p-4 ${t.is_active?"!border-gold/40":""}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx(R,{size:18,className:t.is_active?"text-gold":"text-muted"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-cream text-sm font-bold truncate",children:t.title}),t.is_active&&e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider bg-gold/20 text-gold px-2 py-0.5 rounded",children:"Active"})]}),t.description&&e.jsx("p",{className:"text-muted text-xs mt-1",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted",children:[e.jsxs("span",{className:"text-gold font-bold",children:[t.multiplier,"x XP"]}),e.jsxs("span",{children:[_(t.start_date)," â€” ",_(t.end_date)]})]})]}),m&&e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("button",{onClick:()=>O(t),className:"p-2 rounded hover:bg-surface-raised text-muted hover:text-cream transition-colors",title:"Edit",children:e.jsx(U,{size:14})}),e.jsx("button",{onClick:()=>X(t.id),className:"p-2 rounded hover:bg-crimson/10 text-crimson/60 hover:text-crimson transition-colors",title:"Delete",children:e.jsx(W,{size:14})})]})]})},t.id))}),e.jsx($,{isOpen:L,onClose:()=>r(!1),title:h?"Edit Event":"New Seasonal Event",actions:[{label:"Cancel",onClick:()=>r(!1),className:"game-btn game-btn-red"},{label:k?"Saving...":"Save",onClick:I,className:"game-btn game-btn-gold",disabled:k}],children:e.jsxs("div",{className:"space-y-4",children:[C&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-sm",children:C}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold text-sm font-medium mb-1",children:"Title"}),e.jsx("input",{type:"text",value:g,onChange:t=>f(t.target.value),placeholder:"e.g. Summer Challenge",className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold text-sm font-medium mb-1",children:"Description (optional)"}),e.jsx("textarea",{value:y,onChange:t=>b(t.target.value),placeholder:"What's the event about?",rows:2,className:"field-input resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold text-sm font-medium mb-1",children:"XP Multiplier"}),e.jsx("input",{type:"number",min:"1.1",step:"0.1",value:D,onChange:t=>j(t.target.value),placeholder:"e.g. 2.0",className:"field-input"}),e.jsx("p",{className:"text-muted text-xs mt-1",children:"All XP earned during this event is multiplied by this amount."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold text-sm font-medium mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:d,onChange:t=>v(t.target.value),className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold text-sm font-medium mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:o,onChange:t=>N(t.target.value),className:"field-input"})]})]})]})})]})}export{te as default};
