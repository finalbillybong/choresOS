import{f as J,u as Z,c as ee,a as te,r as d,b as m,j as e,e as L,S as se}from"./index-B1SpUUbW.js";import{t as ae,a as re}from"./questThemeText-DZV5m0eP.js";import{S as ie}from"./scroll-text-BPSIxPHP.js";import{C as $}from"./circle-x-B_ify2CU.js";import{S as ne}from"./shield-DRVw8k_e.js";import{R as le}from"./refresh-cw-DG_6thIV.js";import{C as ce}from"./camera-C5VF55SW.js";import{C as E}from"./circle-check-BvHoaB1N.js";import{S as oe}from"./skip-forward-DacLR-oX.js";import{R as O,C as P}from"./rotate-cw-BGmIgD0q.js";import{C as de}from"./chevron-right-hCmB2CU_.js";import{T as me}from"./trash-2-GsCJcJKW.js";import{C as xe}from"./clock-D083iAFm.js";import{S as pe}from"./star-BBXK3HxT.js";const ue={easy:1,medium:2,hard:3,expert:4},he=["Trivial","Easy","Medium","Hard","Legendary"],ge=["text-muted","text-emerald","text-sky","text-purple","text-gold"],fe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],D={cleaning:"bg-sky/20 text-sky border-sky/40",cooking:"bg-gold/20 text-gold border-gold/40",outdoor:"bg-emerald/20 text-emerald border-emerald/40",homework:"bg-purple/20 text-purple border-purple/40",pet_care:"bg-crimson/20 text-crimson border-crimson/40",laundry:"bg-sky/20 text-sky border-sky/40",errands:"bg-gold/20 text-gold border-gold/40",default:"bg-cream/10 text-muted border-border"};function be({level:i}){const n=typeof i=="string"?ue[i]||1:i||1;return e.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(g=>e.jsx(pe,{size:18,className:g<=n?"text-gold fill-gold":"text-cream/20"},g)),e.jsx("span",{className:`ml-2 text-sm ${ge[n-1]||"text-muted"}`,children:he[n-1]||"Unknown"})]})}function je({status:i}){const n={pending:"bg-gold/20 text-gold border-gold/40",completed:"bg-emerald/20 text-emerald border-emerald/40",verified:"bg-sky/20 text-sky border-sky/40",skipped:"bg-cream/10 text-muted border-border",missed:"bg-crimson/20 text-crimson border-crimson/40"};return e.jsx("span",{className:`inline-block px-2 py-0.5 rounded-full text-sm border capitalize ${n[i]||n.pending}`,children:i||"pending"})}function Oe(){var z,R;const{id:i}=J(),{user:n}=Z(),{colorTheme:g}=ee(),k=te(),u=(n==null?void 0:n.role)==="parent"||(n==null?void 0:n.role)==="admin",A=(n==null?void 0:n.role)==="kid",[s,F]=d.useState(null),[Q,q]=d.useState(!0),[w,S]=d.useState(""),[l,c]=d.useState(""),[j,a]=d.useState(""),[x,N]=d.useState(null),[f,U]=d.useState([]),h=d.useCallback(async()=>{if(u)try{const r=(await m("/api/rotations")||[]).find(b=>b.chore_id===parseInt(i));N(r||null)}catch{N(null)}},[i,u]),p=d.useCallback(async()=>{try{S("");const t=await m(`/api/chores/${i}`);F(t)}catch(t){S(t.message||"This quest scroll could not be found.")}finally{q(!1)}},[i]);d.useEffect(()=>{p(),h(),u&&m("/api/stats/kids").then(t=>U(t||[])).catch(()=>{})},[p,h,u]),d.useEffect(()=>{const t=()=>{p(),h()};return window.addEventListener("ws:message",t),()=>window.removeEventListener("ws:message",t)},[p,h]);const B=async()=>{c("complete"),a("");try{await m(`/api/chores/${i}/complete`,{method:"POST"}),a("Quest completed! XP has been awarded to your hero."),await p()}catch(t){a(t.message||"Failed to complete the quest.")}finally{c("")}},M=async t=>{c("verify"),a("");try{const r=t?`/api/chores/assignments/${t}/verify`:`/api/chores/${i}/verify`;await m(r,{method:"POST"}),a("Quest verified! The hero has been rewarded."),await p()}catch(r){a(r.message||"Verification failed.")}finally{c("")}},K=async t=>{c("uncomplete"),a("");try{const r=t?`/api/chores/assignments/${t}/uncomplete`:`/api/chores/${i}/uncomplete`;await m(r,{method:"POST"}),a("Quest marked as incomplete."),await p()}catch(r){a(r.message||"Could not undo completion.")}finally{c("")}},V=async t=>{c("skip"),a("");try{const r=t?`/api/chores/assignments/${t}/skip`:`/api/chores/${i}/skip`;await m(r,{method:"POST"}),a("Quest skipped for today."),await p()}catch(r){a(r.message||"Could not skip the quest.")}finally{c("")}},Y=async()=>{if(f.length<2){a("Need at least 2 kids for a rotation.");return}c("rotation");try{await m("/api/rotations",{method:"POST",body:{chore_id:parseInt(i),kid_ids:f.map(t=>t.id),cadence:"weekly"}}),await h(),a("Rotation created.")}catch(t){a(t.message||"Could not create rotation.")}finally{c("")}},I=async()=>{if(x){c("rotation");try{await m(`/api/rotations/${x.id}/advance`,{method:"POST"}),await h(),a("Rotation advanced to next kid.")}catch(t){a(t.message||"Could not advance rotation.")}finally{c("")}}},X=async()=>{if(x){c("rotation");try{await m(`/api/rotations/${x.id}`,{method:"DELETE"}),N(null),a("Rotation removed.")}catch(t){a(t.message||"Could not delete rotation.")}finally{c("")}}};if(Q)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[e.jsx(ie,{size:48,className:"text-sky animate-pulse"}),e.jsx("p",{className:"text-cream text-lg font-bold animate-pulse",children:"Unrolling the quest scroll..."})]});if(w)return e.jsxs("div",{className:"max-w-2xl mx-auto py-10",children:[e.jsxs("button",{onClick:()=>k("/chores"),className:"flex items-center gap-2 text-muted hover:text-cream transition-colors mb-6",children:[e.jsx(L,{size:18}),e.jsx("span",{className:"text-sm",children:"Back to Quest Board"})]}),e.jsxs("div",{className:"game-panel p-10 text-center",children:[e.jsx($,{size:48,className:"mx-auto text-crimson mb-4"}),e.jsx("p",{className:"text-cream text-xl font-extrabold mb-2",children:"Quest Not Found"}),e.jsx("p",{className:"text-muted text-sm",children:w})]})]});if(!s)return null;const y=typeof s.category=="object"?(z=s.category)==null?void 0:z.name:s.category,G=D[y==null?void 0:y.toLowerCase()]||D.default,T=s.assignments||s.history||[],v=new Date().toISOString().split("T")[0],o=T.find(t=>t.date===v||t.assigned_date===v||t.due_date===v),H=o&&(o.status==="pending"||o.status==="assigned"),C=T.slice(0,10);return e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs("button",{onClick:()=>k("/chores"),className:"flex items-center gap-2 text-muted hover:text-cream transition-colors",children:[e.jsx(L,{size:18}),e.jsx("span",{className:"text-sm",children:"Back to Quest Board"})]}),e.jsxs("div",{className:"game-panel p-6 space-y-5",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(se,{size:28,className:"text-sky flex-shrink-0 mt-1"}),e.jsx("div",{className:"flex-1",children:e.jsx("h1",{className:"text-cream text-xl font-extrabold leading-relaxed",children:ae(s.title,g)})})]}),s.description&&e.jsx("div",{className:"pl-10",children:e.jsx("p",{className:"text-muted text-sm leading-relaxed",children:re(s.title,s.description,g)})}),e.jsx("div",{className:"mx-auto w-full h-[1px] bg-gradient-to-r from-transparent via-border to-transparent"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gold/10 flex items-center justify-center",children:e.jsx("span",{className:"text-gold text-xl",children:"â˜…"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"XP Reward"}),e.jsxs("p",{className:"text-gold text-lg font-bold",children:[s.points," XP"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium mb-1",children:"Difficulty"}),e.jsx(be,{level:s.difficulty||1})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-surface-raised flex items-center justify-center",children:e.jsx(ne,{size:18,className:"text-muted"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Category"}),e.jsx("span",{className:`inline-block px-2 py-0.5 rounded-full text-sm border capitalize ${G}`,children:y||"General"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-surface-raised flex items-center justify-center",children:e.jsx(le,{size:18,className:"text-muted"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Recurrence"}),e.jsxs("p",{className:"text-cream text-sm capitalize",children:[s.recurrence||"Once",s.recurrence==="custom"&&((R=s.custom_days)==null?void 0:R.length)>0&&e.jsxs("span",{className:"text-muted text-xs ml-1",children:["(",s.custom_days.map(t=>fe[t]||t).join(", "),")"]})]})]})]})]}),s.requires_photo&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded bg-purple/10 border border-purple/30",children:[e.jsx(ce,{size:16,className:"text-purple"}),e.jsx("span",{className:"text-purple text-xs",children:"Photo proof required upon completion"})]})]}),j&&e.jsx("div",{className:`p-3 rounded border-2 text-sm text-center ${j.toLowerCase().includes("fail")||j.toLowerCase().includes("could not")?"border-crimson/40 bg-crimson/10 text-crimson":"border-emerald/40 bg-emerald/10 text-emerald"}`,children:j}),A&&H&&e.jsx("div",{className:"game-panel p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-cream text-lg font-bold mb-1",children:"Today's Quest"}),e.jsx("p",{className:"text-muted text-xs",children:"This quest awaits your courage, adventurer!"})]}),e.jsxs("button",{onClick:B,disabled:!!l,className:`game-btn game-btn-blue flex items-center gap-2 ${l==="complete"?"opacity-60 cursor-wait":""}`,children:[e.jsx(E,{size:16}),l==="complete"?"Completing...":"Complete Quest"]})]})}),u&&e.jsxs("div",{className:"game-panel p-5",children:[e.jsx("p",{className:"text-cream text-lg font-bold mb-3",children:"Guild Master Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:()=>M(o==null?void 0:o.id),disabled:!!l,className:`game-btn game-btn-blue flex items-center gap-2 ${l==="verify"?"opacity-60 cursor-wait":""}`,children:[e.jsx(E,{size:14}),l==="verify"?"Verifying...":"Verify"]}),e.jsxs("button",{onClick:()=>K(o==null?void 0:o.id),disabled:!!l,className:`game-btn game-btn-blue flex items-center gap-2 ${l==="uncomplete"?"opacity-60 cursor-wait":""}`,children:[e.jsx($,{size:14}),l==="uncomplete"?"Undoing...":"Uncomplete"]}),e.jsxs("button",{onClick:()=>V(o==null?void 0:o.id),disabled:!!l,className:`game-btn game-btn-red flex items-center gap-2 ${l==="skip"?"opacity-60 cursor-wait":""}`,children:[e.jsx(oe,{size:14}),l==="skip"?"Skipping...":"Skip Today"]})]})]}),u&&s.recurrence&&s.recurrence!=="once"&&e.jsxs("div",{className:"game-panel p-5 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{size:18,className:"text-purple"}),e.jsx("h2",{className:"text-cream text-lg font-bold",children:"Kid Rotation"})]}),x?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-muted",children:"Cadence:"}),e.jsx("span",{className:"text-cream capitalize",children:x.cadence})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(x.kid_ids||[]).map((t,r)=>{const b=f.find(W=>W.id===t),_=r===x.current_index;return e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${_?"border-purple bg-purple/20 text-purple":"border-border text-muted"}`,children:[(b==null?void 0:b.display_name)||`Kid #${t}`,_&&" (current)"]},t)})}),e.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[e.jsxs("button",{onClick:I,disabled:l==="rotation",className:"game-btn game-btn-purple flex items-center gap-1.5 !py-1.5 !px-3 !text-[11px]",children:[e.jsx(de,{size:14}),"Advance"]}),e.jsxs("button",{onClick:X,disabled:l==="rotation",className:"game-btn game-btn-red flex items-center gap-1.5 !py-1.5 !px-3 !text-[11px]",children:[e.jsx(me,{size:14}),"Remove Rotation"]})]})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs mb-3",children:"No rotation set. Create one to automatically rotate this quest between kids."}),e.jsxs("button",{onClick:Y,disabled:l==="rotation"||f.length<2,className:"game-btn game-btn-purple flex items-center gap-1.5 !py-1.5 !px-3 !text-[11px]",children:[e.jsx(O,{size:14}),f.length<2?"Need 2+ kids":"Create Rotation"]})]})]}),C.length>0&&e.jsxs("div",{className:"game-panel p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{size:18,className:"text-sky"}),e.jsx("h2",{className:"text-cream text-lg font-bold",children:"Quest Log"})]}),e.jsx("div",{className:"space-y-2",children:C.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded bg-surface-raised/30 border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{size:14,className:"text-cream/30"}),e.jsx("span",{className:"text-muted text-xs",children:t.date||t.assigned_date||t.due_date||"N/A"}),t.assigned_to_name&&e.jsxs("span",{className:"text-muted text-xs",children:["- ",t.assigned_to_name]})]}),e.jsx(je,{status:t.status})]},t.id||r))})]}),C.length===0&&e.jsxs("div",{className:"game-panel p-8 text-center",children:[e.jsx(P,{size:32,className:"mx-auto text-cream/20 mb-3"}),e.jsx("p",{className:"text-muted text-sm",children:"No entries in the quest log yet. Adventures await!"})]})]})}export{Oe as default};
