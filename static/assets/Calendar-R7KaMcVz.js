import{c as I,a as J,u as U,r as n,b as y,j as e,C as O}from"./index-DbTTv7ag.js";import{M as V}from"./Modal-Bj2NyloF.js";import{C as X,a as Z}from"./chevron-right-BRuSubfb.js";import{L as ee}from"./loader-circle-Bxpi28eJ.js";import{C as $}from"./check-check-yaJQLjNx.js";import{C as W}from"./clock-BJLivEWx.js";import"./index-B4Vs-Szk.js";import"./proxy-B1EfiGkW.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=I("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=I("Slash",[["path",{d:"M22 2 2 22",key:"y4kqgn"}]]);function A(l){const a=new Date(l),o=a.getDay(),c=a.getDate()-o+(o===0?-6:1);return a.setDate(c),a.toISOString().slice(0,10)}function h(l,a){const o=new Date(l+"T00:00:00");return o.setDate(o.getDate()+a),o.toISOString().slice(0,10)}const ae=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];function re(l,a){const o=new Date().toISOString().slice(0,10);return l.status==="verified"?{border:"border-emerald",bg:"bg-emerald/10",icon:e.jsx($,{size:16,className:"text-emerald"})}:l.status==="completed"?{border:"border-emerald",bg:"bg-emerald/5",icon:e.jsx($,{size:16,className:"text-emerald/60"})}:l.status==="skipped"?{border:"border-[#2a2a4a]",bg:"bg-navy-light/50",icon:e.jsx(se,{size:16,className:"text-cream/30"}),textClass:"line-through text-cream/30"}:a<o?{border:"border-crimson",bg:"bg-crimson/5",icon:e.jsx(W,{size:16,className:"text-crimson"})}:{border:"border-[#2a2a4a]",bg:"",icon:e.jsx(W,{size:16,className:"text-cream/40"})}}function he(){const l=J(),{user:a}=U(),o=(a==null?void 0:a.role)==="kid",[c,j]=n.useState(()=>A(new Date)),[w,K]=n.useState({}),[N,C]=n.useState(!0),[v,T]=n.useState(""),[q,g]=n.useState(!1),[m,P]=n.useState(null),[D,S]=n.useState([]),[u,_]=n.useState(""),[z,L]=n.useState(!1),[E,b]=n.useState(""),k=n.useCallback(async()=>{C(!0),T("");try{const t=await y(`/api/calendar?week_start=${c}`),i={};for(let s=0;s<7;s++)i[h(c,s)]=[];(t.assignments||t||[]).forEach(s=>{var p,x;const r=((p=s.due_date)==null?void 0:p.slice(0,10))||((x=s.date)==null?void 0:x.slice(0,10));r&&i[r]&&i[r].push(s)}),K(i)}catch(t){T(t.message||"Failed to load calendar")}finally{C(!1)}},[c]);n.useEffect(()=>{k()},[k]);const R=()=>j(h(c,-7)),F=()=>j(h(c,7)),Q=()=>j(A(new Date)),B=async t=>{P(t),b(""),_(""),g(!0);try{const i=await y("/api/admin/users"),s=(i.users||i||[]).filter(r=>r.role==="kid"&&r.id!==a.id&&r.is_active!==!1);S(s)}catch{try{const s=(await y("/api/family/members")||[]).filter(r=>r.role==="kid"&&r.id!==a.id);S(s)}catch{S([])}}},H=async()=>{if(!u){b("Select a hero to trade with");return}L(!0),b("");try{await y("/api/calendar/trade",{method:"POST",body:{assignment_id:m.id,target_user_id:u}}),g(!1),k()}catch(t){b(t.message||"Trade failed")}finally{L(!1)}},Y=h(c,6),M=t=>new Date(t+"T00:00:00").toLocaleDateString(void 0,{month:"short",day:"numeric"});return e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{size:28,className:"text-gold"}),e.jsx("h1",{className:"font-heading text-gold text-xs sm:text-sm leading-relaxed",children:"Quest Calendar"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:R,className:"p-2 rounded hover:bg-[#2a2a4a] transition-colors text-cream/70 hover:text-cream","aria-label":"Previous week",children:e.jsx(X,{size:20})}),e.jsxs("span",{className:"text-cream font-body text-lg min-w-[180px] text-center",children:[M(c)," â€“ ",M(Y)]}),e.jsx("button",{onClick:F,className:"p-2 rounded hover:bg-[#2a2a4a] transition-colors text-cream/70 hover:text-cream","aria-label":"Next week",children:e.jsx(Z,{size:20})}),e.jsx("button",{onClick:Q,className:"game-btn game-btn-blue ml-2",children:"This Week"})]})]}),v&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-base text-center",children:v}),N&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(ee,{size:32,className:"text-gold animate-spin"})}),!N&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-7 gap-3 overflow-x-auto",children:ae.map((t,i)=>{const s=h(c,i),r=new Date().toISOString().slice(0,10),p=s===r,x=w[s]||[];return e.jsxs("div",{className:"min-w-[140px]",children:[e.jsxs("div",{className:`text-center py-2 px-1 rounded-t-md border-b-2 ${p?"bg-gold/10 border-gold text-gold":"bg-[#2a2a4a]/30 border-[#2a2a4a] text-cream/60"}`,children:[e.jsx("div",{className:"font-heading text-[9px] tracking-wider",children:t}),e.jsx("div",{className:"font-body text-base mt-1",children:new Date(s+"T00:00:00").getDate()})]}),e.jsxs("div",{className:"space-y-2 mt-2 min-h-[80px]",children:[x.length===0&&e.jsx("p",{className:"text-cream/20 text-sm text-center font-body py-4",children:"No quests"}),x.map(d=>{const f=re(d,s);return e.jsxs("div",{className:`game-panel !border-2 ${f.border} ${f.bg} p-2 cursor-pointer hover:brightness-110 transition-all`,onClick:()=>l(`/chores/${d.chore_id||d.id}`),children:[e.jsxs("div",{className:"flex items-start gap-1.5",children:[f.icon,e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:`text-sm font-body leading-tight truncate ${f.textClass||"text-cream"}`,children:d.chore_title||d.title||"Quest"}),!o&&d.assigned_to_name&&e.jsx("p",{className:"text-[11px] text-purple font-body mt-0.5 truncate",children:d.assigned_to_name})]})]}),o&&d.status==="pending"&&e.jsxs("button",{onClick:G=>{G.stopPropagation(),B(d)},className:"mt-1.5 flex items-center gap-1 text-[10px] font-heading text-sky hover:text-sky/80 transition-colors",children:[e.jsx(te,{size:12}),"Trade"]})]},d.id)})]})]},s)})}),!N&&!v&&Object.values(w).every(t=>t.length===0)&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx(O,{size:48,className:"text-cream/10 mx-auto mb-4"}),e.jsx("p",{className:"font-heading text-cream/30 text-[10px]",children:"No quests scheduled this week"}),e.jsx("p",{className:"text-cream/20 font-body text-base mt-2",children:"The quest board is empty. Time to plan new adventures!"})]}),e.jsx(V,{isOpen:q,onClose:()=>g(!1),title:"Propose a Trade",actions:[{label:"Cancel",onClick:()=>g(!1),className:"game-btn game-btn-red"},{label:z?"Sending...":"Send Trade",onClick:H,className:"game-btn game-btn-gold",disabled:z||!u}],children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-cream/80 text-base",children:["Trade"," ",e.jsx("span",{className:"text-gold font-heading text-[10px]",children:(m==null?void 0:m.chore_title)||(m==null?void 0:m.title)})," ","with another hero:"]}),E&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-sm",children:E}),D.length===0?e.jsx("p",{className:"text-cream/40 text-sm",children:"No other heroes found in your party."}):e.jsx("div",{className:"space-y-2",children:D.map(t=>e.jsx("button",{onClick:()=>_(t.id),className:`w-full text-left p-3 rounded border-2 transition-colors ${u===t.id?"border-gold bg-gold/10 text-gold":"border-[#2a2a4a] text-cream/70 hover:border-cream/30"}`,children:e.jsx("span",{className:"font-body text-lg",children:t.display_name||t.username})},t.id))})]})})]})}export{he as default};
