import{f as T,a as V,r as i,b as p,j as e,A as D,S as K}from"./index-B1SpUUbW.js";import{L as f}from"./loader-circle-DQqyjO1O.js";import{C as b}from"./circle-x-B_ify2CU.js";import{S as k}from"./star-BBXK3HxT.js";import{F as O}from"./flame-CK5XRD5b.js";import{S as X}from"./skip-forward-DacLR-oX.js";import{C as h}from"./circle-check-BvHoaB1N.js";import{C as w}from"./clock-D083iAFm.js";import{m as B}from"./proxy-B6TPh4oX.js";import{C as Q}from"./camera-C5VF55SW.js";const C={pending:{label:"Pending",color:"text-muted",icon:w},completed:{label:"Awaiting Approval",color:"text-gold",icon:w},verified:{label:"Approved",color:"text-emerald",icon:h},skipped:{label:"Skipped",color:"text-muted/50",icon:X}},G={hidden:{opacity:0,y:10},visible:c=>({opacity:1,y:0,transition:{delay:c*.05,type:"spring",stiffness:300,damping:28}})};function te(){const{kidId:c}=T(),S=V(),[x,_]=i.useState(null),[z,$]=i.useState(!0),[l,o]=i.useState(""),[u,A]=i.useState({}),r=i.useCallback(async()=>{try{o("");const s=await p(`/api/stats/family/${c}`);_(s)}catch(s){o(s.message||"Failed to load kid data")}finally{$(!1)}},[c]);i.useEffect(()=>{r()},[r]),i.useEffect(()=>{const s=()=>r();return window.addEventListener("ws:message",s),()=>window.removeEventListener("ws:message",s)},[r]);const m=(s,t)=>{A(a=>({...a,[s]:t}))},E=async s=>{const t=`verify-${s}`;m(t,!0);try{await p(`/api/chores/${s}/verify`,{method:"POST"}),await r()}catch(a){o(a.message||"Failed to verify quest")}finally{m(t,!1)}},L=async s=>{const t=`reject-${s}`;m(t,!0);try{await p(`/api/chores/${s}/uncomplete`,{method:"POST"}),await r()}catch(a){o(a.message||"Failed to reject quest")}finally{m(t,!1)}};if(z)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(f,{className:"animate-spin text-sky",size:28})});if(l&&!x)return e.jsx("div",{className:"max-w-2xl mx-auto py-10",children:e.jsxs("div",{className:"game-panel p-10 text-center",children:[e.jsx(b,{size:48,className:"mx-auto text-crimson mb-4"}),e.jsx("p",{className:"text-cream text-xl font-extrabold mb-2",children:"Error"}),e.jsx("p",{className:"text-muted text-sm",children:l})]})});if(!x)return null;const{kid:n,assignments:d}=x,F=d.filter(s=>s.status==="completed"||s.status==="verified").length;return e.jsxs("div",{className:"max-w-3xl mx-auto space-y-5",children:[e.jsx("div",{className:"game-panel p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(D,{config:n.avatar_config,size:"lg",name:n.display_name}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h1",{className:"font-heading text-cream text-xl font-extrabold truncate",children:[n.display_name,"'s Quests"]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-gold text-sm font-semibold",children:[e.jsx(k,{size:14,fill:"currentColor"}),n.points_balance.toLocaleString()," XP"]}),n.current_streak>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-orange-400 text-sm font-semibold",children:[e.jsx(O,{size:14,fill:"currentColor"}),n.current_streak," day streak"]})]}),e.jsxs("p",{className:"text-muted text-xs mt-1",children:[F,"/",d.length," quests done today"]})]})]})}),l&&e.jsx("div",{className:"game-panel p-3 border-crimson/30 text-crimson text-sm",children:l}),d.length===0?e.jsxs("div",{className:"game-panel p-10 text-center",children:[e.jsx(K,{size:40,className:"mx-auto text-muted mb-4"}),e.jsx("p",{className:"text-muted text-sm",children:"No quests assigned for today."})]}):e.jsx("div",{className:"space-y-3",children:d.map((s,t)=>{const a=C[s.status]||C.pending,P=a.icon,j=s.status==="completed",g=s.status==="verified",q=`verify-${s.chore_id}`,R=`reject-${s.chore_id}`,y=u[q],N=u[R],v=y||N;return e.jsxs(B.div,{className:`game-panel p-4 ${g?"opacity-50":""}`,variants:G,initial:"hidden",animate:"visible",custom:t,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1 cursor-pointer",onClick:()=>S(`/chores/${s.chore_id}`),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-cream text-sm font-bold truncate",children:s.chore.title}),s.chore.requires_photo&&e.jsx(Q,{size:12,className:"text-sky flex-shrink-0"})]}),s.chore.description&&e.jsx("p",{className:"text-muted text-xs line-clamp-1 mb-1.5",children:s.chore.description}),e.jsxs("div",{className:"flex items-center flex-wrap gap-3",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gold text-xs font-semibold",children:[e.jsx(k,{size:11,fill:"currentColor"}),s.chore.points," XP"]}),s.chore.category&&e.jsx("span",{className:"text-muted text-xs capitalize",children:s.chore.category}),e.jsxs("span",{className:`flex items-center gap-1 text-xs font-medium ${a.color}`,children:[e.jsx(P,{size:12}),a.label]})]})]}),j&&e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{className:"game-btn game-btn-blue !px-3 !py-2",disabled:v,onClick:()=>E(s.chore_id),title:"Approve",children:y?e.jsx(f,{size:14,className:"animate-spin"}):e.jsx(h,{size:16})}),e.jsx("button",{className:"game-btn game-btn-red !px-3 !py-2",disabled:v,onClick:()=>L(s.chore_id),title:"Reject",children:N?e.jsx(f,{size:14,className:"animate-spin"}):e.jsx(b,{size:16})})]}),g&&e.jsx(h,{size:20,className:"text-emerald flex-shrink-0"})]}),s.photo_proof_path&&j&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:`/api/uploads/${s.photo_proof_path}`,alt:"Photo proof",className:"rounded-lg max-h-48 object-cover border border-border"})})]},s.id)})})]})}export{te as default};
