import{c as E,a as $,u as I,r as a,b as x,j as e,f as D}from"./index-DbTTv7ag.js";import{S as L}from"./shield-BoUZ_pFx.js";import{L as g}from"./loader-circle-Bxpi28eJ.js";import{S as P,A as H}from"./save-CUQ6rfrU.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=E("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=E("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]);function J(){const F=$(),{user:n}=I(),j=(n==null?void 0:n.role)==="parent"||(n==null?void 0:n.role)==="admin",[c,v]=a.useState(null),[N,h]=a.useState(!0),[r,d]=a.useState(""),[p,S]=a.useState(!1),[u,o]=a.useState(""),[w,b]=a.useState([]),[M,_]=a.useState(!1),[k,C]=a.useState({}),A=a.useCallback(async()=>{var s,t,i;h(!0),d("");try{const l=await x("/api/admin/settings");v(l)}catch(l){(s=l.message)!=null&&s.includes("403")||(t=l.message)!=null&&t.includes("Forbidden")||(i=l.message)!=null&&i.includes("permission")?d("Access denied. Only parents and admins can access settings."):d(l.message||"Failed to load settings")}finally{h(!1)}},[]),z=a.useCallback(async()=>{_(!0);try{const s=await x("/api/stats/achievements/all");b(s.achievements||s||[])}catch{b([])}finally{_(!1)}},[]);a.useEffect(()=>{j?(A(),z()):(h(!1),d("Access denied. Only parents and admins can access settings."))},[j,A,z]);const m=(s,t)=>{v(i=>({...i,[s]:t}))},O=async()=>{S(!0),o("");try{await x("/api/admin/settings",{method:"PUT",body:c}),o("Settings saved!")}catch(s){o(s.message||"Failed to save settings")}finally{S(!1),setTimeout(()=>o(""),3e3)}},R=async s=>{C(t=>({...t,[s.id]:!0}));try{await x(`/api/stats/achievements/${s.id}`,{method:"PUT",body:{points_reward:s.points_reward}})}catch{}finally{C(t=>({...t,[s.id]:!1}))}},T="w-full bg-navy-light border-2 border-[#2a2a4a] text-cream p-3 rounded font-body text-lg placeholder:text-cream/30 focus:border-gold focus:outline-none transition-colors",f=({enabled:s,onChange:t,label:i})=>e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("span",{className:"text-cream font-body text-lg",children:i}),e.jsx("button",{onClick:()=>t(!s),className:"flex-shrink-0","aria-label":`Toggle ${i}`,children:s?e.jsx(q,{size:32,className:"text-emerald"}):e.jsx(U,{size:32,className:"text-cream/30"})})]});return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(D,{size:28,className:"text-gold"}),e.jsx("h1",{className:"font-heading text-gold text-xs sm:text-sm leading-relaxed",children:"Settings"})]}),r&&e.jsxs("div",{className:"game-panel p-8 text-center",children:[e.jsx(L,{size:48,className:"text-crimson/30 mx-auto mb-4"}),e.jsx("p",{className:"text-crimson font-body text-lg",children:r}),e.jsx("p",{className:"text-cream/30 text-sm mt-2 font-body",children:"Only guild leaders may alter the realm's configuration."})]}),N&&!r&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(g,{size:32,className:"text-gold animate-spin"})}),!N&&!r&&c&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"game-panel p-5",children:[e.jsx("h2",{className:"font-heading text-gold/80 text-[10px] mb-3 tracking-wide",children:"Feature Toggles"}),e.jsxs("div",{className:"divide-y divide-[#2a2a4a]",children:[e.jsx(f,{enabled:c.leaderboard_enabled??!0,onChange:s=>m("leaderboard_enabled",s),label:"Leaderboard"}),e.jsx(f,{enabled:c.spin_wheel_enabled??!0,onChange:s=>m("spin_wheel_enabled",s),label:"Spin Wheel"}),e.jsx(f,{enabled:c.chore_trading_enabled??!0,onChange:s=>m("chore_trading_enabled",s),label:"Chore Trading"})]})]}),e.jsxs("div",{className:"game-panel p-5",children:[e.jsx("h2",{className:"font-heading text-gold/80 text-[10px] mb-3 tracking-wide",children:"Daily Reset Hour"}),e.jsx("p",{className:"text-cream/40 text-sm font-body mb-3",children:"Hour of day (0-23) when daily quests reset."}),e.jsx("input",{type:"number",min:0,max:23,value:c.daily_reset_hour??0,onChange:s=>{const t=Math.min(23,Math.max(0,parseInt(s.target.value,10)||0));m("daily_reset_hour",t)},className:T+" max-w-[120px]"})]}),e.jsxs("button",{onClick:O,disabled:p,className:"game-btn game-btn-gold flex items-center gap-2",children:[p?e.jsx(g,{size:14,className:"animate-spin"}):e.jsx(P,{size:14}),p?"Saving...":"Save Settings"]}),u&&e.jsx("p",{className:`text-sm ${u.includes("!")?"text-emerald":"text-crimson"}`,children:u}),e.jsxs("div",{className:"game-panel p-5",children:[e.jsxs("h2",{className:"font-heading text-gold/80 text-[10px] mb-3 tracking-wide flex items-center gap-2",children:[e.jsx(H,{size:16,className:"text-gold/60"}),"Achievement Point Values"]}),M?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(g,{size:20,className:"text-gold animate-spin"})}):w.length===0?e.jsx("p",{className:"text-cream/30 text-sm font-body",children:"No achievements configured yet."}):e.jsx("div",{className:"space-y-3",children:w.map(s=>e.jsxs("div",{className:"flex items-center gap-3 py-2 border-b border-[#2a2a4a] last:border-0",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-cream font-body text-lg truncate",children:s.title||s.name}),s.description&&e.jsx("p",{className:"text-cream/30 text-sm font-body truncate",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("input",{type:"number",min:0,value:s.points_reward??0,onChange:t=>{const i=parseInt(t.target.value,10)||0;b(l=>l.map(y=>y.id===s.id?{...y,points_reward:i}:y))},className:T+" !w-24 !p-2 text-center"}),e.jsx("button",{onClick:()=>R(s),disabled:k[s.id],className:"game-btn game-btn-blue !py-2 !px-3",title:"Save",children:k[s.id]?e.jsx(g,{size:12,className:"animate-spin"}):e.jsx(P,{size:12})})]})]},s.id))})]}),(n==null?void 0:n.role)==="admin"&&e.jsxs("div",{className:"game-panel p-5 text-center",children:[e.jsx("p",{className:"text-cream/40 text-sm font-body mb-3",children:"Need advanced controls?"}),e.jsxs("button",{onClick:()=>F("/admin"),className:"game-btn game-btn-purple",children:[e.jsx(L,{size:14,className:"inline mr-2"}),"Admin Dashboard"]})]})]})]})}export{J as default};
