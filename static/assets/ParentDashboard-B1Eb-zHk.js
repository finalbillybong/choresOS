import{u as H,a as J,r as n,b as o,j as e,A as W}from"./index-DbTTv7ag.js";import{M as Y}from"./Modal-Bj2NyloF.js";import{L as f}from"./loader-circle-Bxpi28eJ.js";import{U as Z}from"./users-RQONTk5_.js";import{T as ee}from"./triangle-alert-D4S9KrDU.js";import{m as v}from"./proxy-B1EfiGkW.js";import{S as se}from"./star-Dh13X_k5.js";import{F as te}from"./flame-Y6z8Oy63.js";import{C as O}from"./circle-check-DW88RjrA.js";import{C as ae}from"./circle-x-CUqGH7ad.js";import{P as ne}from"./plus-CMcvfJKm.js";import{S as ie}from"./sparkles-BD2igUkn.js";import"./index-B4Vs-Szk.js";const le={hidden:{opacity:0,y:16},visible:N=>({opacity:1,y:0,transition:{delay:N*.08,type:"spring",stiffness:260,damping:24}})},re={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.3}}};function ve(){const{user:N}=H(),R=J(),[p,D]=n.useState([]),[w,F]=n.useState([]),[S,X]=n.useState([]),[K,L]=n.useState(!0),[C,m]=n.useState(null),[g,T]=n.useState({}),[V,u]=n.useState(!1),[y,P]=n.useState(""),[A,_]=n.useState(""),[b,k]=n.useState(""),[z,$]=n.useState(!1),[B,c]=n.useState(""),i=n.useCallback(async()=>{try{m(null);const[s,t,a]=await Promise.all([o("/api/stats/family"),o("/api/rewards/redemptions?status=pending"),o("/api/calendar")]);D(s),F(t);const l=new Date().toISOString().slice(0,10),h=(a.days&&a.days[l]||[]).filter(x=>{var E;return x.status==="completed"&&((E=x.chore)==null?void 0:E.requires_photo)});X(h)}catch(s){m(s.message||"Failed to load family data")}finally{L(!1)}},[]);n.useEffect(()=>{i()},[i]),n.useEffect(()=>{const s=()=>{i()};return window.addEventListener("ws:message",s),()=>window.removeEventListener("ws:message",s)},[i]);const d=(s,t)=>{T(a=>({...a,[s]:t}))},M=async s=>{const t=`verify-${s}`;d(t,!0);try{await o(`/api/chores/${s}/verify`,{method:"POST"}),await i()}catch(a){m(a.message||"Failed to verify chore")}finally{d(t,!1)}},q=async s=>{const t=`approve-${s}`;d(t,!0);try{await o(`/api/rewards/redemptions/${s}/approve`,{method:"POST"}),await i()}catch(a){m(a.message||"Failed to approve redemption")}finally{d(t,!1)}},I=async s=>{const t=`deny-${s}`;d(t,!0);try{await o(`/api/rewards/redemptions/${s}/deny`,{method:"POST"}),await i()}catch(a){m(a.message||"Failed to deny redemption")}finally{d(t,!1)}},U=async()=>{if(c(""),!y){c("Select a kid");return}const s=parseInt(A,10);if(!s||s<=0){c("Enter a positive XP amount");return}if(!b.trim()){c("Enter a description");return}$(!0);try{await o(`/api/points/${y}/bonus`,{method:"POST",body:{amount:s,description:b.trim()}}),P(""),_(""),k(""),u(!1),await i()}catch(t){c(t.message||"Failed to award bonus XP")}finally{$(!1)}};function G({completed:s,total:t}){const a=t>0?Math.round(s/t*100):0;return e.jsx("div",{className:"w-full bg-navy rounded-full h-2.5 overflow-hidden",children:e.jsx(v.div,{className:"h-full bg-emerald rounded-full",initial:{width:0},animate:{width:`${a}%`},transition:{duration:.6,ease:"easeOut"}})})}if(K)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(f,{className:"animate-spin text-gold",size:32})});const Q=w.length>0||S.length>0,j="w-full bg-navy border-2 border-[#2a2a4a] text-cream p-3 rounded font-body text-lg placeholder:text-cream/30 focus:border-gold focus:outline-none transition-colors";return e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h1",{className:"font-heading text-gold text-base sm:text-lg leading-relaxed",children:"Family Overview"}),e.jsxs("div",{className:"flex items-center gap-1 text-cream/40",children:[e.jsx(Z,{size:18}),e.jsxs("span",{className:"font-body text-base",children:[p.length," kids"]})]})]}),C&&e.jsxs("div",{className:"game-panel p-3 flex items-center gap-2 border-crimson/40 text-crimson text-base",children:[e.jsx(ee,{size:18}),e.jsx("span",{children:C})]}),p.length===0?e.jsx("div",{className:"game-panel p-8 text-center",children:e.jsx("p",{className:"font-heading text-cream/50 text-[11px] leading-relaxed",children:"No kids in your family yet."})}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:p.map((s,t)=>e.jsxs(v.div,{className:"game-panel p-4",variants:le,initial:"hidden",animate:"visible",custom:t,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(W,{config:s.avatar_config,size:"md",name:s.display_name}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-heading text-cream text-[11px] leading-relaxed truncate",children:s.display_name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gold font-body text-base",children:[e.jsx(se,{size:14,fill:"currentColor"}),s.points_balance.toLocaleString()," XP"]}),s.current_streak>0&&e.jsxs("span",{className:"flex items-center gap-1 text-orange-400 font-body text-base",children:[e.jsx(te,{size:14,fill:"currentColor"}),s.current_streak]})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-cream/60 font-body text-base",children:"Today"}),e.jsxs("span",{className:"text-cream font-body text-base",children:[s.today_completed,"/",s.today_total," quests"]})]}),e.jsx(G,{completed:s.today_completed,total:s.today_total})]})]},s.id))}),Q&&e.jsxs(v.section,{variants:re,initial:"hidden",animate:"visible",children:[e.jsx("h2",{className:"font-heading text-gold text-xs mb-3",children:"Pending Approvals"}),e.jsxs("div",{className:"space-y-3",children:[S.map(s=>{var l,r;const t=`verify-${s.chore_id}`,a=g[t];return e.jsxs("div",{className:"game-panel p-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-cream font-body text-lg truncate",children:((l=s.chore)==null?void 0:l.title)||"Chore"}),e.jsxs("p",{className:"text-cream/50 font-body text-base",children:["by ",((r=s.user)==null?void 0:r.display_name)||"Kid"," · Photo verification"]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsx("button",{className:"game-btn game-btn-gold !px-3 !py-2",disabled:a,onClick:()=>M(s.chore_id),children:a?e.jsx(f,{size:14,className:"animate-spin"}):e.jsx(O,{size:16})})})]},`chore-${s.id}`)}),w.map(s=>{var h,x;const t=`approve-${s.id}`,a=`deny-${s.id}`,l=g[t],r=g[a];return e.jsxs("div",{className:"game-panel p-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-cream font-body text-lg truncate",children:((h=s.reward)==null?void 0:h.title)||"Reward"}),e.jsxs("p",{className:"text-cream/50 font-body text-base",children:["by ",((x=s.user)==null?void 0:x.display_name)||"Kid"," ·"," ",s.points_spent," XP"]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{className:"game-btn game-btn-gold !px-3 !py-2",disabled:l||r,onClick:()=>q(s.id),title:"Approve",children:l?e.jsx(f,{size:14,className:"animate-spin"}):e.jsx(O,{size:16})}),e.jsx("button",{className:"game-btn game-btn-red !px-3 !py-2",disabled:l||r,onClick:()=>I(s.id),title:"Deny",children:r?e.jsx(f,{size:14,className:"animate-spin"}):e.jsx(ae,{size:16})})]})]},`redemption-${s.id}`)})]})]}),e.jsxs("section",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsxs("button",{className:"game-btn game-btn-blue flex items-center gap-2 justify-center flex-1",onClick:()=>R("/chores"),children:[e.jsx(ne,{size:16}),"Create Quest"]}),e.jsxs("button",{className:"game-btn game-btn-purple flex items-center gap-2 justify-center flex-1",onClick:()=>{c(""),u(!0)},children:[e.jsx(ie,{size:16}),"Award Bonus XP"]})]}),e.jsx(Y,{isOpen:V,onClose:()=>u(!1),title:"Award Bonus XP",actions:[{label:"Cancel",onClick:()=>u(!1),className:"game-btn game-btn-red"},{label:z?"Awarding...":"Award XP",onClick:U,disabled:z,className:"game-btn game-btn-gold"}],children:e.jsxs("div",{className:"space-y-4",children:[B&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-base text-center",children:B}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-2 tracking-wide",children:"Select Kid"}),e.jsxs("select",{value:y,onChange:s=>P(s.target.value),className:j,children:[e.jsx("option",{value:"",children:"-- Choose --"}),p.map(s=>e.jsx("option",{value:s.id,children:s.display_name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-2 tracking-wide",children:"XP Amount"}),e.jsx("input",{type:"number",min:"1",value:A,onChange:s=>_(s.target.value),placeholder:"50",className:j})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-2 tracking-wide",children:"Reason"}),e.jsx("input",{type:"text",value:b,onChange:s=>k(s.target.value),placeholder:"Great job helping out!",className:j})]})]})})]})}export{ve as default};
