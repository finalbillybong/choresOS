import{c as G,u as H,r as s,b as g,j as e,G as K}from"./index-DbTTv7ag.js";import{M as Y}from"./Modal-Bj2NyloF.js";import{S as i}from"./star-Dh13X_k5.js";import{P as B}from"./plus-CMcvfJKm.js";import{L as V}from"./loader-circle-Bxpi28eJ.js";import{C as X}from"./check-DEAd96l7.js";import{T as J}from"./trash-2-CFkNW02I.js";import"./index-B4Vs-Szk.js";import"./proxy-B1EfiGkW.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=G("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);function oe(){const{user:f}=H(),n=(f==null?void 0:f.role)==="kid",[b,w]=s.useState([]),[j,C]=s.useState(!0),[k,o]=s.useState(""),[S,N]=s.useState(!1),[c,E]=s.useState(""),[v,z]=s.useState(""),[y,L]=s.useState(""),[A,W]=s.useState(!1),[O,d]=s.useState(!1),[m,R]=s.useState(null),[M,P]=s.useState(""),[T,I]=s.useState(!1),[_,x]=s.useState(""),h=s.useCallback(async()=>{C(!0),o("");try{const t=await g("/api/wishlist");w(t.items||t||[])}catch(t){o(t.message||"Failed to load wishlist")}finally{C(!1)}},[]);s.useEffect(()=>{h()},[h]);const q=async()=>{if(c.trim()){W(!0);try{const t={title:c.trim()};v.trim()&&(t.url=v.trim()),y.trim()&&(t.notes=y.trim()),await g("/api/wishlist",{method:"POST",body:t}),E(""),z(""),L(""),N(!1),h()}catch(t){o(t.message||"Failed to add item")}finally{W(!1)}}},U=async t=>{try{await g(`/api/wishlist/${t}`,{method:"DELETE"}),w(a=>a.filter(l=>l.id!==t))}catch(a){o(a.message||"Failed to delete item")}},$=t=>{R(t),P(""),x(""),d(!0)},D=async()=>{const t=parseInt(M,10);if(!t||t<=0){x("Enter a valid point cost");return}I(!0),x("");try{await g(`/api/wishlist/${m.id}/convert`,{method:"POST",body:{point_cost:t}}),d(!1),h()}catch(a){x(a.message||"Conversion failed")}finally{I(!1)}},r={};n||b.forEach(t=>{const a=t.user_display_name||t.username||t.user_id||"Unknown Hero";r[a]||(r[a]=[]),r[a].push(t)});const p="w-full bg-navy-light border-2 border-[#2a2a4a] text-cream p-3 rounded font-body text-lg placeholder:text-cream/30 focus:border-gold focus:outline-none transition-colors",F=(t,a=!1,l=!1)=>{const u=t.converted||t.reward_id;return e.jsxs("div",{className:`game-panel p-4 flex items-start gap-3 ${u?"!border-emerald/40":""}`,children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:u?e.jsx(X,{size:18,className:"text-emerald"}):e.jsx(i,{size:18,className:"text-gold/60"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-cream font-body text-lg leading-tight",children:t.title}),t.url&&e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-sky text-sm font-body flex items-center gap-1 mt-1 hover:text-sky/80 transition-colors",children:[e.jsx(Q,{size:12}),e.jsx("span",{className:"truncate",children:t.url})]}),t.notes&&e.jsx("p",{className:"text-cream/40 text-sm font-body mt-1",children:t.notes}),u&&e.jsx("span",{className:"inline-block mt-1 text-emerald text-[10px] font-heading",children:"Converted to Reward"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[l&&!u&&e.jsx("button",{onClick:()=>$(t),className:"game-btn game-btn-purple !py-2 !px-3 !text-[8px]",title:"Convert to Reward",children:e.jsx(K,{size:14})}),a&&e.jsx("button",{onClick:()=>U(t.id),className:"p-2 rounded hover:bg-crimson/10 text-crimson/60 hover:text-crimson transition-colors",title:"Delete",children:e.jsx(J,{size:16})})]})]},t.id)};return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{size:28,className:"text-gold"}),e.jsx("h1",{className:"font-heading text-gold text-xs sm:text-sm leading-relaxed",children:"Wish List"})]}),n&&e.jsxs("button",{onClick:()=>N(!S),className:"game-btn game-btn-gold flex items-center gap-2",children:[e.jsx(B,{size:14}),"Add Wish"]})]}),k&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-base text-center",children:k}),n&&S&&e.jsxs("div",{className:"game-panel p-5 mb-6 space-y-3",children:[e.jsx("h3",{className:"font-heading text-gold/80 text-[10px] tracking-wide mb-3",children:"New Wish"}),e.jsx("input",{type:"text",value:c,onChange:t=>E(t.target.value),placeholder:"What do you wish for?",className:p}),e.jsx("input",{type:"url",value:v,onChange:t=>z(t.target.value),placeholder:"Link (optional)",className:p}),e.jsx("textarea",{value:y,onChange:t=>L(t.target.value),placeholder:"Notes (optional)",rows:2,className:p+" resize-none"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>N(!1),className:"game-btn game-btn-red",children:"Cancel"}),e.jsx("button",{onClick:q,disabled:A||!c.trim(),className:"game-btn game-btn-gold",children:A?"Adding...":"Add Wish"})]})]}),j&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(V,{size:32,className:"text-gold animate-spin"})}),!j&&n&&e.jsx("div",{className:"space-y-3",children:b.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(i,{size:48,className:"text-cream/10 mx-auto mb-4"}),e.jsx("p",{className:"font-heading text-cream/30 text-[10px]",children:"Your wish list is empty"}),e.jsx("p",{className:"text-cream/20 font-body text-base mt-2",children:"Every hero has dreams. Add your first wish!"})]}):b.map(t=>F(t,!0,!1))}),!j&&!n&&e.jsx("div",{className:"space-y-8",children:Object.keys(r).length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(i,{size:48,className:"text-cream/10 mx-auto mb-4"}),e.jsx("p",{className:"font-heading text-cream/30 text-[10px]",children:"No wishes yet"}),e.jsx("p",{className:"text-cream/20 font-body text-base mt-2",children:"Your heroes haven't made any wishes yet. Encourage them to dream!"})]}):Object.entries(r).map(([t,a])=>e.jsxs("div",{children:[e.jsxs("h2",{className:"font-heading text-purple text-[10px] mb-3 tracking-wide flex items-center gap-2",children:[e.jsx(i,{size:14,className:"text-purple/60"}),t,"'s Wishes"]}),e.jsx("div",{className:"space-y-3",children:a.map(l=>F(l,!1,!0))})]},t))}),e.jsx(Y,{isOpen:O,onClose:()=>d(!1),title:"Convert to Reward",actions:[{label:"Cancel",onClick:()=>d(!1),className:"game-btn game-btn-red"},{label:T?"Converting...":"Convert",onClick:D,className:"game-btn game-btn-gold",disabled:T}],children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-cream/80 text-base",children:["Convert"," ",e.jsx("span",{className:"text-gold font-heading text-[10px]",children:m==null?void 0:m.title})," ","into a redeemable reward:"]}),_&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-sm",children:_}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-2 tracking-wide",children:"Point Cost (XP)"}),e.jsx("input",{type:"number",min:"1",value:M,onChange:t=>P(t.target.value),placeholder:"e.g. 500",className:p})]})]})})]})}export{oe as default};
