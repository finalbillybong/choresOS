import{r as o,j as e,b as T,u as q,a as W}from"./index-CRKPRXQ3.js";import{S as O}from"./star-COuSHzAw.js";import{m as k}from"./proxy-DAeV9c_I.js";import{F as D}from"./flame-B2RnXyBV.js";import{A as F}from"./index-C7kt0K0A.js";import{L as B}from"./loader-circle-C0n6L0S0.js";import{T as V}from"./triangle-alert-C2D6ueye.js";import{S as G}from"./sword-Ct97b-ux.js";import{C as U}from"./chevron-right-D69rsMGZ.js";import{C as X}from"./camera-9YqBEvF5.js";function K({value:t=0,prefix:r="XP"}){const[a,n]=o.useState(t),s=o.useRef(t),m=o.useRef(null);return o.useEffect(()=>{const x=s.current,u=t;if(s.current=t,x===u){n(u);return}const w=u-x,y=Math.min(Math.abs(w)*15,1500),S=performance.now();function g(M){const z=M-S,N=Math.min(z/y,1),d=1-Math.pow(1-N,3),A=Math.round(x+w*d);n(A),N<1&&(m.current=requestAnimationFrame(g))}return m.current=requestAnimationFrame(g),()=>{m.current&&cancelAnimationFrame(m.current)}},[t]),e.jsxs("div",{className:"inline-flex items-center gap-1.5",children:[e.jsx(O,{size:16,className:"text-gold fill-gold"}),e.jsxs("span",{className:"font-heading text-gold text-sm font-bold tabular-nums",children:[a.toLocaleString()," ",r]})]})}const H={scale:[1,1.1,.97,1.05,1],rotate:[-1,2,-2,1,0],transition:{duration:1,repeat:1/0,repeatType:"mirror",ease:"easeInOut"}};function Q(t){return t>=30?{size:28,className:"text-orange-400 drop-shadow-[0_0_8px_rgba(251,146,60,0.5)]"}:t>=7?{size:22,className:"text-orange-400"}:{size:18,className:"text-orange-400/70"}}function Y({streak:t=0,longest:r=0}){const[a,n]=o.useState(!1),s=Q(t),m=t>=30;return e.jsxs("div",{className:"relative inline-flex items-center gap-1",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[m?e.jsx(k.div,{animate:H,className:"flex items-center",children:e.jsx(D,{size:s.size,className:s.className})}):e.jsx(D,{size:s.size,className:s.className}),e.jsx("span",{className:"font-bold text-orange-400 text-sm tabular-nums",children:t}),a&&e.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-surface-raised border border-border rounded-lg text-center whitespace-nowrap z-10 shadow-lg",children:[e.jsxs("p",{className:"text-cream text-xs font-medium",children:[t," day streak"]}),e.jsxs("p",{className:"text-muted text-[10px]",children:["Best: ",r]}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-l-[5px] border-l-transparent border-r-[5px] border-r-transparent border-t-[5px] border-t-border"})]})]})}const _=["#3b82f6","#10b981","#f59e0b","#a855f7","#ef4444","#60a5fa"],Z=30,I=3;function P(t,r){return Math.random()*(r-t)+t}function J(){return Array.from({length:Z},(t,r)=>{const a=P(0,Math.PI*2),n=P(200,500),s=P(6,14),m=Math.random()>.5?"circle":"rect";return{id:r,color:_[Math.floor(Math.random()*_.length)],x:Math.cos(a)*n,y:Math.sin(a)*n,rotation:P(0,720),size:s,shape:m}})}function $({onComplete:t}){const[r,a]=o.useState(!0),n=o.useMemo(()=>J(),[]);return o.useEffect(()=>{const s=setTimeout(()=>{a(!1),t==null||t()},I*1e3);return()=>clearTimeout(s)},[t]),e.jsx(F,{children:r&&e.jsx("div",{className:"fixed inset-0 z-[100] pointer-events-none overflow-hidden",children:n.map(s=>e.jsx(k.div,{className:"absolute",style:{left:"50%",top:"40%",width:s.shape==="circle"?s.size:s.size*.7,height:s.size,backgroundColor:s.color,borderRadius:s.shape==="circle"?"50%":"2px"},initial:{x:0,y:0,opacity:1,rotate:0,scale:1},animate:{x:s.x,y:[0,s.y*.4,s.y+300],opacity:[1,1,0],rotate:s.rotation,scale:[1,1.2,.5]},transition:{duration:I,ease:[.25,.46,.45,.94],y:{duration:I,ease:[.22,.61,.36,1]}}},s.id))})})}const R=[{value:1,color:"#ef4444"},{value:5,color:"#f59e0b"},{value:2,color:"#10b981"},{value:10,color:"#a855f7"},{value:3,color:"#3b82f6"},{value:15,color:"#f97316"},{value:1,color:"#ec4899"},{value:25,color:"#f59e0b"},{value:2,color:"#06b6d4"},{value:5,color:"#10b981"},{value:3,color:"#a855f7"},{value:10,color:"#ef4444"}],E=360/R.length;function L(t,r,a,n){const s=(n-90)*Math.PI/180;return{x:t+a*Math.cos(s),y:r+a*Math.sin(s)}}function ee(t,r,a,n,s){const m=L(t,r,a,s),x=L(t,r,a,n),u=s-n<=180?"0":"1";return["M",t,r,"L",m.x,m.y,"A",a,a,0,u,0,x.x,x.y,"Z"].join(" ")}function te({availability:t,onSpinComplete:r}){const[a,n]=o.useState(!1),[s,m]=o.useState(0),[x,u]=o.useState(null),[w,y]=o.useState(!1),[S,g]=o.useState(null),M=o.useRef(!1),z=(t==null?void 0:t.can_spin)??!0,N=(t==null?void 0:t.reason)??null,d=!z,A=o.useCallback(async()=>{if(!(a||d)){n(!0),u(null),g(null);try{const c=await T("/api/spin/spin",{method:"POST"}),h=c.points_won??c.points??c.result??5;let i=R.findIndex(C=>C.value===h);i===-1&&(i=Math.floor(Math.random()*R.length));const b=i*E+E/2,j=5+Math.floor(Math.random()*3),p=s+j*360+(360-b);m(p),setTimeout(()=>{u(h),y(!0),n(!1),M.current=!0,r==null||r(h)},3500)}catch(c){g(c.message||"Spin failed!"),n(!1)}}},[a,d,s,r]),f=150,v=150,l=140;return e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[w&&e.jsx($,{onComplete:()=>y(!1)}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1 z-10",children:e.jsx("div",{className:"w-0 h-0 border-l-[12px] border-l-transparent border-r-[12px] border-r-transparent border-t-[20px] border-t-sky",style:{filter:"drop-shadow(0 2px 6px rgba(59,130,246,0.4))"}})}),e.jsx(k.div,{animate:{rotate:s},transition:{duration:3.5,ease:[.2,.8,.3,1]},className:"w-[300px] h-[300px]",children:e.jsxs("svg",{width:"300",height:"300",viewBox:"0 0 300 300",className:"drop-shadow-xl",children:[e.jsx("circle",{cx:f,cy:v,r:l+4,fill:"none",stroke:"#1e293b",strokeWidth:"4"}),R.map((c,h)=>{const i=h*E,b=i+E,j=i+E/2,p=L(f,v,l*.65,j);return e.jsxs("g",{children:[e.jsx("path",{d:ee(f,v,l,i,b),fill:c.color,stroke:"#0a0e1a",strokeWidth:"2",opacity:d&&!a?.4:.9}),e.jsx("text",{x:p.x,y:p.y,textAnchor:"middle",dominantBaseline:"central",fill:"white",fontFamily:"Inter, system-ui, sans-serif",fontSize:"12",fontWeight:"800",transform:`rotate(${j}, ${p.x}, ${p.y})`,children:c.value})]},h)}),e.jsx("circle",{cx:f,cy:v,r:22,fill:"#111827",stroke:"#1e293b",strokeWidth:"3"}),e.jsx("circle",{cx:f,cy:v,r:10,fill:"#3b82f6"})]})})]}),x!==null&&e.jsxs("div",{className:"game-panel px-6 py-3 text-center",children:[e.jsx("p",{className:"text-muted text-xs",children:"You won"}),e.jsxs("p",{className:"text-gold text-lg font-bold mt-1",children:[x," XP"]})]}),d&&!a&&N&&e.jsx("p",{className:"text-gold text-sm text-center max-w-xs",children:N}),S&&e.jsx("p",{className:"text-crimson text-sm text-center",children:S}),e.jsx("button",{onClick:A,disabled:a||d,className:`game-btn game-btn-blue text-base px-10 py-3 ${a||d?"opacity-50 cursor-not-allowed":""}`,children:a?"SPINNING...":d?"LOCKED":"SPIN!"})]})}function se(){const t=new Date,r=t.getDay(),a=r===0?-6:1-r,n=new Date(t);return n.setDate(t.getDate()+a),n.toISOString().slice(0,10)}function ae(){return new Date().toISOString().slice(0,10)}function ne(t){switch(t){case"easy":return{text:"Easy",color:"text-emerald bg-emerald/10 border-emerald/20"};case"medium":return{text:"Medium",color:"text-gold bg-gold/10 border-gold/20"};case"hard":return{text:"Hard",color:"text-orange-400 bg-orange-400/10 border-orange-400/20"};case"expert":return{text:"Expert",color:"text-crimson bg-crimson/10 border-crimson/20"};default:return{text:"Easy",color:"text-emerald bg-emerald/10 border-emerald/20"}}}const re={hidden:{opacity:0,y:12},visible:t=>({opacity:1,y:0,transition:{delay:t*.05,type:"spring",stiffness:300,damping:28}})};function pe(){const{user:t,updateUser:r}=q(),a=W(),[n,s]=o.useState([]),[m,x]=o.useState([]),[u,w]=o.useState(null),[y,S]=o.useState(!0),[g,M]=o.useState(null),[z,N]=o.useState(!1),d=o.useCallback(async()=>{try{M(null);const l=se(),c=ae(),[h,i,b]=await Promise.all([T("/api/chores"),T(`/api/calendar?week_start=${l}`),T("/api/spin/availability")]);x(h);const j=i.days&&i.days[c]||[];s(j),w(b)}catch(l){M(l.message||"Failed to load quest data")}finally{S(!1)}},[]);if(o.useEffect(()=>{d()},[d]),o.useEffect(()=>{const l=()=>{d()};return window.addEventListener("ws:message",l),()=>window.removeEventListener("ws:message",l)},[d]),y)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(B,{className:"animate-spin text-sky",size:28})});const A=n.filter(l=>l.status==="verified"||l.status==="completed").length,f=n.length,v=f>0?Math.round(A/f*100):0;return e.jsxs("div",{className:"max-w-2xl mx-auto space-y-5",children:[e.jsx(F,{children:z&&e.jsx($,{onComplete:()=>N(!1)})}),e.jsxs("div",{className:"game-panel p-5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap mb-4",children:[e.jsx("h1",{className:"font-heading text-cream text-xl font-extrabold",children:"Quest Board"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{value:(t==null?void 0:t.points_balance)??0}),e.jsx(Y,{streak:(t==null?void 0:t.current_streak)??0})]})]}),f>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("span",{className:"text-muted text-xs font-medium",children:"Today's Progress"}),e.jsxs("span",{className:"text-cream text-xs font-bold",children:[A,"/",f]})]}),e.jsx("div",{className:"xp-bar",children:e.jsx(k.div,{className:"xp-bar-fill",initial:{width:0},animate:{width:`${v}%`},transition:{duration:.8,ease:[.22,1,.36,1]}})})]})]}),g&&e.jsxs("div",{className:"game-panel p-3 flex items-center gap-2 border-crimson/30 text-crimson text-sm",children:[e.jsx(V,{size:16}),e.jsx("span",{children:g})]}),(()=>{const l=n.filter(c=>c.status==="pending"||c.status==="assigned");return l.length===0&&!y?e.jsxs(k.div,{className:"game-panel p-10 flex flex-col items-center gap-3 text-center",initial:{opacity:0,y:12},animate:{opacity:1,y:0},children:[e.jsx(G,{size:36,className:"text-muted"}),e.jsx("p",{className:"text-muted text-sm",children:n.length===0?"No quests for today. Take a break!":"All quests complete! Time to spin the wheel!"})]}):e.jsx("div",{className:"space-y-3",children:l.map((c,h)=>{var p,C;const i=c.chore;if(!i)return null;const b=ne(i.difficulty),j=((p=i.category)==null?void 0:p.colour)||"#3b82f6";return e.jsx(k.div,{className:"game-panel p-4 transition-all cursor-pointer hover:border-sky/40",variants:re,initial:"hidden",animate:"visible",custom:h,onClick:()=>a(`/chores/${i.id}`),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 w-1 h-12 rounded-full flex-shrink-0",style:{backgroundColor:j}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1.5",children:[e.jsx("h3",{className:"text-cream text-sm font-semibold truncate",children:i.title}),e.jsx(U,{size:16,className:"text-muted flex-shrink-0"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-gold text-xs font-semibold",children:[e.jsx(O,{size:12,fill:"currentColor"}),i.points," XP"]}),e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold border ${b.color}`,children:b.text}),((C=i.category)==null?void 0:C.name)&&e.jsx("span",{className:"text-muted text-xs",children:i.category.name}),i.requires_photo&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-muted text-xs",children:[e.jsx(X,{size:10}),"Photo"]})]})]})]})},c.id)})})})(),e.jsx("div",{className:"pt-2",children:e.jsx(te,{availability:u,onSpinComplete:()=>{d()}})})]})}export{pe as default};
