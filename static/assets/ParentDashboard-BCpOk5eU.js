import{u as U,a as G,c as H,r as a,b as l,j as e,d as b,A as J,e as W}from"./index-DNIywqZZ.js";import{t as Y}from"./questThemeText-BK2D7k-h.js";import{M as Z}from"./Modal-CXOHEPT9.js";import{U as ee}from"./users-CcC0dEo-.js";import{T as se}from"./triangle-alert-Bnh4vArX.js";import{m as y}from"./proxy-pUA5QpF8.js";import{S as te}from"./star-B3_Vd0i4.js";import{F as ae}from"./flame-CvdkfdtY.js";import{C as ie}from"./camera-iIMA5gvZ.js";import{C as ne}from"./circle-check-BUZ521bp.js";import{C as re}from"./circle-x-D8wXlpA5.js";import{P as le}from"./plus-B2UCsRcR.js";import"./index-D52oPGzx.js";const oe={hidden:{opacity:0,y:12},visible:g=>({opacity:1,y:0,transition:{delay:g*.06,type:"spring",stiffness:300,damping:28}})},ce={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.25}}};function Ce(){const{user:g}=U(),u=G(),{colorTheme:X}=H(),[o,F]=a.useState([]),[v,O]=a.useState([]),[V,L]=a.useState(!0),[N,c]=a.useState(null),[C,R]=a.useState({}),[D,m]=a.useState(!1),[h,w]=a.useState(""),[S,_]=a.useState(""),[f,P]=a.useState(""),[A,k]=a.useState(!1),[z,r]=a.useState(""),n=a.useCallback(async()=>{try{c(null);const[s,t]=await Promise.all([l("/api/stats/family"),l("/api/calendar")]);F(s);const i=new Date().toISOString().slice(0,10),x=(t.days&&t.days[i]||[]).filter(p=>p.status==="completed");O(x)}catch(s){c(s.message||"Failed to load family data")}finally{L(!1)}},[]);a.useEffect(()=>{n()},[n]),a.useEffect(()=>{const s=()=>{n()};return window.addEventListener("ws:message",s),()=>window.removeEventListener("ws:message",s)},[n]);const d=(s,t)=>{R(i=>({...i,[s]:t}))},K=async s=>{const t=`verify-${s}`;d(t,!0);try{await l(`/api/chores/${s}/verify`,{method:"POST"}),await n()}catch(i){c(i.message||"Failed to verify chore")}finally{d(t,!1)}},M=async s=>{const t=`reject-${s}`;d(t,!0);try{await l(`/api/chores/${s}/uncomplete`,{method:"POST"}),await n()}catch(i){c(i.message||"Failed to reject chore")}finally{d(t,!1)}},I=async()=>{if(r(""),!h){r("Select a kid");return}const s=parseInt(S,10);if(!s||s<=0){r("Enter a positive XP amount");return}if(!f.trim()){r("Enter a description");return}k(!0);try{await l(`/api/points/${h}/bonus`,{method:"POST",body:{amount:s,description:f.trim()}}),w(""),_(""),P(""),m(!1),await n()}catch(t){r(t.message||"Failed to award bonus XP")}finally{k(!1)}};function q({completed:s,total:t}){const i=t>0?Math.round(s/t*100):0;return e.jsx("div",{className:"xp-bar",children:e.jsx(y.div,{className:"xp-bar-fill",initial:{width:0},animate:{width:`${i}%`},transition:{duration:.6,ease:[.22,1,.36,1]}})})}if(V)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(b,{className:"animate-spin text-sky",size:28})});const Q=v.length>0;return e.jsxs("div",{className:"max-w-3xl mx-auto space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h1",{className:"font-heading text-cream text-xl font-extrabold",children:"Family Overview"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-muted text-sm",children:[e.jsx(ee,{size:16}),e.jsxs("span",{children:[o.length," members"]})]})]}),N&&e.jsxs("div",{className:"game-panel p-3 flex items-center gap-2 border-crimson/30 text-crimson text-sm",children:[e.jsx(se,{size:16}),e.jsx("span",{children:N})]}),o.length===0?e.jsx("div",{className:"game-panel p-10 text-center",children:e.jsx("p",{className:"text-muted text-sm",children:"No kids in your family yet."})}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:o.map((s,t)=>e.jsxs(y.div,{className:"game-panel p-4 cursor-pointer hover:border-sky/40 transition-colors",variants:oe,initial:"hidden",animate:"visible",custom:t,onClick:()=>u(`/kids/${s.id}`),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(J,{config:s.avatar_config,size:"md",name:s.display_name}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-cream text-sm font-semibold truncate",children:s.display_name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-gold text-xs font-semibold",children:[e.jsx(te,{size:12,fill:"currentColor"}),s.points_balance.toLocaleString()," XP"]}),s.current_streak>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-orange-400 text-xs font-semibold",children:[e.jsx(ae,{size:12,fill:"currentColor"}),s.current_streak]})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-muted",children:"Today"}),e.jsxs("span",{className:"text-cream font-medium",children:[s.today_completed,"/",s.today_total," quests"]})]}),e.jsx(q,{completed:s.today_completed,total:s.today_total})]})]},s.id))}),Q&&e.jsxs(y.section,{variants:ce,initial:"hidden",animate:"visible",children:[e.jsx("h2",{className:"text-cream text-base font-bold mb-3",children:"Pending Quest Verifications"}),e.jsx("div",{className:"space-y-3",children:v.map(s=>{var B,$,E,T;const t=`verify-${s.chore_id}`,i=`reject-${s.chore_id}`,j=C[t],x=C[i],p=j||x;return e.jsxs("div",{className:"game-panel p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-cream text-sm font-medium truncate cursor-pointer hover:text-sky transition-colors",onClick:()=>u(`/chores/${s.chore_id}`),children:Y(((B=s.chore)==null?void 0:B.title)||"Chore",X)}),e.jsxs("p",{className:"text-muted text-xs mt-0.5",children:["by ",(($=s.user)==null?void 0:$.display_name)||"Kid",((E=s.chore)==null?void 0:E.requires_photo)&&e.jsxs("span",{className:"inline-flex items-center gap-1 ml-2 text-sky",children:[e.jsx(ie,{size:10})," Photo"]}),e.jsxs("span",{className:"ml-2 text-gold font-medium",children:["+",(T=s.chore)==null?void 0:T.points," XP"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{className:"game-btn game-btn-blue !px-3 !py-2",disabled:p,onClick:()=>K(s.chore_id),title:"Approve",children:j?e.jsx(b,{size:14,className:"animate-spin"}):e.jsx(ne,{size:16})}),e.jsx("button",{className:"game-btn game-btn-red !px-3 !py-2",disabled:p,onClick:()=>M(s.chore_id),title:"Reject",children:x?e.jsx(b,{size:14,className:"animate-spin"}):e.jsx(re,{size:16})})]})]}),s.photo_proof_path&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:`/api/uploads/${s.photo_proof_path}`,alt:"Photo proof",className:"rounded-lg max-h-48 object-cover border border-border"})})]},`chore-${s.id}`)})})]}),e.jsxs("section",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsxs("button",{className:"game-btn game-btn-blue flex items-center gap-2 justify-center flex-1",onClick:()=>u("/chores"),children:[e.jsx(le,{size:16}),"Create Quest"]}),e.jsxs("button",{className:"game-btn game-btn-purple flex items-center gap-2 justify-center flex-1",onClick:()=>{r(""),m(!0)},children:[e.jsx(W,{size:16}),"Award Bonus XP"]})]}),e.jsx(Z,{isOpen:D,onClose:()=>m(!1),title:"Award Bonus XP",actions:[{label:"Cancel",onClick:()=>m(!1),className:"game-btn game-btn-red"},{label:A?"Awarding...":"Award XP",onClick:I,disabled:A,className:"game-btn game-btn-gold"}],children:e.jsxs("div",{className:"space-y-4",children:[z&&e.jsx("div",{className:"p-2 rounded-lg border border-crimson/30 bg-crimson/10 text-crimson text-sm text-center",children:z}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream/80 text-sm font-medium mb-1.5",children:"Select Kid"}),e.jsxs("select",{value:h,onChange:s=>w(s.target.value),className:"field-input",children:[e.jsx("option",{value:"",children:"-- Choose --"}),o.map(s=>e.jsx("option",{value:s.id,children:s.display_name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream/80 text-sm font-medium mb-1.5",children:"XP Amount"}),e.jsx("input",{type:"number",min:"1",value:S,onChange:s=>_(s.target.value),placeholder:"50",className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream/80 text-sm font-medium mb-1.5",children:"Reason"}),e.jsx("input",{type:"text",value:f,onChange:s=>P(s.target.value),placeholder:"Great job helping out!",className:"field-input"})]})]})})]})}export{Ce as default};
