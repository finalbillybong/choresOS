import{c as C,u as K,r as a,j as e,b as y}from"./index-DbTTv7ag.js";import{M as E}from"./Modal-Bj2NyloF.js";import{S as A}from"./shield-BoUZ_pFx.js";import{U}from"./users-RQONTk5_.js";import{S as L}from"./scroll-text-vAhC9Sw4.js";import{L as S}from"./loader-circle-Bxpi28eJ.js";import{P as M}from"./plus-CMcvfJKm.js";import{T as z}from"./trash-2-CFkNW02I.js";import{C as $}from"./check-DEAd96l7.js";import{C as F,a as P}from"./chevron-right-BRuSubfb.js";import"./index-B4Vs-Szk.js";import"./proxy-B1EfiGkW.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=C("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=C("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=C("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=C("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=C("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]),q=[{key:"users",label:"Users",icon:U},{key:"api-keys",label:"API Keys",icon:R},{key:"invite-codes",label:"Invite Codes",icon:V},{key:"audit-log",label:"Audit Log",icon:L}];function B(){const[l,c]=a.useState([]),[b,o]=a.useState(!0),[h,r]=a.useState(""),m=a.useCallback(async()=>{o(!0),r("");try{const s=await y("/api/admin/users");c(s.users||s||[])}catch(s){r(s.message||"Failed to load users")}finally{o(!1)}},[]);a.useEffect(()=>{m()},[m]);const g=async(s,d)=>{try{await y(`/api/admin/users/${s}`,{method:"PUT",body:{role:d}}),c(t=>t.map(p=>p.id===s?{...p,role:d}:p))}catch(t){r(t.message||"Failed to update role")}},x=async s=>{try{await y(`/api/admin/users/${s.id}`,{method:"PUT",body:{is_active:!s.is_active}}),c(d=>d.map(t=>t.id===s.id?{...t,is_active:!t.is_active}:t))}catch(d){r(d.message||"Failed to toggle user status")}};return b?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(S,{size:28,className:"text-gold animate-spin"})}):e.jsxs("div",{children:[h&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm",children:h}),l.length===0?e.jsx("p",{className:"text-cream/30 text-center py-8 font-body",children:"No heroes in the realm yet."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-[#2a2a4a]",children:[e.jsx("th",{className:"font-heading text-gold/60 text-[8px] tracking-wider py-3 px-2",children:"Username"}),e.jsx("th",{className:"font-heading text-gold/60 text-[8px] tracking-wider py-3 px-2",children:"Display Name"}),e.jsx("th",{className:"font-heading text-gold/60 text-[8px] tracking-wider py-3 px-2",children:"Role"}),e.jsx("th",{className:"font-heading text-gold/60 text-[8px] tracking-wider py-3 px-2",children:"Status"}),e.jsx("th",{className:"font-heading text-gold/60 text-[8px] tracking-wider py-3 px-2",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-[#2a2a4a]/50",children:l.map(s=>e.jsxs("tr",{className:"hover:bg-[#2a2a4a]/20 transition-colors",children:[e.jsx("td",{className:"py-3 px-2 text-cream font-body text-lg",children:s.username}),e.jsx("td",{className:"py-3 px-2 text-cream/70 font-body text-lg",children:s.display_name||"--"}),e.jsx("td",{className:"py-3 px-2",children:e.jsxs("select",{value:s.role,onChange:d=>g(s.id,d.target.value),className:"bg-navy-light border border-[#2a2a4a] text-cream rounded p-1 font-body text-base focus:border-gold focus:outline-none",children:[e.jsx("option",{value:"kid",children:"kid"}),e.jsx("option",{value:"parent",children:"parent"}),e.jsx("option",{value:"admin",children:"admin"})]})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("span",{className:`inline-block px-2 py-0.5 rounded text-[10px] font-heading ${s.is_active!==!1?"bg-emerald/10 text-emerald border border-emerald/30":"bg-crimson/10 text-crimson border border-crimson/30"}`,children:s.is_active!==!1?"Active":"Inactive"})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("button",{onClick:()=>x(s),className:`game-btn !py-1.5 !px-3 !text-[7px] ${s.is_active!==!1?"game-btn-red":"game-btn-blue"}`,children:s.is_active!==!1?e.jsxs(e.Fragment,{children:[e.jsx(I,{size:12,className:"inline mr-1"}),"Deactivate"]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{size:12,className:"inline mr-1"}),"Activate"]})})})]},s.id))})]})})]})}function H(){const[l,c]=a.useState([]),[b,o]=a.useState(!0),[h,r]=a.useState(""),[m,g]=a.useState(!1),[x,s]=a.useState(""),[d,t]=a.useState(!1),[p,u]=a.useState(""),[f,j]=a.useState(!1),N=a.useCallback(async()=>{o(!0),r("");try{const n=await y("/api/admin/api-keys");c(n.keys||n||[])}catch(n){r(n.message||"Failed to load API keys")}finally{o(!1)}},[]);a.useEffect(()=>{N()},[N]);const w=async()=>{if(x.trim()){t(!0);try{const n=await y("/api/admin/api-keys",{method:"POST",body:{name:x.trim()}});u(n.key||n.api_key||n.token||""),N()}catch(n){r(n.message||"Failed to create key"),g(!1)}finally{t(!1)}}},i=async n=>{try{await y(`/api/admin/api-keys/${n}`,{method:"DELETE"}),c(T=>T.filter(_=>_.id!==n))}catch(T){r(T.message||"Failed to delete key")}},v=async n=>{try{await navigator.clipboard.writeText(n),j(!0),setTimeout(()=>j(!1),2e3)}catch{}},k=()=>{g(!1),s(""),u(""),j(!1)};return b?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(S,{size:28,className:"text-gold animate-spin"})}):e.jsxs("div",{children:[h&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm",children:h}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{onClick:()=>g(!0),className:"game-btn game-btn-gold flex items-center gap-2",children:[e.jsx(M,{size:14}),"Create Key"]})}),l.length===0?e.jsx("p",{className:"text-cream/30 text-center py-8 font-body",children:"No API keys forged yet."}):e.jsx("div",{className:"space-y-3",children:l.map(n=>e.jsxs("div",{className:"game-panel p-4 flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-cream font-body text-lg truncate",children:n.name}),e.jsxs("p",{className:"text-cream/40 text-sm font-body",children:["Prefix: ",e.jsx("span",{className:"text-sky",children:n.prefix||n.key_prefix||"***"}),n.scopes&&e.jsxs("span",{className:"ml-3",children:["Scopes: ",e.jsx("span",{className:"text-purple",children:Array.isArray(n.scopes)?n.scopes.join(", "):n.scopes})]})]})]}),e.jsx("button",{onClick:()=>i(n.id),className:"p-2 rounded hover:bg-crimson/10 text-crimson/60 hover:text-crimson transition-colors flex-shrink-0",title:"Delete key",children:e.jsx(z,{size:16})})]},n.id))}),e.jsx(E,{isOpen:m,onClose:k,title:p?"Key Created!":"Create API Key",actions:p?[{label:"Done",onClick:k,className:"game-btn game-btn-gold"}]:[{label:"Cancel",onClick:k,className:"game-btn game-btn-red"},{label:d?"Creating...":"Create",onClick:w,className:"game-btn game-btn-gold",disabled:d||!x.trim()}],children:p?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-cream/80 text-base",children:"Copy this key now. It will not be shown again!"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 bg-navy p-3 rounded border border-gold/30 text-gold text-sm font-body break-all",children:p}),e.jsx("button",{onClick:()=>v(p),className:"flex-shrink-0 p-2 rounded hover:bg-[#2a2a4a] transition-colors",title:"Copy",children:f?e.jsx($,{size:18,className:"text-emerald"}):e.jsx(D,{size:18,className:"text-cream/50"})})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-2 tracking-wide",children:"Key Name"}),e.jsx("input",{type:"text",value:x,onChange:n=>s(n.target.value),placeholder:"e.g. Mobile App",className:"w-full bg-navy-light border-2 border-[#2a2a4a] text-cream p-3 rounded font-body text-lg placeholder:text-cream/30 focus:border-gold focus:outline-none transition-colors"})]})})]})}function J(){const[l,c]=a.useState([]),[b,o]=a.useState(!0),[h,r]=a.useState(""),[m,g]=a.useState(!1),[x,s]=a.useState("kid"),[d,t]=a.useState(""),[p,u]=a.useState(!1),f=a.useCallback(async()=>{o(!0),r("");try{const i=await y("/api/admin/invite-codes");c(i.codes||i||[])}catch(i){r(i.message||"Failed to load invite codes")}finally{o(!1)}},[]);a.useEffect(()=>{f()},[f]);const j=async()=>{u(!0);try{const i={role:x};d&&(i.max_uses=parseInt(d,10)),await y("/api/admin/invite-codes",{method:"POST",body:i}),g(!1),s("kid"),t(""),f()}catch(i){r(i.message||"Failed to create code")}finally{u(!1)}},N=async i=>{try{await y(`/api/admin/invite-codes/${i}`,{method:"DELETE"}),c(v=>v.filter(k=>k.id!==i))}catch(v){r(v.message||"Failed to delete code")}},w="w-full bg-navy-light border-2 border-[#2a2a4a] text-cream p-3 rounded font-body text-lg placeholder:text-cream/30 focus:border-gold focus:outline-none transition-colors";return b?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(S,{size:28,className:"text-gold animate-spin"})}):e.jsxs("div",{children:[h&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm",children:h}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{onClick:()=>g(!0),className:"game-btn game-btn-gold flex items-center gap-2",children:[e.jsx(M,{size:14}),"Create Code"]})}),l.length===0?e.jsx("p",{className:"text-cream/30 text-center py-8 font-body",children:"No invite scrolls crafted yet."}):e.jsx("div",{className:"space-y-3",children:l.map(i=>e.jsxs("div",{className:"game-panel p-4 flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-gold font-body text-lg tracking-wider",children:i.code}),e.jsxs("div",{className:"flex gap-4 mt-1",children:[e.jsxs("span",{className:"text-cream/40 text-sm font-body",children:["Role:"," ",e.jsx("span",{className:"text-purple",children:i.role})]}),e.jsxs("span",{className:"text-cream/40 text-sm font-body",children:["Uses:"," ",e.jsxs("span",{className:"text-sky",children:[i.use_count??i.uses??0,i.max_uses?` / ${i.max_uses}`:" / unlimited"]})]})]})]}),e.jsx("button",{onClick:()=>N(i.id),className:"p-2 rounded hover:bg-crimson/10 text-crimson/60 hover:text-crimson transition-colors flex-shrink-0",title:"Delete code",children:e.jsx(z,{size:16})})]},i.id))}),e.jsx(E,{isOpen:m,onClose:()=>g(!1),title:"Create Invite Code",actions:[{label:"Cancel",onClick:()=>g(!1),className:"game-btn game-btn-red"},{label:p?"Creating...":"Create",onClick:j,className:"game-btn game-btn-gold",disabled:p}],children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-2 tracking-wide",children:"Role"}),e.jsxs("select",{value:x,onChange:i=>s(i.target.value),className:w,children:[e.jsx("option",{value:"kid",children:"kid"}),e.jsx("option",{value:"parent",children:"parent"}),e.jsx("option",{value:"admin",children:"admin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-2 tracking-wide",children:"Max Uses (optional)"}),e.jsx("input",{type:"number",min:1,value:d,onChange:i=>t(i.target.value),placeholder:"Unlimited",className:w})]})]})})]})}function Z(){const[l,c]=a.useState([]),[b,o]=a.useState(!0),[h,r]=a.useState(""),[m,g]=a.useState(0),x=50,s=a.useCallback(async()=>{o(!0),r("");try{const t=await y(`/api/admin/audit-log?limit=${x}&offset=${m}`);c(t.entries||t.logs||t||[])}catch(t){r(t.message||"Failed to load audit log")}finally{o(!1)}},[m]);a.useEffect(()=>{s()},[s]);const d=t=>t?new Date(t).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"--";return b?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(S,{size:28,className:"text-gold animate-spin"})}):e.jsxs("div",{children:[h&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm",children:h}),l.length===0?e.jsx("p",{className:"text-cream/30 text-center py-8 font-body",children:"The chronicle is empty. No deeds recorded yet."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-[#2a2a4a]",children:[e.jsx("th",{className:"font-heading text-gold/60 text-[8px] tracking-wider py-3 px-2",children:"Time"}),e.jsx("th",{className:"font-heading text-gold/60 text-[8px] tracking-wider py-3 px-2",children:"User"}),e.jsx("th",{className:"font-heading text-gold/60 text-[8px] tracking-wider py-3 px-2",children:"Action"}),e.jsx("th",{className:"font-heading text-gold/60 text-[8px] tracking-wider py-3 px-2",children:"Details"})]})}),e.jsx("tbody",{className:"divide-y divide-[#2a2a4a]/50",children:l.map((t,p)=>e.jsxs("tr",{className:"hover:bg-[#2a2a4a]/20 transition-colors",children:[e.jsx("td",{className:"py-2.5 px-2 text-cream/50 font-body text-base whitespace-nowrap",children:d(t.created_at)}),e.jsx("td",{className:"py-2.5 px-2 text-cream font-body text-base",children:t.user_id!=null?`User #${t.user_id}`:"--"}),e.jsx("td",{className:"py-2.5 px-2",children:e.jsx("span",{className:"text-sky font-body text-base",children:t.action})}),e.jsx("td",{className:"py-2.5 px-2 text-cream/40 font-body text-sm max-w-xs truncate",children:typeof t.details=="object"?JSON.stringify(t.details):t.details||"--"})]},t.id||p))})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-[#2a2a4a]",children:[e.jsxs("button",{onClick:()=>g(Math.max(0,m-x)),disabled:m===0,className:`game-btn game-btn-blue !py-2 !px-3 flex items-center gap-1 ${m===0?"opacity-30 cursor-not-allowed":""}`,children:[e.jsx(F,{size:14}),"Prev"]}),e.jsxs("span",{className:"text-cream/40 font-body text-sm",children:["Showing ",m+1," - ",m+l.length]}),e.jsxs("button",{onClick:()=>g(m+x),disabled:l.length<x,className:`game-btn game-btn-blue !py-2 !px-3 flex items-center gap-1 ${l.length<x?"opacity-30 cursor-not-allowed":""}`,children:["Next",e.jsx(P,{size:14})]})]})]})}function ce(){const{user:l}=K(),[c,b]=a.useState("users");return(l==null?void 0:l.role)!=="admin"?e.jsxs("div",{className:"max-w-xl mx-auto text-center py-20",children:[e.jsx(A,{size:48,className:"text-crimson/30 mx-auto mb-4"}),e.jsx("h1",{className:"font-heading text-crimson text-xs mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-cream/40 font-body text-lg",children:"Only realm administrators may enter this sanctum."})]}):e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(A,{size:28,className:"text-gold"}),e.jsx("h1",{className:"font-heading text-gold text-xs sm:text-sm leading-relaxed",children:"Admin Sanctum"})]}),e.jsx("div",{className:"flex gap-1 mb-6 overflow-x-auto pb-1",children:q.map(o=>{const h=o.icon,r=c===o.key;return e.jsxs("button",{onClick:()=>b(o.key),className:`flex items-center gap-2 px-4 py-3 rounded-t-md border-b-3 transition-colors font-heading text-[8px] tracking-wider whitespace-nowrap ${r?"bg-[#2a2a4a]/50 border-gold text-gold":"border-transparent text-cream/40 hover:text-cream/70 hover:bg-[#2a2a4a]/20"}`,children:[e.jsx(h,{size:16}),o.label]},o.key)})}),e.jsxs("div",{className:"game-panel p-5",children:[c==="users"&&e.jsx(B,{}),c==="api-keys"&&e.jsx(H,{}),c==="invite-codes"&&e.jsx(J,{}),c==="audit-log"&&e.jsx(Z,{})]})]})}export{ce as default};
