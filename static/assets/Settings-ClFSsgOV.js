import{a as M,u as O,r as a,b as x,j as e}from"./index-_mTouwGG.js";import{A as D,S as T}from"./shield-BSC9CgmJ.js";import{a as H,S as P,A as I}from"./settings-CUPQxpvR.js";import{L as p}from"./loader-circle-Pyy6N8rf.js";function W(){const v=M(),{user:n}=O(),N=(n==null?void 0:n.role)==="parent"||(n==null?void 0:n.role)==="admin",[r,y]=a.useState(null),[S,u]=a.useState(!0),[c,d]=a.useState(""),[g,w]=a.useState(!1),[h,m]=a.useState(""),[_,b]=a.useState([]),[$,A]=a.useState(!1),[k,C]=a.useState({}),z=a.useCallback(async()=>{var s,t,i;u(!0),d("");try{const l=await x("/api/admin/settings");y(l)}catch(l){(s=l.message)!=null&&s.includes("403")||(t=l.message)!=null&&t.includes("Forbidden")||(i=l.message)!=null&&i.includes("permission")?d("Access denied. Only parents and admins can access settings."):d(l.message||"Failed to load settings")}finally{u(!1)}},[]),L=a.useCallback(async()=>{A(!0);try{const s=await x("/api/stats/achievements/all");b(s.achievements||s||[])}catch{b([])}finally{A(!1)}},[]);a.useEffect(()=>{N?(z(),L()):(u(!1),d("Access denied. Only parents and admins can access settings."))},[N,z,L]);const o=(s,t)=>{y(i=>({...i,[s]:t}))},F=async()=>{w(!0),m("");try{await x("/api/admin/settings",{method:"PUT",body:r}),m("Settings saved!")}catch(s){m(s.message||"Failed to save settings")}finally{w(!1),setTimeout(()=>m(""),3e3)}},E=async s=>{C(t=>({...t,[s.id]:!0}));try{await x(`/api/stats/achievements/${s.id}`,{method:"PUT",body:{points_reward:s.points_reward}})}catch{}finally{C(t=>({...t,[s.id]:!1}))}},j=({enabled:s,onChange:t,label:i})=>e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("span",{className:"text-cream text-sm",children:i}),e.jsx("button",{onClick:()=>t(!s),className:`relative inline-flex h-6 w-11 items-center rounded-full border transition-colors flex-shrink-0 ${s?"bg-sky/30 border-sky/40":"bg-navy border-border"}`,"aria-label":`Toggle ${i}`,children:e.jsx("span",{className:`inline-block h-4 w-4 rounded-full transition-transform ${s?"translate-x-6 bg-sky":"translate-x-1 bg-muted/60"}`})})]});return e.jsxs("div",{className:"w-full max-w-2xl mx-auto overflow-hidden",children:[e.jsxs("button",{onClick:()=>v("/profile"),className:"flex items-center gap-1.5 text-muted hover:text-cream transition-colors mb-4 text-sm",children:[e.jsx(D,{size:16}),"Profile"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(H,{size:24,className:"text-cream"}),e.jsx("h1",{className:"text-cream text-lg font-bold",children:"Family Settings"})]}),c&&e.jsxs("div",{className:"game-panel p-8 text-center",children:[e.jsx(T,{size:48,className:"text-crimson/30 mx-auto mb-4"}),e.jsx("p",{className:"text-crimson text-sm",children:c}),e.jsx("p",{className:"text-muted text-xs mt-2",children:"Only guild leaders may alter the realm's configuration."})]}),S&&!c&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(p,{size:32,className:"text-sky animate-spin"})}),!S&&!c&&r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"game-panel p-5",children:[e.jsx("h2",{className:"text-cream text-base font-bold mb-3",children:"Feature Toggles"}),e.jsxs("div",{className:"divide-y divide-border",children:[e.jsx(j,{enabled:r.leaderboard_enabled??!0,onChange:s=>o("leaderboard_enabled",s),label:"Leaderboard"}),e.jsx(j,{enabled:r.spin_wheel_enabled??!0,onChange:s=>o("spin_wheel_enabled",s),label:"Spin Wheel"}),e.jsx(j,{enabled:r.chore_trading_enabled??!0,onChange:s=>o("chore_trading_enabled",s),label:"Chore Trading"})]})]}),e.jsxs("div",{className:"game-panel p-5",children:[e.jsx("h2",{className:"text-cream text-base font-bold mb-3",children:"Daily Reset Hour"}),e.jsx("p",{className:"text-muted text-xs mb-3",children:"Hour of day (0-23) when daily quests reset."}),e.jsx("input",{type:"number",min:0,max:23,value:r.daily_reset_hour??0,onChange:s=>{const t=Math.min(23,Math.max(0,parseInt(s.target.value,10)||0));o("daily_reset_hour",t)},className:"field-input max-w-[120px]"})]}),e.jsxs("button",{onClick:F,disabled:g,className:"game-btn game-btn-blue flex items-center gap-2",children:[g?e.jsx(p,{size:14,className:"animate-spin"}):e.jsx(P,{size:14}),g?"Saving...":"Save Settings"]}),h&&e.jsx("p",{className:`text-sm ${h.includes("!")?"text-emerald":"text-crimson"}`,children:h}),e.jsxs("div",{className:"game-panel p-5",children:[e.jsxs("h2",{className:"text-cream text-base font-bold mb-3 flex items-center gap-2",children:[e.jsx(I,{size:16,className:"text-muted"}),"Achievement Point Values"]}),$?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(p,{size:20,className:"text-sky animate-spin"})}):_.length===0?e.jsx("p",{className:"text-muted text-xs",children:"No achievements configured yet."}):e.jsx("div",{className:"space-y-3",children:_.map(s=>e.jsxs("div",{className:"p-3 rounded-lg bg-surface-raised/30 border border-border space-y-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-cream text-sm truncate",children:s.title||s.name}),s.description&&e.jsx("p",{className:"text-muted text-xs truncate",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:0,value:s.points_reward??0,onChange:t=>{const i=parseInt(t.target.value,10)||0;b(l=>l.map(f=>f.id===s.id?{...f,points_reward:i}:f))},className:"field-input !w-20 !p-2 text-center"}),e.jsx("span",{className:"text-muted text-xs",children:"pts"}),e.jsx("button",{onClick:()=>E(s),disabled:k[s.id],className:"game-btn game-btn-blue !py-2 !px-3 ml-auto",title:"Save",children:k[s.id]?e.jsx(p,{size:12,className:"animate-spin"}):e.jsx(P,{size:12})})]})]},s.id))})]}),(n==null?void 0:n.role)==="admin"&&e.jsxs("div",{className:"game-panel p-5 text-center",children:[e.jsx("p",{className:"text-muted text-xs mb-3",children:"Need advanced controls?"}),e.jsxs("button",{onClick:()=>v("/admin"),className:"game-btn game-btn-purple",children:[e.jsx(T,{size:14,className:"inline mr-2"}),"Admin Dashboard"]})]})]})]})}export{W as default};
