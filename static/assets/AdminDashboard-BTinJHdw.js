import{u as K,a as U,r as a,j as e,f as L,b as f,d as k}from"./index-DNIywqZZ.js";import{M as T}from"./Modal-CXOHEPT9.js";import{S as A}from"./shield-s_L03ijC.js";import{U as P}from"./users-CcC0dEo-.js";import{K as $,T as F,C as M}from"./ticket-O_jsfJD1.js";import{S as D}from"./scroll-text-BHhARbHu.js";import{E as I,a as O}from"./eye-Bg-T-tVP.js";import{P as E}from"./plus-B2UCsRcR.js";import{T as _}from"./trash-2-Do98SmEs.js";import{C as R}from"./check-0c078Sf3.js";import{C as V}from"./chevron-left-Du_oZMQE.js";import{C as B}from"./chevron-right-DMYTKK5d.js";import"./index-D52oPGzx.js";import"./proxy-pUA5QpF8.js";const J=[{key:"users",label:"Users",icon:P},{key:"api-keys",label:"API Keys",icon:$},{key:"invite-codes",label:"Invite Codes",icon:F},{key:"audit-log",label:"Audit Log",icon:D}];function q(){const[n,u]=a.useState([]),[p,h]=a.useState(!0),[c,l]=a.useState(""),o=a.useCallback(async()=>{h(!0),l("");try{const t=await f("/api/admin/users");u(Array.isArray(t)?t:t.users||[])}catch(t){l(t.message||"Failed to load users")}finally{h(!1)}},[]);a.useEffect(()=>{o()},[o]);const b=async(t,d)=>{try{await f(`/api/admin/users/${t}`,{method:"PUT",body:{role:d}}),u(s=>s.map(x=>x.id===t?{...x,role:d}:x))}catch(s){l(s.message||"Failed to update role")}},m=async t=>{try{await f(`/api/admin/users/${t.id}`,{method:"PUT",body:{is_active:!t.is_active}}),u(d=>d.map(s=>s.id===t.id?{...s,is_active:!s.is_active}:s))}catch(d){l(d.message||"Failed to toggle user status")}};return p?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(k,{size:28,className:"text-sky animate-spin"})}):e.jsxs("div",{children:[c&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm",children:c}),n.length===0?e.jsx("p",{className:"text-muted text-center py-8 text-sm",children:"No heroes in the realm yet."}):e.jsx("div",{className:"space-y-3",children:n.map(t=>e.jsxs("div",{className:"p-3 rounded-lg bg-surface-raised/30 border border-border space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-cream text-sm font-medium truncate",children:t.username}),t.display_name&&e.jsx("p",{className:"text-muted text-xs truncate",children:t.display_name})]}),e.jsx("span",{className:`inline-block px-2 py-0.5 rounded text-xs font-medium flex-shrink-0 ${t.is_active!==!1?"bg-emerald/10 text-emerald border border-emerald/30":"bg-crimson/10 text-crimson border border-crimson/30"}`,children:t.is_active!==!1?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:t.role,onChange:d=>b(t.id,d.target.value),className:"field-input !py-1.5 !text-xs flex-1",children:[e.jsx("option",{value:"kid",children:"kid"}),e.jsx("option",{value:"parent",children:"parent"}),e.jsx("option",{value:"admin",children:"admin"})]}),e.jsx("button",{onClick:()=>m(t),className:`game-btn !py-1.5 !px-3 !text-[10px] flex-shrink-0 ${t.is_active!==!1?"game-btn-red":"game-btn-blue"}`,children:t.is_active!==!1?e.jsxs(e.Fragment,{children:[e.jsx(I,{size:12,className:"inline mr-1"}),"Deactivate"]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{size:12,className:"inline mr-1"}),"Activate"]})})]})]},t.id))})]})}function G(){const[n,u]=a.useState([]),[p,h]=a.useState(!0),[c,l]=a.useState(""),[o,b]=a.useState(!1),[m,t]=a.useState(""),[d,s]=a.useState(!1),[x,y]=a.useState(""),[j,g]=a.useState(!1),N=a.useCallback(async()=>{h(!0),l("");try{const i=await f("/api/admin/api-keys");u(Array.isArray(i)?i:i.keys||[])}catch(i){l(i.message||"Failed to load API keys")}finally{h(!1)}},[]);a.useEffect(()=>{N()},[N]);const r=async()=>{if(m.trim()){s(!0);try{const i=await f("/api/admin/api-keys",{method:"POST",body:{name:m.trim()}});y(i.key||i.api_key||i.token||""),N()}catch(i){l(i.message||"Failed to create key"),b(!1)}finally{s(!1)}}},v=async i=>{try{await f(`/api/admin/api-keys/${i}`,{method:"DELETE"}),u(S=>S.filter(z=>z.id!==i))}catch(S){l(S.message||"Failed to delete key")}},C=async i=>{try{await navigator.clipboard.writeText(i),g(!0),setTimeout(()=>g(!1),2e3)}catch{}},w=()=>{b(!1),t(""),y(""),g(!1)};return p?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(k,{size:28,className:"text-sky animate-spin"})}):e.jsxs("div",{children:[c&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm",children:c}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{onClick:()=>b(!0),className:"game-btn game-btn-blue flex items-center gap-2",children:[e.jsx(E,{size:14}),"Create Key"]})}),n.length===0?e.jsx("p",{className:"text-muted text-center py-8 text-sm",children:"No API keys forged yet."}):e.jsx("div",{className:"space-y-3",children:n.map(i=>e.jsxs("div",{className:"p-3 rounded-lg bg-surface-raised/30 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[e.jsx("p",{className:"text-cream text-sm font-medium truncate min-w-0",children:i.name}),e.jsx("button",{onClick:()=>v(i.id),className:"p-1.5 rounded hover:bg-crimson/10 text-crimson/60 hover:text-crimson transition-colors flex-shrink-0",title:"Delete key",children:e.jsx(_,{size:14})})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1",children:[e.jsxs("span",{className:"text-muted text-xs",children:["Prefix: ",e.jsx("span",{className:"text-sky",children:i.prefix||i.key_prefix||"***"})]}),i.scopes&&e.jsxs("span",{className:"text-muted text-xs",children:["Scopes: ",e.jsx("span",{className:"text-purple",children:Array.isArray(i.scopes)?i.scopes.join(", "):i.scopes})]})]})]},i.id))}),e.jsx(T,{isOpen:o,onClose:w,title:x?"Key Created!":"Create API Key",actions:x?[{label:"Done",onClick:w,className:"game-btn game-btn-blue"}]:[{label:"Cancel",onClick:w,className:"game-btn game-btn-red"},{label:d?"Creating...":"Create",onClick:r,className:"game-btn game-btn-blue",disabled:d||!m.trim()}],children:x?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-muted text-sm",children:"Copy this key now. It will not be shown again!"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 bg-navy p-3 rounded border border-sky/30 text-sky text-sm break-all",children:x}),e.jsx("button",{onClick:()=>C(x),className:"flex-shrink-0 p-2 rounded hover:bg-surface-raised transition-colors",title:"Copy",children:j?e.jsx(R,{size:18,className:"text-emerald"}):e.jsx(M,{size:18,className:"text-muted"})})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-2",children:"Key Name"}),e.jsx("input",{type:"text",value:m,onChange:i=>t(i.target.value),placeholder:"e.g. Mobile App",className:"field-input"})]})})]})}function H(){const[n,u]=a.useState([]),[p,h]=a.useState(!0),[c,l]=a.useState(""),[o,b]=a.useState(!1),[m,t]=a.useState("kid"),[d,s]=a.useState(""),[x,y]=a.useState(!1),j=a.useCallback(async()=>{h(!0),l("");try{const r=await f("/api/admin/invite-codes");u(Array.isArray(r)?r:r.codes||[])}catch(r){l(r.message||"Failed to load invite codes")}finally{h(!1)}},[]);a.useEffect(()=>{j()},[j]);const g=async()=>{y(!0);try{const r={role:m};d&&(r.max_uses=parseInt(d,10)),await f("/api/admin/invite-codes",{method:"POST",body:r}),b(!1),t("kid"),s(""),j()}catch(r){l(r.message||"Failed to create code")}finally{y(!1)}},N=async r=>{try{await f(`/api/admin/invite-codes/${r}`,{method:"DELETE"}),u(v=>v.filter(C=>C.id!==r))}catch(v){l(v.message||"Failed to delete code")}};return p?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(k,{size:28,className:"text-sky animate-spin"})}):e.jsxs("div",{children:[c&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm",children:c}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{onClick:()=>b(!0),className:"game-btn game-btn-blue flex items-center gap-2",children:[e.jsx(E,{size:14}),"Create Code"]})}),n.length===0?e.jsx("p",{className:"text-muted text-center py-8 text-sm",children:"No invite scrolls crafted yet."}):e.jsx("div",{className:"space-y-3",children:n.map(r=>e.jsxs("div",{className:"p-3 rounded-lg bg-surface-raised/30 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[e.jsx("p",{className:"text-cream text-sm font-bold tracking-wider truncate min-w-0",children:r.code}),e.jsx("button",{onClick:()=>N(r.id),className:"p-1.5 rounded hover:bg-crimson/10 text-crimson/60 hover:text-crimson transition-colors flex-shrink-0",title:"Delete code",children:e.jsx(_,{size:14})})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1",children:[e.jsxs("span",{className:"text-muted text-xs",children:["Role: ",e.jsx("span",{className:"text-purple",children:r.role})]}),e.jsxs("span",{className:"text-muted text-xs",children:["Uses:"," ",e.jsxs("span",{className:"text-sky",children:[r.times_used??0,r.max_uses?` / ${r.max_uses}`:" / âˆž"]})]})]})]},r.id))}),e.jsx(T,{isOpen:o,onClose:()=>b(!1),title:"Create Invite Code",actions:[{label:"Cancel",onClick:()=>b(!1),className:"game-btn game-btn-red"},{label:x?"Creating...":"Create",onClick:g,className:"game-btn game-btn-blue",disabled:x}],children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-2",children:"Role"}),e.jsxs("select",{value:m,onChange:r=>t(r.target.value),className:"field-input",children:[e.jsx("option",{value:"kid",children:"kid"}),e.jsx("option",{value:"parent",children:"parent"}),e.jsx("option",{value:"admin",children:"admin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-2",children:"Max Uses (optional)"}),e.jsx("input",{type:"number",min:1,value:d,onChange:r=>s(r.target.value),placeholder:"Unlimited",className:"field-input"})]})]})})]})}function Q(){const[n,u]=a.useState([]),[p,h]=a.useState(!0),[c,l]=a.useState(""),[o,b]=a.useState(0),m=50,t=a.useCallback(async()=>{h(!0),l("");try{const s=await f(`/api/admin/audit-log?limit=${m}&offset=${o}`);u(Array.isArray(s)?s:s.entries||s.logs||[])}catch(s){l(s.message||"Failed to load audit log")}finally{h(!1)}},[o]);a.useEffect(()=>{t()},[t]);const d=s=>s?new Date(s).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"--";return p?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(k,{size:28,className:"text-sky animate-spin"})}):e.jsxs("div",{children:[c&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm",children:c}),n.length===0?e.jsx("p",{className:"text-muted text-center py-8 text-sm",children:"The chronicle is empty. No deeds recorded yet."}):e.jsx("div",{className:"space-y-2",children:n.map((s,x)=>e.jsxs("div",{className:"p-3 rounded-lg bg-surface-raised/30 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[e.jsx("span",{className:"text-sky text-xs font-medium",children:s.action}),e.jsx("span",{className:"text-muted text-[10px] flex-shrink-0",children:d(s.created_at)})]}),e.jsxs("p",{className:"text-muted text-xs break-all",children:[s.user_id!=null?`User #${s.user_id}`:"--",s.details&&s.details!=="--"&&e.jsx("span",{className:"ml-2 text-muted/70",children:typeof s.details=="object"?JSON.stringify(s.details):s.details})]})]},s.id||x))}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-border",children:[e.jsxs("button",{onClick:()=>b(Math.max(0,o-m)),disabled:o===0,className:`game-btn game-btn-blue !py-2 !px-3 flex items-center gap-1 ${o===0?"opacity-30 cursor-not-allowed":""}`,children:[e.jsx(V,{size:14}),"Prev"]}),e.jsxs("span",{className:"text-muted text-xs",children:["Showing ",o+1," - ",o+n.length]}),e.jsxs("button",{onClick:()=>b(o+m),disabled:n.length<m,className:`game-btn game-btn-blue !py-2 !px-3 flex items-center gap-1 ${n.length<m?"opacity-30 cursor-not-allowed":""}`,children:["Next",e.jsx(B,{size:14})]})]})]})}function de(){const{user:n}=K(),u=U(),[p,h]=a.useState("users");return(n==null?void 0:n.role)!=="admin"?e.jsxs("div",{className:"max-w-xl mx-auto text-center py-20",children:[e.jsx(A,{size:48,className:"text-crimson/30 mx-auto mb-4"}),e.jsx("h1",{className:"text-cream text-xl font-extrabold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-muted text-sm",children:"Only realm administrators may enter this sanctum."})]}):e.jsxs("div",{className:"w-full max-w-2xl mx-auto overflow-hidden",children:[e.jsxs("button",{onClick:()=>u("/profile"),className:"flex items-center gap-1.5 text-muted hover:text-cream transition-colors mb-4 text-sm",children:[e.jsx(L,{size:16}),"Profile"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(A,{size:24,className:"text-sky"}),e.jsx("h1",{className:"text-cream text-lg font-extrabold",children:"Admin Dashboard"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-1 mb-6",children:J.map(c=>{const l=c.icon,o=p===c.key;return e.jsxs("button",{onClick:()=>h(c.key),className:`flex flex-col items-center gap-1 px-1 py-2.5 rounded-lg border transition-colors text-[11px] font-medium ${o?"bg-sky/10 border-sky/30 text-sky":"border-border text-muted hover:text-cream hover:border-border-light"}`,children:[e.jsx(l,{size:16}),e.jsx("span",{className:"truncate w-full text-center",children:c.label})]},c.key)})}),e.jsxs("div",{className:"game-panel p-4",children:[p==="users"&&e.jsx(q,{}),p==="api-keys"&&e.jsx(G,{}),p==="invite-codes"&&e.jsx(H,{}),p==="audit-log"&&e.jsx(Q,{})]})]})}export{de as default};
