import{g as ie,u as ne,c as le,a as ce,r as o,b as m,j as e,f as A,S as oe,U as de}from"./index-DNZbfclw.js";import{t as me,a as xe}from"./questThemeText-DkmuO04F.js";import{S as pe}from"./scroll-text-C81zc4NU.js";import{C as D}from"./circle-x-i6Y1hNi6.js";import{S as ue}from"./shield-CQhcnMI_.js";import{a as O,R as F}from"./rotate-cw-Cb899XHQ.js";import{C as U}from"./camera-BYjYzQ7D.js";import{C as Q}from"./circle-check-DnhL4TDk.js";import{S as he}from"./skip-forward-BpaQW8Pf.js";import{C as ge}from"./chevron-right-DRz-yEG_.js";import{T as fe}from"./trash-2-iVzWod5p.js";import{C as je}from"./calendar-6IXB2vIP.js";import{C as be}from"./clock-GwqV94wP.js";import{S as ye}from"./star-Dwc7CGDk.js";const Ne={easy:1,medium:2,hard:3,expert:4},ve=["Trivial","Easy","Medium","Hard","Legendary"],Ce=["text-muted","text-emerald","text-sky","text-purple","text-gold"],ke=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],q={cleaning:"bg-sky/20 text-sky border-sky/40",cooking:"bg-gold/20 text-gold border-gold/40",outdoor:"bg-emerald/20 text-emerald border-emerald/40",homework:"bg-purple/20 text-purple border-purple/40",pet_care:"bg-crimson/20 text-crimson border-crimson/40",laundry:"bg-sky/20 text-sky border-sky/40",errands:"bg-gold/20 text-gold border-gold/40",default:"bg-cream/10 text-muted border-border"};function we({level:i}){const n=typeof i=="string"?Ne[i]||1:i||1;return e.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(j=>e.jsx(ye,{size:18,className:j<=n?"text-gold fill-gold":"text-cream/20"},j)),e.jsx("span",{className:`ml-2 text-sm ${Ce[n-1]||"text-muted"}`,children:ve[n-1]||"Unknown"})]})}function Se({status:i}){const n={pending:"bg-gold/20 text-gold border-gold/40",completed:"bg-emerald/20 text-emerald border-emerald/40",verified:"bg-sky/20 text-sky border-sky/40",skipped:"bg-cream/10 text-muted border-border",missed:"bg-crimson/20 text-crimson border-crimson/40"};return e.jsx("span",{className:`inline-block px-2 py-0.5 rounded-full text-sm border capitalize ${n[i]||n.pending}`,children:i||"pending"})}function qe(){var E,P;const{id:i}=ie(),{user:n}=ne(),{colorTheme:j}=le(),k=ce(),p=(n==null?void 0:n.role)==="parent"||(n==null?void 0:n.role)==="admin",M=(n==null?void 0:n.role)==="kid",[r,B]=o.useState(null),[K,V]=o.useState(!0),[w,S]=o.useState(""),[l,c]=o.useState(""),[b,a]=o.useState(""),[x,v]=o.useState(null),[f,Y]=o.useState([]),[_,I]=o.useState("daily"),[T,z]=o.useState([]),g=o.useCallback(async()=>{if(p)try{const s=(await m("/api/rotations")||[]).find(h=>h.chore_id===parseInt(i));v(s||null)}catch{v(null)}},[i,p]),R=o.useCallback(async()=>{if(p)try{const t=await m(`/api/chores/${i}/rules`);z(Array.isArray(t)?t.filter(s=>s.is_active):[])}catch{z([])}},[i,p]),u=o.useCallback(async()=>{try{S("");const t=await m(`/api/chores/${i}`);B(t)}catch(t){S(t.message||"This quest scroll could not be found.")}finally{V(!1)}},[i]);o.useEffect(()=>{u(),g(),R(),p&&m("/api/stats/kids").then(t=>Y(t||[])).catch(()=>{})},[u,g,R,p]),o.useEffect(()=>{const t=()=>{u(),g()};return window.addEventListener("ws:message",t),()=>window.removeEventListener("ws:message",t)},[u,g]);const X=async()=>{c("complete"),a("");try{await m(`/api/chores/${i}/complete`,{method:"POST"}),a("Quest completed! XP has been awarded to your hero."),await u()}catch(t){a(t.message||"Failed to complete the quest.")}finally{c("")}},G=async t=>{c("verify"),a("");try{const s=t?`/api/chores/assignments/${t}/verify`:`/api/chores/${i}/verify`;await m(s,{method:"POST"}),a("Quest verified! The hero has been rewarded."),await u()}catch(s){a(s.message||"Verification failed.")}finally{c("")}},W=async t=>{c("uncomplete"),a("");try{const s=t?`/api/chores/assignments/${t}/uncomplete`:`/api/chores/${i}/uncomplete`;await m(s,{method:"POST"}),a("Quest marked as incomplete."),await u()}catch(s){a(s.message||"Could not undo completion.")}finally{c("")}},H=async t=>{c("skip"),a("");try{const s=t?`/api/chores/assignments/${t}/skip`:`/api/chores/${i}/skip`;await m(s,{method:"POST"}),a("Quest skipped for today."),await u()}catch(s){a(s.message||"Could not skip the quest.")}finally{c("")}},J=async()=>{if(f.length<2){a("Need at least 2 kids for a rotation.");return}c("rotation");try{await m("/api/rotations",{method:"POST",body:{chore_id:parseInt(i),kid_ids:f.map(t=>t.id),cadence:_}}),await g(),a("Rotation created.")}catch(t){a(t.message||"Could not create rotation.")}finally{c("")}},Z=async()=>{if(x){c("rotation");try{await m(`/api/rotations/${x.id}/advance`,{method:"POST"}),await g(),a("Rotation advanced to next kid.")}catch(t){a(t.message||"Could not advance rotation.")}finally{c("")}}},ee=async t=>{if(x){c("rotation");try{await m(`/api/rotations/${x.id}`,{method:"PUT",body:{cadence:t}}),await g(),a(`Cadence updated to ${t}.`)}catch(s){a(s.message||"Could not update cadence.")}finally{c("")}}},te=async()=>{if(x){c("rotation");try{await m(`/api/rotations/${x.id}`,{method:"DELETE"}),v(null),a("Rotation removed.")}catch(t){a(t.message||"Could not delete rotation.")}finally{c("")}}};if(K)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[e.jsx(pe,{size:48,className:"text-sky animate-pulse"}),e.jsx("p",{className:"text-cream text-lg font-bold animate-pulse",children:"Unrolling the quest scroll..."})]});if(w)return e.jsxs("div",{className:"max-w-2xl mx-auto py-10",children:[e.jsxs("button",{onClick:()=>k("/chores"),className:"flex items-center gap-2 text-muted hover:text-cream transition-colors mb-6",children:[e.jsx(A,{size:18}),e.jsx("span",{className:"text-sm",children:"Back to Quest Board"})]}),e.jsxs("div",{className:"game-panel p-10 text-center",children:[e.jsx(D,{size:48,className:"mx-auto text-crimson mb-4"}),e.jsx("p",{className:"text-cream text-xl font-extrabold mb-2",children:"Quest Not Found"}),e.jsx("p",{className:"text-muted text-sm",children:w})]})]});if(!r)return null;const y=typeof r.category=="object"?(E=r.category)==null?void 0:E.name:r.category,se=q[y==null?void 0:y.toLowerCase()]||q.default,$=r.assignments||r.history||[],C=new Date().toISOString().split("T")[0],d=$.find(t=>t.date===C||t.assigned_date===C||t.due_date===C),ae=d&&(d.status==="pending"||d.status==="assigned"),L=$.slice(0,10);return e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs("button",{onClick:()=>k("/chores"),className:"flex items-center gap-2 text-muted hover:text-cream transition-colors",children:[e.jsx(A,{size:18}),e.jsx("span",{className:"text-sm",children:"Back to Quest Board"})]}),e.jsxs("div",{className:"game-panel p-6 space-y-5",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(oe,{size:28,className:"text-sky flex-shrink-0 mt-1"}),e.jsx("div",{className:"flex-1",children:e.jsx("h1",{className:"text-cream text-xl font-extrabold leading-relaxed",children:me(r.title,j)})})]}),r.description&&e.jsx("div",{className:"pl-10",children:e.jsx("p",{className:"text-muted text-sm leading-relaxed",children:xe(r.title,r.description,j)})}),e.jsx("div",{className:"mx-auto w-full h-[1px] bg-gradient-to-r from-transparent via-border to-transparent"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gold/10 flex items-center justify-center",children:e.jsx("span",{className:"text-gold text-xl",children:"â˜…"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"XP Reward"}),e.jsxs("p",{className:"text-gold text-lg font-bold",children:[r.points," XP"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium mb-1",children:"Difficulty"}),e.jsx(we,{level:r.difficulty||1})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-surface-raised flex items-center justify-center",children:e.jsx(ue,{size:18,className:"text-muted"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Category"}),e.jsx("span",{className:`inline-block px-2 py-0.5 rounded-full text-sm border capitalize ${se}`,children:y||"General"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-surface-raised flex items-center justify-center",children:e.jsx(O,{size:18,className:"text-muted"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Recurrence"}),e.jsxs("p",{className:"text-cream text-sm capitalize",children:[r.recurrence||"Once",r.recurrence==="custom"&&((P=r.custom_days)==null?void 0:P.length)>0&&e.jsxs("span",{className:"text-muted text-xs ml-1",children:["(",r.custom_days.map(t=>ke[t]||t).join(", "),")"]})]})]})]})]}),r.requires_photo&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded bg-purple/10 border border-purple/30",children:[e.jsx(U,{size:16,className:"text-purple"}),e.jsx("span",{className:"text-purple text-xs",children:"Photo proof required upon completion"})]})]}),b&&e.jsx("div",{className:`p-3 rounded border-2 text-sm text-center ${b.toLowerCase().includes("fail")||b.toLowerCase().includes("could not")?"border-crimson/40 bg-crimson/10 text-crimson":"border-emerald/40 bg-emerald/10 text-emerald"}`,children:b}),M&&ae&&e.jsx("div",{className:"game-panel p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-cream text-lg font-bold mb-1",children:"Today's Quest"}),e.jsx("p",{className:"text-muted text-xs",children:"This quest awaits your courage, adventurer!"})]}),e.jsxs("button",{onClick:X,disabled:!!l,className:`game-btn game-btn-blue flex items-center gap-2 ${l==="complete"?"opacity-60 cursor-wait":""}`,children:[e.jsx(Q,{size:16}),l==="complete"?"Completing...":"Complete Quest"]})]})}),p&&e.jsxs("div",{className:"game-panel p-5",children:[e.jsx("p",{className:"text-cream text-lg font-bold mb-3",children:"Guild Master Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:()=>G(d==null?void 0:d.id),disabled:!!l,className:`game-btn game-btn-blue flex items-center gap-2 ${l==="verify"?"opacity-60 cursor-wait":""}`,children:[e.jsx(Q,{size:14}),l==="verify"?"Verifying...":"Verify"]}),e.jsxs("button",{onClick:()=>W(d==null?void 0:d.id),disabled:!!l,className:`game-btn game-btn-blue flex items-center gap-2 ${l==="uncomplete"?"opacity-60 cursor-wait":""}`,children:[e.jsx(D,{size:14}),l==="uncomplete"?"Undoing...":"Uncomplete"]}),e.jsxs("button",{onClick:()=>H(d==null?void 0:d.id),disabled:!!l,className:`game-btn game-btn-red flex items-center gap-2 ${l==="skip"?"opacity-60 cursor-wait":""}`,children:[e.jsx(he,{size:14}),l==="skip"?"Skipping...":"Skip Today"]})]})]}),p&&T.length>0&&e.jsxs("div",{className:"game-panel p-5 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{size:18,className:"text-sky"}),e.jsx("h2",{className:"text-cream text-lg font-bold",children:"Assigned Heroes"})]}),e.jsx("div",{className:"space-y-2",children:T.map(t=>{var h;const s=f.find(N=>N.id===t.user_id);return e.jsxs("div",{className:"flex items-center justify-between gap-3 px-3 py-2 rounded-lg border border-border bg-surface-raised/20",children:[e.jsx("div",{className:"flex items-center gap-2 min-w-0",children:e.jsx("span",{className:"text-cream text-sm font-medium truncate",children:(s==null?void 0:s.display_name)||((h=t.user)==null?void 0:h.display_name)||`Kid #${t.user_id}`})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("span",{className:"text-muted text-xs capitalize flex items-center gap-1",children:[e.jsx(O,{size:10}),t.recurrence]}),t.requires_photo&&e.jsxs("span",{className:"text-muted text-xs flex items-center gap-1",children:[e.jsx(U,{size:10}),"Photo"]})]})]},t.id)})})]}),p&&r.recurrence&&r.recurrence!=="once"&&e.jsxs("div",{className:"game-panel p-5 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{size:18,className:"text-purple"}),e.jsx("h2",{className:"text-cream text-lg font-bold",children:"Kid Rotation"})]}),x?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-muted",children:"Cadence:"}),e.jsxs("select",{value:x.cadence,onChange:t=>ee(t.target.value),disabled:l==="rotation",className:"bg-surface-raised text-cream text-sm rounded-lg border border-border px-2 py-1 focus:outline-none focus:ring-1 focus:ring-purple",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"fortnightly",children:"Fortnightly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(x.kid_ids||[]).map((t,s)=>{const h=f.find(re=>re.id===t),N=s===x.current_index;return e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${N?"border-purple bg-purple/20 text-purple":"border-border text-muted"}`,children:[(h==null?void 0:h.display_name)||`Kid #${t}`,N&&" (current)"]},t)})}),e.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[e.jsxs("button",{onClick:Z,disabled:l==="rotation",className:"game-btn game-btn-purple flex items-center gap-1.5 !py-1.5 !px-3 !text-[11px]",children:[e.jsx(ge,{size:14}),"Advance"]}),e.jsxs("button",{onClick:te,disabled:l==="rotation",className:"game-btn game-btn-red flex items-center gap-1.5 !py-1.5 !px-3 !text-[11px]",children:[e.jsx(fe,{size:14}),"Remove Rotation"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-muted text-xs",children:"No rotation set. Create one to automatically rotate this quest between kids."}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-muted",children:"Cadence:"}),e.jsxs("select",{value:_,onChange:t=>I(t.target.value),className:"bg-surface-raised text-cream text-sm rounded-lg border border-border px-2 py-1 focus:outline-none focus:ring-1 focus:ring-purple",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"fortnightly",children:"Fortnightly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),e.jsxs("button",{onClick:J,disabled:l==="rotation"||f.length<2,className:"game-btn game-btn-purple flex items-center gap-1.5 !py-1.5 !px-3 !text-[11px]",children:[e.jsx(F,{size:14}),f.length<2?"Need 2+ kids":"Create Rotation"]})]})]}),L.length>0&&e.jsxs("div",{className:"game-panel p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{size:18,className:"text-sky"}),e.jsx("h2",{className:"text-cream text-lg font-bold",children:"Quest Log"})]}),e.jsx("div",{className:"space-y-2",children:L.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded bg-surface-raised/30 border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{size:14,className:"text-cream/30"}),e.jsx("span",{className:"text-muted text-xs",children:t.date||t.assigned_date||t.due_date||"N/A"}),t.assigned_to_name&&e.jsxs("span",{className:"text-muted text-xs",children:["- ",t.assigned_to_name]})]}),e.jsx(Se,{status:t.status})]},t.id||s))})]})]})}export{qe as default};
