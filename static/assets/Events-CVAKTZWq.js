import{u as q,r as s,b as d,j as e,e as T,d as A}from"./index-DNZbfclw.js";import{M as Z}from"./Modal-9JikIi0L.js";import{P as R}from"./plus-CRo4NV07.js";import{Z as U}from"./zap--rcdU3jW.js";import{S as W}from"./square-CTjZgPog.js";import{P as B}from"./pencil-Dnr7i0Qg.js";import{T as G}from"./trash-2-iVzWod5p.js";import"./index-DNx_QacM.js";import"./proxy-CTpQfhFp.js";function _(a){return a?new Date(a).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):""}function z(a){return a?new Date(a).toISOString().slice(0,10):""}function ae(){const{user:a}=q(),x=(a==null?void 0:a.role)==="parent"||(a==null?void 0:a.role)==="admin",[u,F]=s.useState([]),[p,S]=s.useState(!0),[E,o]=s.useState(""),[M,r]=s.useState(!1),[h,y]=s.useState(null),[g,f]=s.useState(""),[w,b]=s.useState(""),[D,j]=s.useState("1.5"),[c,v]=s.useState(""),[m,N]=s.useState(""),[C,i]=s.useState(""),[k,P]=s.useState(!1),n=s.useCallback(async()=>{S(!0),o("");try{const t=await d("/api/events");F(t||[])}catch(t){o(t.message||"Failed to load events")}finally{S(!1)}},[]);s.useEffect(()=>{n()},[n]),s.useEffect(()=>{const t=()=>{n()};return window.addEventListener("ws:message",t),()=>window.removeEventListener("ws:message",t)},[n]);const L=()=>{y(null),f(""),b(""),j("1.5"),v(""),N(""),i(""),r(!0)},O=t=>{y(t),f(t.title),b(t.description||""),j(String(t.multiplier)),v(z(t.start_date)),N(z(t.end_date)),i(""),r(!0)},I=async()=>{if(!g.trim()){i("Title is required");return}if(!c||!m){i("Start and end dates are required");return}const t=parseFloat(D);if(!t||t<=1){i("Multiplier must be greater than 1");return}if(new Date(m)<=new Date(c)){i("End date must be after start date");return}P(!0),i("");try{const l={title:g.trim(),description:w.trim()||null,multiplier:t,start_date:new Date(c+"T00:00:00").toISOString(),end_date:new Date(m+"T23:59:59").toISOString()};h?await d(`/api/events/${h.id}`,{method:"PUT",body:l}):await d("/api/events",{method:"POST",body:l}),r(!1),n()}catch(l){i(l.message||"Failed to save event")}finally{P(!1)}},X=async t=>{try{await d(`/api/events/${t}/end`,{method:"POST"}),n()}catch(l){o(l.message||"Failed to end event")}},$=async t=>{try{await d(`/api/events/${t}`,{method:"DELETE"}),n()}catch(l){o(l.message||"Failed to delete event")}};return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{size:28,className:"text-gold"}),e.jsx("h1",{className:"text-cream text-xl font-extrabold leading-relaxed",children:"Seasonal Events"})]}),x&&e.jsxs("button",{onClick:L,className:"game-btn game-btn-gold flex items-center gap-2",children:[e.jsx(R,{size:14}),"New Event"]})]}),E&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm text-center",children:E}),p&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(A,{size:32,className:"text-gold animate-spin"})}),!p&&u.length===0&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx(T,{size:48,className:"text-muted mx-auto mb-4"}),e.jsx("p",{className:"text-cream text-lg font-bold",children:"No events yet"}),e.jsx("p",{className:"text-muted text-sm mt-2",children:"Create a seasonal event to boost XP with a multiplier."})]}),!p&&u.length>0&&e.jsx("div",{className:"space-y-3",children:u.map(t=>e.jsx("div",{className:`game-panel p-4 ${t.is_active?"!border-gold/40":""}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx(U,{size:18,className:t.is_active?"text-gold":"text-muted"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-cream text-sm font-bold truncate",children:t.title}),t.is_active&&e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider bg-gold/20 text-gold px-2 py-0.5 rounded",children:"Active"})]}),t.description&&e.jsx("p",{className:"text-muted text-xs mt-1",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted",children:[e.jsxs("span",{className:"text-gold font-bold",children:[t.multiplier,"x XP"]}),e.jsxs("span",{children:[_(t.start_date)," â€” ",_(t.end_date)]})]})]}),x&&e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[t.is_active&&e.jsx("button",{onClick:()=>X(t.id),className:"p-2 rounded hover:bg-gold/10 text-gold/60 hover:text-gold transition-colors",title:"End event early",children:e.jsx(W,{size:14})}),e.jsx("button",{onClick:()=>O(t),className:"p-2 rounded hover:bg-surface-raised text-muted hover:text-cream transition-colors",title:"Edit",children:e.jsx(B,{size:14})}),e.jsx("button",{onClick:()=>$(t.id),className:"p-2 rounded hover:bg-crimson/10 text-crimson/60 hover:text-crimson transition-colors",title:"Delete",children:e.jsx(G,{size:14})})]})]})},t.id))}),e.jsx(Z,{isOpen:M,onClose:()=>r(!1),title:h?"Edit Event":"New Seasonal Event",actions:[{label:"Cancel",onClick:()=>r(!1),className:"game-btn game-btn-red"},{label:k?"Saving...":"Save",onClick:I,className:"game-btn game-btn-gold",disabled:k}],children:e.jsxs("div",{className:"space-y-4",children:[C&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-sm",children:C}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold text-sm font-medium mb-1",children:"Title"}),e.jsx("input",{type:"text",value:g,onChange:t=>f(t.target.value),placeholder:"e.g. Summer Challenge",className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold text-sm font-medium mb-1",children:"Description (optional)"}),e.jsx("textarea",{value:w,onChange:t=>b(t.target.value),placeholder:"What's the event about?",rows:2,className:"field-input resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold text-sm font-medium mb-1",children:"XP Multiplier"}),e.jsx("input",{type:"number",min:"1.1",step:"0.1",value:D,onChange:t=>j(t.target.value),placeholder:"e.g. 2.0",className:"field-input"}),e.jsx("p",{className:"text-muted text-xs mt-1",children:"All XP earned during this event is multiplied by this amount."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold text-sm font-medium mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:c,onChange:t=>v(t.target.value),className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold text-sm font-medium mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:m,onChange:t=>N(t.target.value),className:"field-input"})]})]})]})})]})}export{ae as default};
