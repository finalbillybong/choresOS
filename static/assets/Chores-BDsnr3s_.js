import{c as ne,r,b as y,j as e,U as se,A as he,C as _e,u as Ae,a as qe,S as re,d as Ee}from"./index-CgOd0SBs.js";import{t as te,a as Ce}from"./questThemeText-CMgOkVTC.js";import{M as oe}from"./Modal-CnYzv4D-.js";import{B as Te,C as Pe,a as ze,F as De}from"./filter-aDV7rcCs.js";import{S as ce}from"./star-CPCUo3Hi.js";import{C as Z}from"./camera-BUlMIaZx.js";import{R as Fe,a as $e}from"./rotate-cw-D_fUnFE4.js";import{E as Qe,a as Oe}from"./eye-Dc1whOFt.js";import{P as be}from"./plus-DrjRwHSr.js";import{S as Me}from"./scroll-text-CJM_hEDX.js";import{Z as Le}from"./zap-BAMm6EWK.js";import{P as Ie}from"./pencil-JgYJj5G4.js";import{T as Re}from"./trash-2-CayEH4fI.js";import{C as ge}from"./circle-check-BvVmTZtO.js";import"./index-Dkb11lla.js";import"./proxy-Dq3ACGF8.js";const Ke=[{value:"easy",label:"Easy",level:1},{value:"medium",label:"Medium",level:2},{value:"hard",label:"Hard",level:3},{value:"expert",label:"Expert",level:4}],ye="bg-navy-light border-2 border-border text-cream p-2 rounded text-sm focus:border-sky focus:outline-none transition-colors",je={title:"",description:"",points:10,difficulty:"easy",category_id:""};function He({isOpen:i,onClose:d,onCreated:j,categories:n,editingChore:c}){const{colorTheme:T}=ne(),[p,v]=r.useState({...je}),[H,P]=r.useState(""),[z,D]=r.useState(!1),[_,F]=r.useState([]),[N,A]=r.useState(!1);r.useEffect(()=>{i&&(v(c?{title:c.title||"",description:c.description||"",points:c.points||10,difficulty:c.difficulty||"easy",category_id:c.category_id?String(c.category_id):""}:{...je}),P(""),A(!1))},[i,c]),r.useEffect(()=>{i&&!c&&y("/api/chores/templates").then(l=>F(Array.isArray(l)?l:[])).catch(()=>F([]))},[i,c]);const w=(l,h)=>{v(u=>({...u,[l]:h}))},C=l=>{const h=n.find(u=>u.name.toLowerCase()===l.category_name.toLowerCase());v({title:l.title,description:l.description||"",points:l.suggested_points,difficulty:l.difficulty,category_id:h?String(h.id):""}),A(!1)},$=async()=>{if(!p.title.trim()){P("Every quest needs a name, adventurer!");return}if(p.points<1){P("The reward must be at least 1 XP.");return}if(!p.category_id){P("Please select a category for this quest.");return}D(!0),P("");const l={title:p.title.trim(),description:p.description.trim()||null,points:Number(p.points),difficulty:p.difficulty,category_id:Number(p.category_id),recurrence:"once",requires_photo:!1,assigned_user_ids:[]};try{c?await y(`/api/chores/${c.id}`,{method:"PUT",body:l}):await y("/api/chores",{method:"POST",body:l}),j(),d()}catch(h){P(h.message||"The quest scroll could not be saved.")}finally{D(!1)}},q=_.reduce((l,h)=>{const u=h.category_name||"Other";return l[u]||(l[u]=[]),l[u].push(h),l},{});return e.jsx(oe,{isOpen:i,onClose:d,title:c?"Edit Quest Scroll":"New Quest Scroll",actions:[{label:"Cancel",onClick:d,className:"game-btn game-btn-blue"},{label:z?"Saving...":c?"Update Quest":"Create Quest",onClick:$,className:"game-btn game-btn-gold",disabled:z}],children:e.jsxs("div",{className:"space-y-4",children:[H&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-sm",children:H}),!c&&e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>A(!N),className:"flex items-center gap-2 text-sky text-sm hover:text-sky/80 transition-colors",children:[e.jsx(Te,{size:14}),N?"Hide templates":"Choose from Quest Templates"]}),N&&e.jsxs("div",{className:"mt-3 max-h-60 overflow-y-auto space-y-3 border border-border rounded-lg p-3 bg-surface-raised/30",children:[Object.entries(q).map(([l,h])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-bold uppercase tracking-wider mb-1",children:l}),e.jsx("div",{className:"space-y-1",children:h.map(u=>e.jsxs("button",{onClick:()=>C(u),className:"w-full text-left px-3 py-2 rounded-lg hover:bg-surface-raised transition-colors border border-transparent hover:border-sky/30",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-cream text-sm font-medium",children:te(u.title,T)}),e.jsxs("span",{className:"flex items-center gap-1 text-gold text-xs",children:[e.jsx(ce,{size:10,className:"fill-gold"}),u.suggested_points," XP"]})]}),u.description&&e.jsx("p",{className:"text-muted text-xs line-clamp-1 mt-0.5",children:Ce(u.title,u.description,T)})]},u.id))})]},l)),_.length===0&&e.jsx("p",{className:"text-muted text-xs text-center py-3",children:"No templates available yet."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Quest Name"}),e.jsx("input",{type:"text",value:p.title,onChange:l=>w("title",l.target.value),placeholder:"Defeat the Dust Bunnies",className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Description"}),e.jsx("textarea",{value:p.description,onChange:l=>w("description",l.target.value),placeholder:"Describe the quest details...",rows:3,className:"field-input resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"XP Reward"}),e.jsx("input",{type:"number",min:1,value:p.points,onChange:l=>w("points",l.target.value),className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Difficulty"}),e.jsx("select",{value:p.difficulty,onChange:l=>w("difficulty",l.target.value),className:`${ye} w-full p-3`,children:Ke.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Category"}),e.jsxs("select",{value:p.category_id,onChange:l=>w("category_id",l.target.value),className:`${ye} w-full p-3`,children:[e.jsx("option",{value:"",children:"Select category..."}),n.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})]})]})})}const ve=[{value:"once",label:"One-time"},{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"fortnightly",label:"Fortnightly"}],Ue=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"fortnightly",label:"Fortnightly"},{value:"monthly",label:"Monthly"}],ie=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Ne="bg-navy-light border-2 border-border text-cream p-2 rounded text-sm focus:border-sky focus:outline-none transition-colors";function We({isOpen:i,onClose:d,onAssigned:j,chore:n,kids:c}){const{colorTheme:T}=ne(),[p,v]=r.useState({}),[H,P]=r.useState(null),[z,D]=r.useState("once"),[_,F]=r.useState([]),[N,A]=r.useState(!1),[w,C]=r.useState("daily"),[$,q]=r.useState(null),[l,h]=r.useState(!1),[u,I]=r.useState(""),[ae,G]=r.useState(!1);r.useEffect(()=>{!i||!n||!c.length||(y(`/api/chores/${n.id}/rules`).then(t=>{var g;const a=Array.isArray(t)?t:[],o=a.some(Q=>Q.is_active);G(o);const x={};for(const Q of c){const B=a.find(R=>R.user_id===Q.id&&R.is_active);x[Q.id]={selected:!!B,requires_photo:(B==null?void 0:B.requires_photo)||!1}}v(x);const f=a.find(Q=>Q.is_active);f?f.recurrence==="custom"&&((g=f.custom_days)!=null&&g.length)?(D("daily"),F(f.custom_days)):(D(f.recurrence||"once"),F([])):(D("once"),F([]))}).catch(()=>{const t={};for(const a of c)t[a.id]={selected:!1,requires_photo:!1};v(t),G(!1),D("once"),F([])}),y(`/api/chores/${n.id}/rotation`).then(t=>{if(t&&t.kid_ids&&t.kid_ids.length>=2){A(!0),C(t.cadence||"daily");const a=t.current_index??0;q(t.kid_ids[a]??t.kid_ids[0])}else A(!1),C("daily"),q(null)}).catch(()=>{A(!1),C("daily"),q(null)}),I(""))},[i,n,c]);const S=Object.entries(p).filter(([,t])=>t.selected),k=S.length,O=ae&&k===0;r.useEffect(()=>{if(!N||k<2)return;const t=S.map(([a])=>Number(a));($==null||!t.includes(Number($)))&&q(t[0])},[N,k,p]);const J=t=>{v(a=>{var o;return{...a,[t]:{...a[t],selected:!((o=a[t])!=null&&o.selected)}}})},U=t=>{F(a=>a.includes(t)?a.filter(o=>o!==t):[...a,t])},M=()=>{const a=!S.some(([,o])=>o.requires_photo);v(o=>{const x={...o};for(const[f,g]of Object.entries(x))g.selected&&(x[f]={...g,requires_photo:a});return x})},W=()=>_.length>0?{recurrence:"custom",custom_days:[..._]}:{recurrence:z,custom_days:null},ee=async()=>{h(!0),I("");const{recurrence:t,custom_days:a}=W();let o=S.map(([f,g])=>({user_id:Number(f),recurrence:t,custom_days:a,requires_photo:g.requires_photo}));const x={assignments:o};if(N&&k>=2){if($!=null){const f=o.findIndex(g=>g.user_id===Number($));if(f>0){const[g]=o.splice(f,1);o.unshift(g)}}x.rotation={enabled:!0,cadence:w}}try{await y(`/api/chores/${n.id}/assign`,{method:"POST",body:x}),j(),d()}catch(f){I(f.message||"Failed to assign quest.")}finally{h(!1)}};if(!n)return null;const Y=k>0&&S.every(([,t])=>t.requires_photo),V=k>0&&S.some(([,t])=>t.requires_photo),L=_.length>0;return(()=>{if(L)return _.slice().sort((a,o)=>a-o).map(a=>ie[a]).join(", ");const t=ve.find(a=>a.value===z);return t?t.label:z})(),e.jsx(oe,{isOpen:i,onClose:d,title:"Quest Assignment Scroll",actions:[{label:"Cancel",onClick:d,className:"game-btn game-btn-blue"},{label:l?"Saving...":O?"Unassign All":k===0?"Save":"Assign Quest",onClick:ee,className:O?"game-btn game-btn-red":"game-btn game-btn-gold",disabled:l}],children:e.jsxs("div",{className:"space-y-4",children:[u&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-sm",children:u}),e.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface-raised/30",children:[e.jsx("h3",{className:"text-cream font-bold text-base",children:te(n.title,T)}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gold text-sm font-bold",children:[e.jsx(ce,{size:12,className:"fill-gold"}),n.points," XP"]}),e.jsx("span",{className:"text-muted text-xs capitalize",children:n.difficulty}),n.category&&e.jsx("span",{className:"text-muted text-xs",children:n.category.name||n.category})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-cream text-sm font-medium mb-2",children:[e.jsx(se,{size:14}),"Select Heroes"]}),e.jsx("div",{className:"space-y-2",children:c.map(t=>{const a=p[t.id];if(!a)return null;const o=a.selected,x=H===t.id&&o;return e.jsxs("div",{className:`rounded-lg border transition-colors ${o?"border-sky/40 bg-sky/5":"border-border"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 p-3",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:()=>J(t.id),className:"w-4 h-4 accent-sky flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(he,{config:t.avatar_config,size:"xs",name:t.display_name||t.username}),e.jsx("span",{className:"text-cream text-sm font-medium truncate",children:t.display_name||t.username})]}),o&&a.requires_photo&&e.jsx(Z,{size:14,className:"text-sky flex-shrink-0"}),o&&e.jsx("button",{type:"button",onClick:()=>P(x?null:t.id),className:"p-1 rounded hover:bg-surface-raised text-muted hover:text-cream transition-colors",children:x?e.jsx(Pe,{size:16}):e.jsx(ze,{size:16})})]}),x&&e.jsx("div",{className:"px-3 pb-3 border-t border-border/50 pt-3 ml-7",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-muted text-xs font-medium flex items-center gap-1.5",children:[e.jsx(Z,{size:12}),"Photo Proof"]}),e.jsx("button",{type:"button",onClick:()=>v(f=>({...f,[t.id]:{...f[t.id],requires_photo:!a.requires_photo}})),className:`relative w-10 h-5 rounded-full border-2 transition-colors ${a.requires_photo?"bg-sky/20 border-sky":"bg-navy-light border-border"}`,children:e.jsx("div",{className:`absolute top-0.5 w-3.5 h-3.5 rounded-full transition-all ${a.requires_photo?"left-5 bg-sky":"left-0.5 bg-muted"}`})})]})})]},t.id)})})]}),O&&e.jsx("div",{className:"p-3 rounded-lg border border-crimson/30 bg-crimson/10 text-crimson text-sm",children:"No heroes selected. Saving will remove all assignments from this quest."}),k>0&&e.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface-raised/20 space-y-3",children:[e.jsxs("label",{className:"text-cream text-sm font-medium flex items-center gap-2",children:[e.jsx(_e,{size:14}),"Schedule"]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-muted text-xs font-medium mb-1",children:["Frequency",L&&e.jsx("span",{className:"text-sky ml-1",children:"(overridden by quest days)"})]}),e.jsx("select",{value:z,onChange:t=>D(t.target.value),disabled:L,className:`${Ne} w-full${L?" opacity-50 cursor-not-allowed":""}`,children:ve.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-muted text-xs font-medium mb-1",children:["Quest Days",e.jsx("span",{className:"text-muted/60 ml-1",children:"(optional)"})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:ie.map((t,a)=>e.jsx("button",{type:"button",onClick:()=>U(a),className:`px-2.5 py-1.5 rounded border text-xs font-medium transition-colors ${_.includes(a)?"border-sky bg-sky/20 text-sky":"border-border text-muted hover:border-cream/30"}`,children:t},t))}),e.jsx("p",{className:"text-muted text-xs mt-1",children:L?`Quest appears on ${_.slice().sort((t,a)=>t-a).map(t=>ie[t]).join(", ")}.`:"Pick specific days, or leave empty to use the frequency above."})]})]}),k>0&&e.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface-raised/20",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-cream text-sm font-medium flex items-center gap-2",children:[e.jsx(Z,{size:14}),"Require Photo Proof"]}),e.jsx("button",{type:"button",onClick:M,className:`relative w-12 h-6 rounded-full border-2 transition-colors ${Y?"bg-sky/20 border-sky":V?"bg-sky/10 border-sky/50":"bg-navy-light border-border"}`,children:e.jsx("div",{className:`absolute top-0.5 w-4 h-4 rounded-full transition-all ${Y?"left-6 bg-sky":V?"left-6 bg-sky/50":"left-0.5 bg-muted"}`})})]}),e.jsx("p",{className:"text-muted text-xs mt-1",children:Y?"All heroes must attach a photo when completing this quest.":V?"Some heroes require photo proof. Expand individual settings to adjust.":"Heroes can complete this quest without attaching a photo."})]}),k>=2&&e.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface-raised/20 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-cream text-sm font-medium flex items-center gap-2",children:[e.jsx(Fe,{size:14}),"Kid Rotation"]}),e.jsx("button",{type:"button",onClick:()=>A(!N),className:`relative w-12 h-6 rounded-full border-2 transition-colors ${N?"bg-purple/20 border-purple":"bg-navy-light border-border"}`,children:e.jsx("div",{className:`absolute top-0.5 w-4 h-4 rounded-full transition-all ${N?"left-6 bg-purple":"left-0.5 bg-muted"}`})})]}),e.jsx("p",{className:"text-muted text-xs",children:"Alternate which hero is assigned. The schedule above controls when the quest appears."}),N&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-muted text-xs font-medium mb-1",children:"Swap Every"}),e.jsx("select",{value:w,onChange:t=>C(t.target.value),className:`${Ne} w-full`,children:Ue.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-muted text-xs font-medium mb-1",children:"Starts With"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:S.map(([t])=>{const a=c.find(x=>x.id===Number(t));if(!a)return null;const o=Number(t)===Number($);return e.jsxs("button",{type:"button",onClick:()=>q(Number(t)),className:`flex items-center gap-2 px-3 py-2 rounded-lg border-2 transition-colors text-sm ${o?"border-purple bg-purple/15 text-purple":"border-border text-muted hover:border-cream/30"}`,children:[e.jsx(he,{config:a.avatar_config,size:"xs",name:a.display_name||a.username}),a.display_name||a.username]},t)})}),e.jsx("p",{className:"text-muted text-xs mt-1",children:"This hero gets the quest first, then it rotates."})]})]})]})]})})}const Ye=[{value:"easy",label:"Easy",level:1},{value:"medium",label:"Medium",level:2},{value:"hard",label:"Hard",level:3},{value:"expert",label:"Expert",level:4}],Be={easy:1,medium:2,hard:3,expert:4},Xe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],we="bg-navy-light border-2 border-border text-cream p-2 rounded text-sm focus:border-sky focus:outline-none transition-colors";function Ve({level:i}){const d=typeof i=="string"?Be[i]||1:i||1;return e.jsx("div",{className:"flex items-center gap-0.5",children:[1,2,3,4].map(j=>e.jsx(ce,{size:14,className:j<=d?"text-gold fill-gold":"text-muted"},j))})}function Ze({category:i}){const d=typeof i=="object"?i==null?void 0:i.name:i;return e.jsx("span",{className:"inline-block px-2 py-0.5 rounded-full text-xs border bg-cream/10 text-muted border-border capitalize",children:d||"General"})}function Ge({recurrence:i,customDays:d}){return!i||i==="once"?null:e.jsxs("div",{className:"flex items-center gap-1 text-muted text-xs",children:[e.jsx($e,{size:12}),e.jsx("span",{className:"capitalize",children:i}),i==="custom"&&(d==null?void 0:d.length)>0&&e.jsxs("span",{className:"text-muted",children:["(",d.map(j=>Xe[j]||j).join(", "),")"]})]})}function Je(){const i=new Date,d=i.getDay(),j=d===0?-6:1-d,n=new Date(i);return n.setDate(i.getDate()+j),n.toISOString().slice(0,10)}function es(){return new Date().toISOString().slice(0,10)}function gs(){var fe;const{user:i}=Ae(),{colorTheme:d}=ne(),j=qe(),n=(i==null?void 0:i.role)==="parent"||(i==null?void 0:i.role)==="admin",c=(i==null?void 0:i.role)==="kid",[T,p]=r.useState([]),[v,H]=r.useState([]),[P,z]=r.useState([]),[D,_]=r.useState([]),[F,N]=r.useState(!0),[A,w]=r.useState(""),[C,$]=r.useState("library"),[q,l]=r.useState(""),[h,u]=r.useState(""),[I,ae]=r.useState(!1),[G,S]=r.useState(!1),[k,O]=r.useState(null),[J,U]=r.useState(null),[M,W]=r.useState(null),[ee,Y]=r.useState(!1),[V,L]=r.useState(null),[t,a]=r.useState({}),o=r.useCallback(async()=>{try{w("");const s=await y("/api/chores");p(Array.isArray(s)?s:s.chores||s.items||[])}catch(s){w(s.message||"Failed to load quests from the guild board.")}},[]),x=r.useCallback(async()=>{if(c)try{const s=Je(),m=es(),b=await y(`/api/calendar?week_start=${s}`),X=b.days&&b.days[m]||[];_(X)}catch{}},[c]),f=r.useCallback(async()=>{try{const s=await y("/api/chores/categories");H(Array.isArray(s)?s:s.categories||[])}catch{}},[]),g=r.useCallback(async()=>{if(n)try{const s=await y("/api/stats/family");z(Array.isArray(s)?s:[])}catch{try{const s=await y("/api/admin/users"),m=Array.isArray(s)?s:s.users||[];z(m.filter(b=>b.role==="kid"))}catch{}}},[n]),Q=r.useCallback(async()=>{await Promise.all([o(),x(),f(),g()])},[o,x,f,g]);r.useEffect(()=>{Q().finally(()=>N(!1))},[Q]),r.useEffect(()=>{const s=()=>{o(),x()};return window.addEventListener("ws:message",s),()=>window.removeEventListener("ws:message",s)},[o,x]);const B=async s=>{const m=s.id;if(!(s.requires_photo&&!t[m])){L(m);try{if(s.requires_photo&&t[m]){const b=new FormData;b.append("file",t[m]),await y(`/api/chores/${m}/complete`,{method:"POST",body:b})}else await y(`/api/chores/${m}/complete`,{method:"POST"});a(b=>{const X={...b};return delete X[m],X}),await Q()}catch(b){w(b.message||"Failed to complete quest")}finally{L(null)}}},R={};if(c)for(const s of D){const m=s.chore_id||((fe=s.chore)==null?void 0:fe.id);m&&(R[m]=s.status)}const de=T,me=T.filter(s=>(s.assignment_count||0)>0),ue=(n?C==="library"?de:me:T).filter(s=>{var m;if(q&&((m=s.category)==null?void 0:m.name)!==q||h&&s.difficulty!==h)return!1;if(c&&!I){const b=R[s.id];if(b==="completed"||b==="verified")return!1}return!0}),xe=c?Object.values(R).filter(s=>s==="completed"||s==="verified").length:0,Se=async()=>{if(M){Y(!0);try{await y(`/api/chores/${M.id}`,{method:"DELETE"}),W(null),await o()}catch(s){w(s.message||"Failed to remove the quest.")}finally{Y(!1)}}};return F?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[e.jsx(re,{size:48,className:"text-sky animate-pulse"}),e.jsx("p",{className:"text-cream text-lg font-bold animate-pulse",children:"Loading quests from the guild board..."})]}):e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{size:28,className:"text-sky"}),e.jsx("h1",{className:"text-cream text-xl font-extrabold leading-relaxed",children:n?"Quest Management":"My Quests"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[c&&xe>0&&e.jsxs("button",{onClick:()=>ae(s=>!s),className:"flex items-center gap-1.5 text-muted hover:text-cream text-sm transition-colors",children:[I?e.jsx(Qe,{size:16}):e.jsx(Oe,{size:16}),I?"Hide":"Show"," completed (",xe,")"]}),n&&e.jsxs("button",{onClick:()=>{O(null),S(!0)},className:"game-btn game-btn-blue flex items-center gap-2",children:[e.jsx(be,{size:16}),"Create Quest"]})]})]}),A&&e.jsx("div",{className:"p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm text-center",children:A}),n&&e.jsxs("div",{className:"flex gap-1 bg-surface-raised/50 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>$("library"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-md text-sm font-medium transition-colors ${C==="library"?"bg-sky/20 text-sky border border-sky/30":"text-muted hover:text-cream"}`,children:[e.jsx(Me,{size:16}),"Quest Library",e.jsxs("span",{className:"text-xs opacity-70",children:["(",de.length,")"]})]}),e.jsxs("button",{onClick:()=>$("active"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-md text-sm font-medium transition-colors ${C==="active"?"bg-emerald/20 text-emerald border border-emerald/30":"text-muted hover:text-cream"}`,children:[e.jsx(Le,{size:16}),"Active Quests",e.jsxs("span",{className:"text-xs opacity-70",children:["(",me.length,")"]})]})]}),e.jsx("div",{className:"game-panel p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted",children:[e.jsx(De,{size:16}),e.jsx("span",{className:"text-sm",children:"Filters:"})]}),e.jsxs("select",{value:q,onChange:s=>l(s.target.value),className:we,children:[e.jsx("option",{value:"",children:"All Categories"}),v.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]}),e.jsxs("select",{value:h,onChange:s=>u(s.target.value),className:we,children:[e.jsx("option",{value:"",children:"All Difficulties"}),Ye.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]})}),ue.length===0?e.jsxs("div",{className:"game-panel p-10 text-center",children:[e.jsx(re,{size:40,className:"mx-auto text-muted mb-4"}),e.jsx("p",{className:"text-muted text-sm",children:T.length===0?"The quest board is empty. No adventures await... yet!":n&&C==="active"?"No active quests. Assign some from the Quest Library!":"No quests match your search. Try adjusting the filters."}),n&&T.length===0&&e.jsxs("button",{onClick:()=>{O(null),S(!0)},className:"game-btn game-btn-blue mt-4 inline-flex items-center gap-2",children:[e.jsx(be,{size:16}),"Post First Quest"]})]}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:ue.map(s=>{const m=c?R[s.id]:null,b=m==="completed"||m==="verified",X=c&&(m==="pending"||m==="assigned"),le=V===s.id,K=s.assignment_count||0;return e.jsxs("div",{className:`game-panel p-4 flex flex-col gap-3 cursor-pointer hover:border-sky/40 transition-colors ${b?"opacity-50":""}`,onClick:()=>{n&&C==="library"&&K===0?U(s):j(`/chores/${s.id}`)},children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"text-cream text-lg font-bold leading-relaxed flex-1",children:te(s.title,d)}),n&&e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("button",{onClick:E=>{E.stopPropagation(),O(s),S(!0)},className:"p-1.5 rounded hover:bg-surface-raised transition-colors text-muted hover:text-sky","aria-label":"Edit quest",children:e.jsx(Ie,{size:14})}),e.jsx("button",{onClick:E=>{E.stopPropagation(),W(s)},className:"p-1.5 rounded hover:bg-surface-raised transition-colors text-muted hover:text-crimson","aria-label":"Delete quest",children:e.jsx(Re,{size:14})})]}),b&&e.jsx(ge,{size:18,className:"text-emerald flex-shrink-0"})]}),s.description&&e.jsx("p",{className:"text-muted text-sm line-clamp-2",children:Ce(s.title,s.description,d)}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2 mt-auto",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gold font-bold text-sm",children:[e.jsx("span",{className:"text-lg",children:"â˜…"}),s.points," XP"]}),e.jsx(Ve,{level:s.difficulty||1})]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[e.jsx(Ze,{category:s.category}),e.jsx(Ge,{recurrence:s.recurrence,customDays:s.custom_days}),s.requires_photo&&e.jsxs("span",{className:"flex items-center gap-1 text-muted text-xs",children:[e.jsx(Z,{size:12}),"Photo"]}),n&&K>0&&e.jsxs("span",{className:"flex items-center gap-1 text-emerald text-xs font-medium",children:[e.jsx(se,{size:12}),K," ",K===1?"hero":"heroes"]}),n&&K===0&&e.jsx("span",{className:"text-muted/60 text-xs italic",children:"Not assigned"})]}),n&&C==="library"&&K===0&&e.jsxs("button",{onClick:E=>{E.stopPropagation(),U(s)},className:"game-btn game-btn-gold w-full flex items-center justify-center gap-2 !text-xs !py-1.5",children:[e.jsx(se,{size:14}),"Assign to Heroes"]}),n&&K>0&&e.jsxs("button",{onClick:E=>{E.stopPropagation(),U(s)},className:"game-btn game-btn-purple w-full flex items-center justify-center gap-2 !text-xs !py-1.5",children:[e.jsx(se,{size:14}),"Manage Assignments"]}),X&&e.jsxs("div",{className:"mt-1 space-y-2",onClick:E=>E.stopPropagation(),children:[s.requires_photo&&e.jsxs("label",{className:"inline-flex items-center gap-1.5 text-xs text-muted cursor-pointer hover:text-cream transition-colors bg-surface-raised px-3 py-1.5 rounded-lg border border-border",children:[e.jsx(Z,{size:14}),e.jsx("span",{children:t[s.id]?t[s.id].name:"Attach proof photo"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:E=>a(ke=>{var pe;return{...ke,[s.id]:((pe=E.target.files)==null?void 0:pe[0])||null}})})]}),e.jsx("button",{onClick:()=>B(s),disabled:le||s.requires_photo&&!t[s.id],className:`game-btn game-btn-blue w-full flex items-center justify-center gap-2 ${le?"opacity-60 cursor-wait":""} ${s.requires_photo&&!t[s.id]?"opacity-40 cursor-not-allowed":""}`,children:le?e.jsxs(e.Fragment,{children:[e.jsx(Ee,{size:14,className:"animate-spin"}),"Completing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{size:14}),"Complete Quest"]})})]})]},s.id)})}),e.jsx(He,{isOpen:G,onClose:()=>{S(!1),O(null)},onCreated:o,categories:v,editingChore:k}),e.jsx(We,{isOpen:!!J,onClose:()=>U(null),onAssigned:()=>{o()},chore:J,kids:P}),e.jsx(oe,{isOpen:!!M,onClose:()=>W(null),title:"Abandon Quest?",actions:[{label:"Keep Quest",onClick:()=>W(null),className:"game-btn game-btn-blue"},{label:ee?"Removing...":"Remove Quest",onClick:Se,className:"game-btn game-btn-red",disabled:ee}],children:e.jsxs("p",{className:"text-muted",children:["Are you sure you want to remove the quest"," ",e.jsxs("span",{className:"text-cream text-lg font-bold",children:['"',te((M==null?void 0:M.title)||"",d),'"']}),"? This action cannot be undone. All associated records will be archived."]})})]})}export{gs as default};
