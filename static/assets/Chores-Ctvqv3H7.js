import{c as ie,r as l,b as j,j as e,A as be,u as _e,a as Ae,S as le,d as Ee}from"./index-DNIywqZZ.js";import{t as Y,a as re}from"./questThemeText-BK2D7k-h.js";import{M as ne}from"./Modal-CXOHEPT9.js";import{B as qe,C as Te,a as ze,F as Pe,S as De}from"./search-CSft3F9D.js";import{S as oe}from"./star-B3_Vd0i4.js";import{U as ee}from"./users-CcC0dEo-.js";import{C as V}from"./camera-iIMA5gvZ.js";import{R as Fe,a as $e}from"./rotate-cw-CVAXFsaT.js";import{E as Le,a as Qe}from"./eye-Bg-T-tVP.js";import{P as ge}from"./plus-B2UCsRcR.js";import{S as Re}from"./scroll-text-BHhARbHu.js";import{Z as Oe}from"./zap-BUcqI1QU.js";import{P as Me}from"./pencil-BbHMbnGE.js";import{T as Ie}from"./trash-2-Do98SmEs.js";import{C as ye}from"./circle-check-BUZ521bp.js";import"./index-D52oPGzx.js";import"./proxy-pUA5QpF8.js";const Ke=[{value:"easy",label:"Easy",level:1},{value:"medium",label:"Medium",level:2},{value:"hard",label:"Hard",level:3},{value:"expert",label:"Expert",level:4}],je="bg-navy-light border-2 border-border text-cream p-2 rounded text-sm focus:border-sky focus:outline-none transition-colors",ve={title:"",description:"",points:10,difficulty:"easy",category_id:""};function He({isOpen:i,onClose:m,onCreated:v,categories:n,editingChore:c}){const{colorTheme:q}=ie(),[p,y]=l.useState({...ve}),[H,T]=l.useState(""),[N,P]=l.useState(!1),[O,D]=l.useState([]),[_,k]=l.useState(!1);l.useEffect(()=>{i&&(y(c?{title:c.title||"",description:c.description||"",points:c.points||10,difficulty:c.difficulty||"easy",category_id:c.category_id?String(c.category_id):""}:{...ve}),T(""),k(!1))},[i,c]),l.useEffect(()=>{i&&!c&&j("/api/chores/templates").then(r=>D(Array.isArray(r)?r:[])).catch(()=>D([]))},[i,c]);const C=(r,b)=>{y(h=>({...h,[r]:b}))},A=r=>{const b=n.find(h=>h.name.toLowerCase()===r.category_name.toLowerCase());y({title:r.title,description:r.description||"",points:r.suggested_points,difficulty:r.difficulty,category_id:b?String(b.id):""}),k(!1)},M=async()=>{if(!p.title.trim()){T("Every quest needs a name, adventurer!");return}if(p.points<1){T("The reward must be at least 1 XP.");return}if(!p.category_id){T("Please select a category for this quest.");return}P(!0),T("");const r={title:p.title.trim(),description:p.description.trim()||null,points:Number(p.points),difficulty:p.difficulty,category_id:Number(p.category_id),recurrence:"once",requires_photo:!1,assigned_user_ids:[]};try{c?await j(`/api/chores/${c.id}`,{method:"PUT",body:r}):await j("/api/chores",{method:"POST",body:r}),v(),m()}catch(b){T(b.message||"The quest scroll could not be saved.")}finally{P(!1)}},F=O.reduce((r,b)=>{const h=b.category_name||"Other";return r[h]||(r[h]=[]),r[h].push(b),r},{});return e.jsx(ne,{isOpen:i,onClose:m,title:c?"Edit Quest Scroll":"New Quest Scroll",actions:[{label:"Cancel",onClick:m,className:"game-btn game-btn-blue"},{label:N?"Saving...":c?"Update Quest":"Create Quest",onClick:M,className:"game-btn game-btn-gold",disabled:N}],children:e.jsxs("div",{className:"space-y-4",children:[H&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-sm",children:H}),!c&&e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>k(!_),className:"flex items-center gap-2 text-sky text-sm hover:text-sky/80 transition-colors",children:[e.jsx(qe,{size:14}),_?"Hide templates":"Choose from Quest Templates"]}),_&&e.jsxs("div",{className:"mt-3 max-h-60 overflow-y-auto space-y-3 border border-border rounded-lg p-3 bg-surface-raised/30",children:[Object.entries(F).map(([r,b])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-bold uppercase tracking-wider mb-1",children:r}),e.jsx("div",{className:"space-y-1",children:b.map(h=>e.jsxs("button",{onClick:()=>A(h),className:"w-full text-left px-3 py-2 rounded-lg hover:bg-surface-raised transition-colors border border-transparent hover:border-sky/30",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-cream text-sm font-medium",children:Y(h.title,q)}),e.jsxs("span",{className:"flex items-center gap-1 text-gold text-xs",children:[e.jsx(oe,{size:10,className:"fill-gold"}),h.suggested_points," XP"]})]}),h.description&&e.jsx("p",{className:"text-muted text-xs line-clamp-1 mt-0.5",children:re(h.title,h.description,q)})]},h.id))})]},r)),O.length===0&&e.jsx("p",{className:"text-muted text-xs text-center py-3",children:"No templates available yet."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Quest Name"}),e.jsx("input",{type:"text",value:p.title,onChange:r=>C("title",r.target.value),placeholder:"Defeat the Dust Bunnies",className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Description"}),e.jsx("textarea",{value:p.description,onChange:r=>C("description",r.target.value),placeholder:"Describe the quest details...",rows:3,className:"field-input resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"XP Reward"}),e.jsx("input",{type:"number",min:1,value:p.points,onChange:r=>C("points",r.target.value),className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Difficulty"}),e.jsx("select",{value:p.difficulty,onChange:r=>C("difficulty",r.target.value),className:`${je} w-full p-3`,children:Ke.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Category"}),e.jsxs("select",{value:p.category_id,onChange:r=>C("category_id",r.target.value),className:`${je} w-full p-3`,children:[e.jsx("option",{value:"",children:"Select category..."}),n.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]})]})})}const Ue=[{value:"once",label:"One-time"},{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"custom",label:"Custom Days"}],We=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"fortnightly",label:"Fortnightly"},{value:"monthly",label:"Monthly"}],Be=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Ne="bg-navy-light border-2 border-border text-cream p-2 rounded text-sm focus:border-sky focus:outline-none transition-colors";function Xe({isOpen:i,onClose:m,onAssigned:v,chore:n,kids:c}){const{colorTheme:q}=ie(),[p,y]=l.useState({}),[H,T]=l.useState(null),[N,P]=l.useState(!1),[O,D]=l.useState("weekly"),[_,k]=l.useState(null),[C,A]=l.useState(!1),[M,F]=l.useState(""),[r,b]=l.useState([]),[h,U]=l.useState(!1);l.useEffect(()=>{!i||!n||!c.length||(j(`/api/chores/${n.id}/rules`).then(t=>{const a=Array.isArray(t)?t:[];b(a);const o=a.some(x=>x.is_active);U(o);const d={};for(const x of c){const f=a.find(X=>X.user_id===x.id&&X.is_active);d[x.id]=f?{selected:!0,recurrence:f.recurrence||"daily",custom_days:f.custom_days||[],requires_photo:f.requires_photo||!1}:{selected:!1,recurrence:"daily",custom_days:[],requires_photo:!1}}y(d)}).catch(()=>{const t={};for(const a of c)t[a.id]={selected:!1,recurrence:"daily",custom_days:[],requires_photo:!1};y(t),b([]),U(!1)}),j(`/api/chores/${n.id}/rotation`).then(t=>{if(t&&t.kid_ids&&t.kid_ids.length>=2){P(!0),D(t.cadence||"weekly");const a=t.current_index??0;k(t.kid_ids[a]??t.kid_ids[0])}else P(!1),D("weekly"),k(null)}).catch(()=>{P(!1),D("weekly"),k(null)}),F(""))},[i,n,c]);const $=Object.entries(p).filter(([,t])=>t.selected),w=$.length,B=h&&w===0;l.useEffect(()=>{if(!N||w<2)return;const t=$.map(([a])=>Number(a));(_==null||!t.includes(Number(_)))&&k(t[0])},[N,w,p]);const se=t=>{y(a=>{var o;return{...a,[t]:{...a[t],selected:!((o=a[t])!=null&&o.selected)}}})},I=(t,a,o)=>{y(d=>({...d,[t]:{...d[t],[a]:o}}))},te=(t,a)=>{y(o=>{var x;const d=((x=o[t])==null?void 0:x.custom_days)||[];return{...o,[t]:{...o[t],custom_days:d.includes(a)?d.filter(f=>f!==a):[...d,a]}}})},W=()=>{const a=!$.some(([,o])=>o.requires_photo);y(o=>{const d={...o};for(const[x,f]of Object.entries(d))f.selected&&(d[x]={...f,requires_photo:a});return d})},Z=async()=>{A(!0),F("");let t=$.map(([o,d])=>({user_id:Number(o),recurrence:d.recurrence,custom_days:d.recurrence==="custom"?d.custom_days:null,requires_photo:d.requires_photo}));const a={assignments:t};if(N&&w>=2){if(_!=null){const o=t.findIndex(d=>d.user_id===Number(_));if(o>0){const[d]=t.splice(o,1);t.unshift(d)}}a.rotation={enabled:!0,cadence:O}}try{await j(`/api/chores/${n.id}/assign`,{method:"POST",body:a}),v(),m()}catch(o){F(o.message||"Failed to assign quest.")}finally{A(!1)}};if(!n)return null;const R=w>0&&$.every(([,t])=>t.requires_photo),z=w>0&&$.some(([,t])=>t.requires_photo);return e.jsx(ne,{isOpen:i,onClose:m,title:"Quest Assignment Scroll",actions:[{label:"Cancel",onClick:m,className:"game-btn game-btn-blue"},{label:C?"Saving...":B?"Unassign All":w===0?"Save":"Assign Quest",onClick:Z,className:B?"game-btn game-btn-red":"game-btn game-btn-gold",disabled:C}],children:e.jsxs("div",{className:"space-y-4",children:[M&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-sm",children:M}),e.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface-raised/30",children:[e.jsx("h3",{className:"text-cream font-bold text-base",children:Y(n.title,q)}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gold text-sm font-bold",children:[e.jsx(oe,{size:12,className:"fill-gold"}),n.points," XP"]}),e.jsx("span",{className:"text-muted text-xs capitalize",children:n.difficulty}),n.category&&e.jsx("span",{className:"text-muted text-xs",children:n.category.name||n.category})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-cream text-sm font-medium mb-2",children:[e.jsx(ee,{size:14}),"Select Heroes"]}),e.jsx("div",{className:"space-y-2",children:c.map(t=>{const a=p[t.id];if(!a)return null;const o=a.selected,d=H===t.id&&o;return e.jsxs("div",{className:`rounded-lg border transition-colors ${o?"border-sky/40 bg-sky/5":"border-border"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 p-3",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:()=>se(t.id),className:"w-4 h-4 accent-sky flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(be,{config:t.avatar_config,size:"xs",name:t.display_name||t.username}),e.jsx("span",{className:"text-cream text-sm font-medium truncate",children:t.display_name||t.username})]}),o&&a.requires_photo&&e.jsx(V,{size:14,className:"text-sky flex-shrink-0"}),o&&e.jsx("button",{type:"button",onClick:()=>T(d?null:t.id),className:"p-1 rounded hover:bg-surface-raised text-muted hover:text-cream transition-colors",children:d?e.jsx(Te,{size:16}):e.jsx(ze,{size:16})})]}),d&&e.jsxs("div",{className:"px-3 pb-3 space-y-3 border-t border-border/50 pt-3 ml-7",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-muted text-xs font-medium mb-1",children:"Recurrence"}),e.jsx("select",{value:a.recurrence,onChange:x=>I(t.id,"recurrence",x.target.value),className:`${Ne} w-full`,children:Ue.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))})]}),a.recurrence==="custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-muted text-xs font-medium mb-1",children:"Quest Days"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:Be.map((x,f)=>e.jsx("button",{type:"button",onClick:()=>te(t.id,f),className:`px-2 py-1 rounded border text-xs transition-colors ${a.custom_days.includes(f)?"border-sky bg-sky/20 text-sky":"border-border text-muted hover:border-cream/30"}`,children:x},x))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-muted text-xs font-medium flex items-center gap-1.5",children:[e.jsx(V,{size:12}),"Photo Proof"]}),e.jsx("button",{type:"button",onClick:()=>I(t.id,"requires_photo",!a.requires_photo),className:`relative w-10 h-5 rounded-full border-2 transition-colors ${a.requires_photo?"bg-sky/20 border-sky":"bg-navy-light border-border"}`,children:e.jsx("div",{className:`absolute top-0.5 w-3.5 h-3.5 rounded-full transition-all ${a.requires_photo?"left-5 bg-sky":"left-0.5 bg-muted"}`})})]})]})]},t.id)})})]}),B&&e.jsx("div",{className:"p-3 rounded-lg border border-crimson/30 bg-crimson/10 text-crimson text-sm",children:"No heroes selected. Saving will remove all assignments from this quest."}),w>0&&e.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface-raised/20",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-cream text-sm font-medium flex items-center gap-2",children:[e.jsx(V,{size:14}),"Require Photo Proof"]}),e.jsx("button",{type:"button",onClick:W,className:`relative w-12 h-6 rounded-full border-2 transition-colors ${R?"bg-sky/20 border-sky":z?"bg-sky/10 border-sky/50":"bg-navy-light border-border"}`,children:e.jsx("div",{className:`absolute top-0.5 w-4 h-4 rounded-full transition-all ${R?"left-6 bg-sky":z?"left-6 bg-sky/50":"left-0.5 bg-muted"}`})})]}),e.jsx("p",{className:"text-muted text-xs mt-1",children:R?"All heroes must attach a photo when completing this quest.":z?"Some heroes require photo proof. Expand individual settings to adjust.":"Heroes can complete this quest without attaching a photo."})]}),w>=2&&e.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface-raised/20 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-cream text-sm font-medium flex items-center gap-2",children:[e.jsx(Fe,{size:14}),"Kid Rotation"]}),e.jsx("button",{type:"button",onClick:()=>P(!N),className:`relative w-12 h-6 rounded-full border-2 transition-colors ${N?"bg-purple/20 border-purple":"bg-navy-light border-border"}`,children:e.jsx("div",{className:`absolute top-0.5 w-4 h-4 rounded-full transition-all ${N?"left-6 bg-purple":"left-0.5 bg-muted"}`})})]}),N&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-muted text-xs font-medium mb-1",children:"Rotation Cadence"}),e.jsx("select",{value:O,onChange:t=>D(t.target.value),className:`${Ne} w-full`,children:We.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-muted text-xs font-medium mb-1",children:"Starts With"}),e.jsx("div",{className:"flex gap-2",children:$.map(([t])=>{const a=c.find(d=>d.id===Number(t));if(!a)return null;const o=Number(t)===Number(_);return e.jsxs("button",{type:"button",onClick:()=>k(Number(t)),className:`flex items-center gap-2 px-3 py-2 rounded-lg border-2 transition-colors text-sm ${o?"border-purple bg-purple/15 text-purple":"border-border text-muted hover:border-cream/30"}`,children:[e.jsx(be,{config:a.avatar_config,size:"xs",name:a.display_name||a.username}),a.display_name||a.username]},t)})}),e.jsx("p",{className:"text-muted text-xs mt-1",children:"This hero will be assigned the quest first, then it rotates."})]})]})]})]})})}const Ye=[{value:"easy",label:"Easy",level:1},{value:"medium",label:"Medium",level:2},{value:"hard",label:"Hard",level:3},{value:"expert",label:"Expert",level:4}],Ve={easy:1,medium:2,hard:3,expert:4},Ze=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Ce="bg-navy-light border-2 border-border text-cream p-2 rounded text-sm focus:border-sky focus:outline-none transition-colors";function Ge({level:i}){const m=typeof i=="string"?Ve[i]||1:i||1;return e.jsx("div",{className:"flex items-center gap-0.5",children:[1,2,3,4].map(v=>e.jsx(oe,{size:14,className:v<=m?"text-gold fill-gold":"text-muted"},v))})}function Je({category:i}){const m=typeof i=="object"?i==null?void 0:i.name:i;return e.jsx("span",{className:"inline-block px-2 py-0.5 rounded-full text-xs border bg-cream/10 text-muted border-border capitalize",children:m||"General"})}function es({recurrence:i,customDays:m}){return!i||i==="once"?null:e.jsxs("div",{className:"flex items-center gap-1 text-muted text-xs",children:[e.jsx($e,{size:12}),e.jsx("span",{className:"capitalize",children:i}),i==="custom"&&(m==null?void 0:m.length)>0&&e.jsxs("span",{className:"text-muted",children:["(",m.map(v=>Ze[v]||v).join(", "),")"]})]})}function ss(){const i=new Date,m=i.getDay(),v=m===0?-6:1-m,n=new Date(i);return n.setDate(i.getDate()+v),n.toISOString().slice(0,10)}function ts(){return new Date().toISOString().slice(0,10)}function vs(){var pe;const{user:i}=_e(),{colorTheme:m}=ie(),v=Ae(),n=(i==null?void 0:i.role)==="parent"||(i==null?void 0:i.role)==="admin",c=(i==null?void 0:i.role)==="kid",[q,p]=l.useState([]),[y,H]=l.useState([]),[T,N]=l.useState([]),[P,O]=l.useState([]),[D,_]=l.useState(!0),[k,C]=l.useState(""),[A,M]=l.useState("library"),[F,r]=l.useState(""),[b,h]=l.useState(""),[U,$]=l.useState(""),[w,B]=l.useState(!1),[se,I]=l.useState(!1),[te,W]=l.useState(null),[Z,R]=l.useState(null),[z,t]=l.useState(null),[a,o]=l.useState(!1),[d,x]=l.useState(null),[f,X]=l.useState({}),K=l.useCallback(async()=>{try{C("");const s=await j("/api/chores");p(Array.isArray(s)?s:s.chores||s.items||[])}catch(s){C(s.message||"Failed to load quests from the guild board.")}},[]),G=l.useCallback(async()=>{if(c)try{const s=ss(),u=ts(),g=await j(`/api/calendar?week_start=${s}`),L=g.days&&g.days[u]||[];O(L)}catch{}},[c]),ce=l.useCallback(async()=>{try{const s=await j("/api/chores/categories");H(Array.isArray(s)?s:s.categories||[])}catch{}},[]),de=l.useCallback(async()=>{if(n)try{const s=await j("/api/stats/family");N(Array.isArray(s)?s:[])}catch{try{const s=await j("/api/admin/users"),u=Array.isArray(s)?s:s.users||[];N(u.filter(g=>g.role==="kid"))}catch{}}},[n]),ae=l.useCallback(async()=>{await Promise.all([K(),G(),ce(),de()])},[K,G,ce,de]);l.useEffect(()=>{ae().finally(()=>_(!1))},[ae]),l.useEffect(()=>{const s=()=>{K(),G()};return window.addEventListener("ws:message",s),()=>window.removeEventListener("ws:message",s)},[K,G]);const we=async s=>{const u=s.id;if(!(s.requires_photo&&!f[u])){x(u);try{if(s.requires_photo&&f[u]){const g=new FormData;g.append("file",f[u]),await j(`/api/chores/${u}/complete`,{method:"POST",body:g})}else await j(`/api/chores/${u}/complete`,{method:"POST"});X(g=>{const L={...g};return delete L[u],L}),await ae()}catch(g){C(g.message||"Failed to complete quest")}finally{x(null)}}},J={};if(c)for(const s of P){const u=s.chore_id||((pe=s.chore)==null?void 0:pe.id);u&&(J[u]=s.status)}const me=q,ue=q.filter(s=>(s.assignment_count||0)>0),xe=(n?A==="library"?me:ue:q).filter(s=>{var u,g,L;if(F&&((u=s.category)==null?void 0:u.name)!==F||b&&s.difficulty!==b)return!1;if(U){const E=U.toLowerCase(),Q=Y(s.title||"",m).toLowerCase(),S=re(s.title||"",s.description||"",m).toLowerCase();if(!Q.includes(E)&&!S.includes(E)&&!((g=s.title)!=null&&g.toLowerCase().includes(E))&&!((L=s.description)!=null&&L.toLowerCase().includes(E)))return!1}if(c&&!w){const E=J[s.id];if(E==="completed"||E==="verified")return!1}return!0}),fe=c?Object.values(J).filter(s=>s==="completed"||s==="verified").length:0,Se=async()=>{if(z){o(!0);try{await j(`/api/chores/${z.id}`,{method:"DELETE"}),t(null),await K()}catch(s){C(s.message||"Failed to remove the quest.")}finally{o(!1)}}};return D?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[e.jsx(le,{size:48,className:"text-sky animate-pulse"}),e.jsx("p",{className:"text-cream text-lg font-bold animate-pulse",children:"Loading quests from the guild board..."})]}):e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{size:28,className:"text-sky"}),e.jsx("h1",{className:"text-cream text-xl font-extrabold leading-relaxed",children:n?"Quest Management":"My Quests"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[c&&fe>0&&e.jsxs("button",{onClick:()=>B(s=>!s),className:"flex items-center gap-1.5 text-muted hover:text-cream text-sm transition-colors",children:[w?e.jsx(Le,{size:16}):e.jsx(Qe,{size:16}),w?"Hide":"Show"," completed (",fe,")"]}),n&&e.jsxs("button",{onClick:()=>{W(null),I(!0)},className:"game-btn game-btn-blue flex items-center gap-2",children:[e.jsx(ge,{size:16}),"Create Quest"]})]})]}),k&&e.jsx("div",{className:"p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm text-center",children:k}),n&&e.jsxs("div",{className:"flex gap-1 bg-surface-raised/50 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>M("library"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-md text-sm font-medium transition-colors ${A==="library"?"bg-sky/20 text-sky border border-sky/30":"text-muted hover:text-cream"}`,children:[e.jsx(Re,{size:16}),"Quest Library",e.jsxs("span",{className:"text-xs opacity-70",children:["(",me.length,")"]})]}),e.jsxs("button",{onClick:()=>M("active"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-md text-sm font-medium transition-colors ${A==="active"?"bg-emerald/20 text-emerald border border-emerald/30":"text-muted hover:text-cream"}`,children:[e.jsx(Oe,{size:16}),"Active Quests",e.jsxs("span",{className:"text-xs opacity-70",children:["(",ue.length,")"]})]})]}),e.jsx("div",{className:"game-panel p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted",children:[e.jsx(Pe,{size:16}),e.jsx("span",{className:"text-sm",children:"Filters:"})]}),e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(De,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted"}),e.jsx("input",{type:"text",placeholder:"Search quests...",value:U,onChange:s=>$(s.target.value),className:"field-input pl-9 py-2"})]}),e.jsxs("select",{value:F,onChange:s=>r(s.target.value),className:Ce,children:[e.jsx("option",{value:"",children:"All Categories"}),y.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]}),e.jsxs("select",{value:b,onChange:s=>h(s.target.value),className:Ce,children:[e.jsx("option",{value:"",children:"All Difficulties"}),Ye.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]})}),xe.length===0?e.jsxs("div",{className:"game-panel p-10 text-center",children:[e.jsx(le,{size:40,className:"mx-auto text-muted mb-4"}),e.jsx("p",{className:"text-muted text-sm",children:q.length===0?"The quest board is empty. No adventures await... yet!":n&&A==="active"?"No active quests. Assign some from the Quest Library!":"No quests match your search. Try adjusting the filters."}),n&&q.length===0&&e.jsxs("button",{onClick:()=>{W(null),I(!0)},className:"game-btn game-btn-blue mt-4 inline-flex items-center gap-2",children:[e.jsx(ge,{size:16}),"Post First Quest"]})]}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:xe.map(s=>{const u=c?J[s.id]:null,g=u==="completed"||u==="verified",L=c&&(u==="pending"||u==="assigned"),E=d===s.id,Q=s.assignment_count||0;return e.jsxs("div",{className:`game-panel p-4 flex flex-col gap-3 cursor-pointer hover:border-sky/40 transition-colors ${g?"opacity-50":""}`,onClick:()=>{n&&A==="library"&&Q===0?R(s):v(`/chores/${s.id}`)},children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"text-cream text-lg font-bold leading-relaxed flex-1",children:Y(s.title,m)}),n&&e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("button",{onClick:S=>{S.stopPropagation(),W(s),I(!0)},className:"p-1.5 rounded hover:bg-surface-raised transition-colors text-muted hover:text-sky","aria-label":"Edit quest",children:e.jsx(Me,{size:14})}),e.jsx("button",{onClick:S=>{S.stopPropagation(),t(s)},className:"p-1.5 rounded hover:bg-surface-raised transition-colors text-muted hover:text-crimson","aria-label":"Delete quest",children:e.jsx(Ie,{size:14})})]}),g&&e.jsx(ye,{size:18,className:"text-emerald flex-shrink-0"})]}),s.description&&e.jsx("p",{className:"text-muted text-sm line-clamp-2",children:re(s.title,s.description,m)}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2 mt-auto",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gold font-bold text-sm",children:[e.jsx("span",{className:"text-lg",children:"â˜…"}),s.points," XP"]}),e.jsx(Ge,{level:s.difficulty||1})]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[e.jsx(Je,{category:s.category}),e.jsx(es,{recurrence:s.recurrence,customDays:s.custom_days}),s.requires_photo&&e.jsxs("span",{className:"flex items-center gap-1 text-muted text-xs",children:[e.jsx(V,{size:12}),"Photo"]}),n&&Q>0&&e.jsxs("span",{className:"flex items-center gap-1 text-emerald text-xs font-medium",children:[e.jsx(ee,{size:12}),Q," ",Q===1?"hero":"heroes"]}),n&&Q===0&&e.jsx("span",{className:"text-muted/60 text-xs italic",children:"Not assigned"})]}),n&&A==="library"&&Q===0&&e.jsxs("button",{onClick:S=>{S.stopPropagation(),R(s)},className:"game-btn game-btn-gold w-full flex items-center justify-center gap-2 !text-xs !py-1.5",children:[e.jsx(ee,{size:14}),"Assign to Heroes"]}),n&&Q>0&&e.jsxs("button",{onClick:S=>{S.stopPropagation(),R(s)},className:"game-btn game-btn-purple w-full flex items-center justify-center gap-2 !text-xs !py-1.5",children:[e.jsx(ee,{size:14}),"Manage Assignments"]}),L&&e.jsxs("div",{className:"mt-1 space-y-2",onClick:S=>S.stopPropagation(),children:[s.requires_photo&&e.jsxs("label",{className:"inline-flex items-center gap-1.5 text-xs text-muted cursor-pointer hover:text-cream transition-colors bg-surface-raised px-3 py-1.5 rounded-lg border border-border",children:[e.jsx(V,{size:14}),e.jsx("span",{children:f[s.id]?f[s.id].name:"Attach proof photo"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:S=>X(ke=>{var he;return{...ke,[s.id]:((he=S.target.files)==null?void 0:he[0])||null}})})]}),e.jsx("button",{onClick:()=>we(s),disabled:E||s.requires_photo&&!f[s.id],className:`game-btn game-btn-blue w-full flex items-center justify-center gap-2 ${E?"opacity-60 cursor-wait":""} ${s.requires_photo&&!f[s.id]?"opacity-40 cursor-not-allowed":""}`,children:E?e.jsxs(e.Fragment,{children:[e.jsx(Ee,{size:14,className:"animate-spin"}),"Completing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{size:14}),"Complete Quest"]})})]})]},s.id)})}),e.jsx(He,{isOpen:se,onClose:()=>{I(!1),W(null)},onCreated:K,categories:y,editingChore:te}),e.jsx(Xe,{isOpen:!!Z,onClose:()=>R(null),onAssigned:()=>{K()},chore:Z,kids:T}),e.jsx(ne,{isOpen:!!z,onClose:()=>t(null),title:"Abandon Quest?",actions:[{label:"Keep Quest",onClick:()=>t(null),className:"game-btn game-btn-blue"},{label:a?"Removing...":"Remove Quest",onClick:Se,className:"game-btn game-btn-red",disabled:a}],children:e.jsxs("p",{className:"text-muted",children:["Are you sure you want to remove the quest"," ",e.jsxs("span",{className:"text-cream text-lg font-bold",children:['"',Y((z==null?void 0:z.title)||"",m),'"']}),"? This action cannot be undone. All associated records will be archived."]})})]})}export{vs as default};
