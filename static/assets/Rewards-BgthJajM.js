import{u as J,r as n,b as w,j as e,d as te,G as ae,h as ue,e as H,a as pe,i as he}from"./index-DNZbfclw.js";import{M as Z}from"./Modal-9JikIi0L.js";import{P as Q,E as ge,C as U,S as V,L as fe,a as be}from"./shopping-bag-sTcQ1ddf.js";import{C as je}from"./clock-GwqV94wP.js";import{S as F}from"./star-Dwc7CGDk.js";import{P as ee}from"./plus-CRo4NV07.js";import{C as se}from"./check-B4tMszzo.js";import{T as ie}from"./trash-2-iVzWod5p.js";import{F as ve}from"./flame-C27w4B61.js";import{P as Ne}from"./pencil-Dnr7i0Qg.js";import"./index-DNx_QacM.js";import"./proxy-CTpQfhFp.js";function ye(){const{user:i}=J(),m=(i==null?void 0:i.role)==="kid",[c,C]=n.useState([]),[p,h]=n.useState(!0),[g,v]=n.useState(""),[z,S]=n.useState(null),f=n.useCallback(async()=>{h(!0),v("");try{const l=await w("/api/rewards/redemptions");C(l)}catch(l){v(l.message||"Failed to load inventory")}finally{h(!1)}},[]);n.useEffect(()=>{f()},[f]),n.useEffect(()=>{const l=()=>{f()};return window.addEventListener("ws:message",l),()=>window.removeEventListener("ws:message",l)},[f]);const _=async l=>{S(l.id);try{await w(`/api/rewards/redemptions/${l.id}/fulfill`,{method:"POST"}),await f()}catch(o){v(o.message||"Could not mark as given")}finally{S(null)}},b=c.filter(l=>l.status==="approved"),x=c.filter(l=>l.status==="pending"),P=l=>{var u,a;const o={};for(const d of l){const r=((u=d.user)==null?void 0:u.display_name)||((a=d.user)==null?void 0:a.username)||`Kid #${d.user_id}`;o[r]||(o[r]=[]),o[r].push(d)}return Object.entries(o).sort(([d],[r])=>d.localeCompare(r))};return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Q,{size:28,className:"text-sky"}),e.jsx("h1",{className:"text-cream text-xl font-extrabold leading-relaxed",children:m?"My Inventory":"Reward Inventory"})]}),g&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm text-center",children:g}),p&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(te,{size:32,className:"text-sky animate-spin"})}),!p&&e.jsxs(e.Fragment,{children:[b.length===0&&x.length===0&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx(Q,{size:48,className:"text-muted mx-auto mb-4"}),e.jsx("p",{className:"text-cream text-lg font-bold",children:m?"No loot yet!":"No claimed rewards"}),e.jsx("p",{className:"text-muted text-sm mt-2",children:m?"Complete quests, earn XP, and redeem rewards to fill your inventory.":"When kids redeem rewards, they'll appear here."})]}),m&&(b.length>0||x.length>0)&&e.jsxs("div",{className:"space-y-6",children:[b.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-[11px] font-semibold uppercase tracking-widest mb-3",children:"Ready to collect"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:b.map(l=>e.jsx(K,{redemption:l,status:"approved"},l.id))})]}),x.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-[11px] font-semibold uppercase tracking-widest mb-3",children:"Awaiting approval"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:x.map(l=>e.jsx(K,{redemption:l,status:"pending"},l.id))})]})]}),!m&&(b.length>0||x.length>0)&&e.jsxs("div",{className:"space-y-6",children:[b.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-[11px] font-semibold uppercase tracking-widest mb-3",children:"Waiting to be given out"}),P(b).map(([l,o])=>e.jsxs("div",{className:"mb-5",children:[e.jsx("p",{className:"text-cream text-sm font-bold mb-2",children:l}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:o.map(u=>e.jsx(K,{redemption:u,status:"approved",showFulfill:!0,onFulfill:()=>_(u),fulfilling:z===u.id},u.id))})]},l))]}),x.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-[11px] font-semibold uppercase tracking-widest mb-3",children:"Pending approval"}),P(x).map(([l,o])=>e.jsxs("div",{className:"mb-5",children:[e.jsx("p",{className:"text-cream text-sm font-bold mb-2",children:l}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:o.map(u=>e.jsx(K,{redemption:u,status:"pending"},u.id))})]},l))]})]})]})]})}function K({redemption:i,status:m,showFulfill:c,onFulfill:C,fulfilling:p}){const h=i.reward,g=(h==null?void 0:h.icon)||"ðŸŽ";return e.jsxs("div",{className:`game-panel !border-2 p-4 flex items-center gap-3 ${m==="approved"?"border-emerald/40 bg-emerald/5":"border-border bg-surface-raised/30"}`,children:[e.jsx("div",{className:"text-2xl flex-shrink-0",children:g}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-cream text-sm font-bold truncate",children:(h==null?void 0:h.title)||"Reward"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[m==="approved"?e.jsxs("span",{className:"flex items-center gap-1 text-emerald text-xs",children:[e.jsx(ae,{size:12})," Approved"]}):e.jsxs("span",{className:"flex items-center gap-1 text-muted text-xs",children:[e.jsx(je,{size:12})," Pending"]}),e.jsxs("span",{className:"text-muted text-xs",children:[i.points_spent," XP"]})]}),i.created_at&&e.jsxs("p",{className:"text-muted/60 text-[10px] mt-1",children:["Claimed ",new Date(i.created_at).toLocaleDateString()]})]}),c&&e.jsxs("button",{onClick:C,disabled:p,className:"game-btn game-btn-blue flex items-center gap-1 text-xs !py-1.5 !px-3 flex-shrink-0",title:"Mark as given out",children:[e.jsx(ue,{size:14}),p?"...":"Given"]})]})}function ke(){const{user:i}=J(),m=(i==null?void 0:i.role)==="kid",[c,C]=n.useState([]),[p,h]=n.useState(!0),[g,v]=n.useState(""),[z,S]=n.useState(!1),[f,_]=n.useState(""),[b,x]=n.useState(""),[P,l]=n.useState(""),[o,u]=n.useState(!1),[a,d]=n.useState(!1),[r,y]=n.useState(null),[A,R]=n.useState(""),[$,I]=n.useState(!1),[M,O]=n.useState(""),T=n.useCallback(async()=>{h(!0),v("");try{const t=await w("/api/wishlist");C(t.items||t||[])}catch(t){v(t.message||"Failed to load wishlist")}finally{h(!1)}},[]);n.useEffect(()=>{T()},[T]),n.useEffect(()=>{const t=()=>{T()};return window.addEventListener("ws:message",t),()=>window.removeEventListener("ws:message",t)},[T]);const Y=async()=>{if(f.trim()){u(!0);try{const t={title:f.trim()};b.trim()&&(t.url=b.trim()),P.trim()&&(t.notes=P.trim()),await w("/api/wishlist",{method:"POST",body:t}),_(""),x(""),l(""),S(!1),T()}catch(t){v(t.message||"Failed to add item")}finally{u(!1)}}},L=async t=>{try{await w(`/api/wishlist/${t}`,{method:"DELETE"}),C(j=>j.filter(E=>E.id!==t))}catch(j){v(j.message||"Failed to delete item")}},B=t=>{y(t),R(""),O(""),d(!0)},G=async()=>{const t=parseInt(A,10);if(!t||t<=0){O("Enter a valid point cost");return}I(!0),O("");try{await w(`/api/wishlist/${r.id}/convert`,{method:"POST",body:{point_cost:t}}),d(!1),T()}catch(j){O(j.message||"Conversion failed")}finally{I(!1)}},k={};m||c.forEach(t=>{const j=t.user_display_name||t.username||t.user_id||"Unknown Hero";k[j]||(k[j]=[]),k[j].push(t)});const D=(t,j=!1,E=!1)=>{const X=!!t.converted_to_reward_id;return e.jsxs("div",{className:`game-panel p-4 flex items-start gap-3 ${X?"!border-emerald/40":""}`,children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:X?e.jsx(se,{size:18,className:"text-emerald"}):e.jsx(F,{size:18,className:"text-sky"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-cream text-sm leading-tight",children:t.title}),t.url&&e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-sky text-xs flex items-center gap-1 mt-1 hover:text-sky/80 transition-colors",children:[e.jsx(ge,{size:12}),e.jsx("span",{className:"truncate",children:t.url})]}),t.notes&&e.jsx("p",{className:"text-muted text-xs mt-1",children:t.notes}),X&&e.jsx("span",{className:"inline-block mt-1 text-emerald text-xs font-medium",children:"Converted to Reward"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[E&&!X&&e.jsx("button",{onClick:()=>B(t),className:"game-btn game-btn-purple !py-2 !px-3 !text-[8px]",title:"Convert to Reward",children:e.jsx(ae,{size:14})}),j&&e.jsx("button",{onClick:()=>L(t.id),className:"p-2 rounded hover:bg-crimson/10 text-crimson/60 hover:text-crimson transition-colors",title:"Delete",children:e.jsx(ie,{size:16})})]})]},t.id)};return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{size:28,className:"text-sky"}),e.jsx("h1",{className:"text-cream text-xl font-extrabold leading-relaxed",children:"Wish List"})]}),m&&e.jsxs("button",{onClick:()=>S(!z),className:"game-btn game-btn-blue flex items-center gap-2",children:[e.jsx(ee,{size:14}),"Add Wish"]})]}),g&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm text-center",children:g}),m&&z&&e.jsxs("div",{className:"game-panel p-5 mb-6 space-y-3",children:[e.jsx("h3",{className:"text-cream text-lg font-bold tracking-wide mb-3",children:"New Wish"}),e.jsx("input",{type:"text",value:f,onChange:t=>_(t.target.value),placeholder:"What do you wish for?",className:"field-input"}),e.jsx("input",{type:"url",value:b,onChange:t=>x(t.target.value),placeholder:"Link (optional)",className:"field-input"}),e.jsx("textarea",{value:P,onChange:t=>l(t.target.value),placeholder:"Notes (optional)",rows:2,className:"field-input resize-none"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>S(!1),className:"game-btn game-btn-red",children:"Cancel"}),e.jsx("button",{onClick:Y,disabled:o||!f.trim(),className:"game-btn game-btn-blue",children:o?"Adding...":"Add Wish"})]})]}),p&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(te,{size:32,className:"text-sky animate-spin"})}),!p&&m&&e.jsx("div",{className:"space-y-3",children:c.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(F,{size:48,className:"text-muted mx-auto mb-4"}),e.jsx("p",{className:"text-cream text-lg font-bold",children:"Your wish list is empty"}),e.jsx("p",{className:"text-muted text-sm mt-2",children:"Every hero has dreams. Add your first wish!"})]}):c.map(t=>D(t,!0,!1))}),!p&&!m&&e.jsx("div",{className:"space-y-8",children:Object.keys(k).length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(F,{size:48,className:"text-muted mx-auto mb-4"}),e.jsx("p",{className:"text-cream text-lg font-bold",children:"No wishes yet"}),e.jsx("p",{className:"text-muted text-sm mt-2",children:"Your heroes haven't made any wishes yet. Encourage them to dream!"})]}):Object.entries(k).map(([t,j])=>e.jsxs("div",{children:[e.jsxs("h2",{className:"text-cream text-lg font-bold mb-3 tracking-wide flex items-center gap-2",children:[e.jsx(F,{size:14,className:"text-sky"}),t,"'s Wishes"]}),e.jsx("div",{className:"space-y-3",children:j.map(E=>D(E,!1,!0))})]},t))}),e.jsx(Z,{isOpen:a,onClose:()=>d(!1),title:"Convert to Reward",actions:[{label:"Cancel",onClick:()=>d(!1),className:"game-btn game-btn-red"},{label:$?"Converting...":"Convert",onClick:G,className:"game-btn game-btn-gold",disabled:$}],children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-muted text-sm",children:["Convert"," ",e.jsx("span",{className:"text-cream font-bold",children:r==null?void 0:r.title})," ","into a redeemable reward:"]}),M&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-sm",children:M}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold text-sm font-medium mb-2 tracking-wide",children:"Point Cost (XP)"}),e.jsx("input",{type:"number",min:"1",value:A,onChange:t=>R(t.target.value),placeholder:"e.g. 500",className:"field-input"})]})]})})]})}const we={common:"border-border text-muted",uncommon:"border-sky/40 text-sky",rare:"border-purple/40 text-purple",epic:"border-gold/40 text-gold",legendary:"border-crimson/40 text-crimson"},Ce={common:"bg-surface-raised/30",uncommon:"bg-sky/5",rare:"bg-purple/5",epic:"bg-gold/5",legendary:"bg-crimson/5"},Se={common:"bg-border text-muted",uncommon:"bg-sky/20 text-sky",rare:"bg-purple/20 text-purple",epic:"bg-gold/20 text-gold",legendary:"bg-crimson/20 text-crimson"},ne={head:"Head",hair:"Hair",eyes:"Eyes",mouth:"Mouth",hat:"Hats",accessory:"Gear",face_extra:"Face",outfit_pattern:"Pattern",pet:"Pets"},le=["hat","pet","accessory","hair","eyes","mouth","face_extra","outfit_pattern","head"];function _e(i){switch(i.unlock_method){case"shop":return`${i.unlock_value} XP`;case"xp":return`Earn ${i.unlock_value} XP`;case"streak":return`${i.unlock_value}-day streak`;case"quest_drop":return"Quest drop";default:return"Free"}}function Ee({method:i}){switch(i){case"shop":return e.jsx(U,{size:12});case"xp":return e.jsx(F,{size:12});case"streak":return e.jsx(ve,{size:12});case"quest_drop":return e.jsx(H,{size:12});default:return null}}function ze(){const{user:i,updateUser:m}=J(),c=(i==null?void 0:i.role)==="parent"||(i==null?void 0:i.role)==="admin",[C,p]=n.useState([]),[h,g]=n.useState(!0),[v,z]=n.useState(null),[S,f]=n.useState(""),[_,b]=n.useState("all"),x=n.useCallback(async()=>{try{const a=await w("/api/avatar/items");p(Array.isArray(a)?a:[])}catch{p([])}},[]);n.useEffect(()=>{x().finally(()=>g(!1))},[x]),n.useEffect(()=>{const a=()=>x();return window.addEventListener("ws:message",a),()=>window.removeEventListener("ws:message",a)},[x]);const P=async a=>{z(a.id),f("");try{const d=await w(`/api/avatar/items/${a.id}/purchase`,{method:"POST"});m({points_balance:d.points_balance}),f(`Unlocked ${a.display_name}!`),await x()}catch(d){f(d.message||"Purchase failed")}finally{z(null),setTimeout(()=>f(""),3e3)}},l=C.filter(a=>!a.is_default),o={};for(const a of l)_!=="all"&&a.category!==_||(o[a.category]||(o[a.category]=[]),o[a.category].push(a));const u=(i==null?void 0:i.points_balance)??0;return h?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[e.jsx(H,{size:48,className:"text-purple animate-pulse"}),e.jsx("p",{className:"text-cream text-lg font-bold animate-pulse",children:"Loading avatar items..."})]}):e.jsxs("div",{className:"space-y-4",children:[c?e.jsxs("div",{className:"game-panel p-3 flex items-center gap-2 text-emerald text-sm",children:[e.jsx(se,{size:16}),e.jsx("span",{className:"font-medium",children:"All avatar items are unlocked for parents."})]}):e.jsxs("div",{className:"game-panel p-3 flex items-center justify-between",children:[e.jsx("span",{className:"text-cream text-sm font-medium",children:"Your XP"}),e.jsxs("span",{className:"flex items-center gap-1 text-gold text-sm font-bold",children:[e.jsx(U,{size:14}),u]})]}),S&&e.jsx("div",{className:`p-2 rounded border text-sm ${S.includes("Unlocked")?"border-emerald/40 bg-emerald/10 text-emerald":"border-crimson/40 bg-crimson/10 text-crimson"}`,children:S}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>b("all"),className:`px-3 py-1.5 rounded-lg border text-xs font-medium transition-all ${_==="all"?"border-sky bg-sky/15 text-sky":"border-border text-muted hover:text-cream"}`,children:"All"}),le.map(a=>l.some(r=>r.category===a)?e.jsx("button",{onClick:()=>b(a),className:`px-3 py-1.5 rounded-lg border text-xs font-medium transition-all ${_===a?"border-sky bg-sky/15 text-sky":"border-border text-muted hover:text-cream"}`,children:ne[a]||a},a):null)]}),le.map(a=>{const d=o[a];return!d||d.length===0?null:e.jsxs("div",{children:[e.jsx("h3",{className:"text-cream text-sm font-bold mb-2",children:ne[a]||a}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:d.map(r=>{const y=r.unlocked,A=r.unlock_method==="shop"&&!y&&u>=(r.unlock_value||0),R=v===r.id;return e.jsxs("div",{className:`rounded-lg border p-3 transition-all ${we[r.rarity]} ${Ce[r.rarity]} ${y?"opacity-70":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-1 mb-2",children:[e.jsx("span",{className:"text-cream text-xs font-medium leading-tight",children:r.display_name}),e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full font-medium ${Se[r.rarity]}`,children:r.rarity})]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted text-[11px] mb-2",children:[e.jsx(Ee,{method:r.unlock_method}),_e(r)]}),y?e.jsxs("div",{className:"flex items-center gap-1 text-emerald text-xs font-medium",children:[e.jsx(se,{size:12}),"Owned"]}):r.unlock_method==="shop"?e.jsxs("button",{onClick:()=>P(r),disabled:!A||R,className:`w-full flex items-center justify-center gap-1 px-2 py-1.5 rounded border text-xs font-medium transition-all ${A?"border-gold/40 bg-gold/10 text-gold hover:bg-gold/20":"border-border text-muted cursor-not-allowed opacity-50"}`,children:[R?e.jsx(te,{size:12,className:"animate-spin"}):e.jsx(V,{size:12}),R?"Buying...":`Buy Â· ${r.unlock_value} XP`]}):e.jsxs("div",{className:"flex items-center gap-1 text-muted text-xs",children:[e.jsx(fe,{size:12}),r.unlock_method==="quest_drop"?"Find in quests":r.unlock_method==="xp"?`Earn ${r.unlock_value} total XP`:r.unlock_method==="streak"?`${r.unlock_value}-day streak`:"Locked"]})]},r.id)})})]},a)}),Object.keys(o).length===0&&e.jsxs("div",{className:"text-center py-12 text-muted",children:[e.jsx(H,{size:32,className:"mx-auto mb-3 opacity-40"}),e.jsx("p",{className:"text-sm",children:"No items in this category."})]})]})}const re={title:"",description:"",point_cost:50,icon:"",stock:""},Pe=[{key:"shop",label:"Shop",icon:V},{key:"avatar",label:"Avatar",icon:be},{key:"inventory",label:"Inventory",icon:Q},{key:"wishlist",label:"Wishlist",icon:F}];function We(){pe();const[i,m]=he(),{user:c,updateUser:C}=J(),p=(c==null?void 0:c.role)==="parent"||(c==null?void 0:c.role)==="admin",h=(c==null?void 0:c.role)==="kid",g=i.get("tab")||"shop",v=s=>m(s==="shop"?{}:{tab:s},{replace:!0}),[z,S]=n.useState([]),[f,_]=n.useState(!0),[b,x]=n.useState(""),[P,l]=n.useState(!1),[o,u]=n.useState(null),[a,d]=n.useState({...re}),[r,y]=n.useState(""),[A,R]=n.useState(!1),[$,I]=n.useState(null),[M,O]=n.useState(!1),[T,Y]=n.useState(null),[L,B]=n.useState(""),G=(c==null?void 0:c.points_balance)??0,k=n.useCallback(async()=>{try{x("");const s=await w("/api/rewards");S(Array.isArray(s)?s:s.rewards||s.items||[])}catch(s){x(s.message||"The treasure shop is temporarily closed.")}},[]);if(n.useEffect(()=>{k().finally(()=>_(!1))},[k]),n.useEffect(()=>{const s=()=>{k()};return window.addEventListener("ws:message",s),()=>window.removeEventListener("ws:message",s)},[k]),g==="avatar")return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsx(q,{activeTab:g,setTab:v}),e.jsx(ze,{})]});if(g==="inventory")return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsx(q,{activeTab:g,setTab:v}),e.jsx(ye,{})]});if(g==="wishlist")return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsx(q,{activeTab:g,setTab:v}),e.jsx(ke,{})]});const D=()=>{u(null),d({...re}),y(""),l(!0)},t=s=>{u(s),d({title:s.title||"",description:s.description||"",point_cost:s.point_cost??s.cost??50,icon:s.icon||"",stock:s.stock!=null?String(s.stock):""}),y(""),l(!0)},j=()=>{l(!1),u(null),y("")},E=(s,N)=>{d(W=>({...W,[s]:N}))},X=async()=>{if(!a.title.trim()){y("Every treasure needs a name!");return}if(Number(a.point_cost)<1){y("The cost must be at least 1 XP.");return}R(!0),y("");const s={title:a.title.trim(),description:a.description.trim(),point_cost:Number(a.point_cost),icon:a.icon||void 0};a.stock!==""&&(s.stock=Number(a.stock));try{o?await w(`/api/rewards/${o.id}`,{method:"PUT",body:s}):await w("/api/rewards",{method:"POST",body:s}),j(),await k()}catch(N){y(N.message||"Could not save the treasure.")}finally{R(!1)}},ce=async()=>{if($){O(!0);try{await w(`/api/rewards/${$.id}`,{method:"DELETE"}),I(null),await k()}catch(s){x(s.message||"Failed to remove the treasure.")}finally{O(!1)}}},oe=async s=>{Y(s.id),B("");try{await w(`/api/rewards/${s.id}/redeem`,{method:"POST"});const N=s.point_cost??s.cost??0;C({points_balance:((c==null?void 0:c.points_balance)??0)-N}),B(`You claimed "${s.title}"! Check your inventory, hero!`),await k()}catch(N){B(N.message||"Redemption failed. The shopkeeper is confused.")}finally{Y(null)}},de=s=>G>=(s.point_cost??s.cost??0),me=s=>s.stock!=null&&s.stock<=0;return f?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[e.jsx(V,{size:48,className:"text-sky animate-pulse"}),e.jsx("p",{className:"text-cream text-lg font-bold animate-pulse",children:"The shopkeeper is arranging the treasures..."})]}):e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsx(q,{activeTab:g,setTab:v}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{size:28,className:"text-sky"}),e.jsx("h1",{className:"text-cream text-xl font-extrabold leading-relaxed",children:"Treasure Shop"})]}),p&&e.jsxs("button",{onClick:D,className:"game-btn game-btn-blue flex items-center gap-2",children:[e.jsx(ee,{size:16}),"Add Treasure"]})]}),h&&e.jsx("div",{className:"game-panel p-5",children:e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-gold/20 border-2 border-gold/40 flex items-center justify-center",children:e.jsx(U,{size:28,className:"text-gold"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-muted text-sm",children:"Your XP Balance"}),e.jsxs("p",{className:"text-gold text-xl font-extrabold",children:[G.toLocaleString()," XP"]})]})]})}),b&&e.jsx("div",{className:"p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm text-center",children:b}),L&&e.jsxs("div",{className:`p-3 rounded border-2 text-sm text-center ${L.toLowerCase().includes("fail")||L.toLowerCase().includes("confused")||L.toLowerCase().includes("insufficient")?"border-crimson/40 bg-crimson/10 text-crimson":"border-emerald/40 bg-emerald/10 text-emerald"}`,children:[L," ",!L.toLowerCase().includes("fail")&&!L.toLowerCase().includes("confused")&&!L.toLowerCase().includes("insufficient")&&e.jsx("button",{onClick:()=>v("inventory"),className:"underline font-bold hover:brightness-125 transition-all",children:"View Inventory"})]}),z.length===0?e.jsxs("div",{className:"game-panel p-10 text-center",children:[e.jsx(ae,{size:48,className:"mx-auto text-cream/20 mb-4"}),e.jsx("p",{className:"text-muted text-sm",children:"The treasure shop is empty. No loot to be found... yet!"}),p&&e.jsxs("button",{onClick:D,className:"game-btn game-btn-blue mt-4 inline-flex items-center gap-2",children:[e.jsx(ee,{size:16}),"Stock First Treasure"]})]}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:z.map(s=>{const N=me(s),W=de(s),xe=s.point_cost??s.cost??0;return e.jsxs("div",{className:`game-panel p-5 flex flex-col gap-3 relative ${N?"opacity-60":""}`,children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-sky/10 border border-sky/20 flex items-center justify-center flex-shrink-0",children:s.icon?e.jsx("span",{className:"text-2xl",children:s.icon}):e.jsx(H,{size:22,className:"text-sky"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-cream text-lg font-bold leading-relaxed",children:s.title}),s.description&&e.jsx("p",{className:"text-muted text-sm mt-1 line-clamp-2",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{size:16,className:"text-gold"}),e.jsxs("span",{className:"text-gold text-sm font-bold",children:[xe," XP"]})]}),s.stock!=null&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Q,{size:14,className:N?"text-crimson":"text-muted"}),N?e.jsx("span",{className:"text-crimson text-xs font-bold",children:"Sold Out"}):e.jsxs("span",{className:"text-muted text-xs",children:[s.stock," left"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-auto pt-2",children:[h&&e.jsxs("button",{onClick:()=>oe(s),disabled:!W||N||T===s.id,className:`game-btn game-btn-gold flex-1 flex items-center justify-center gap-2 ${!W||N?"opacity-40 cursor-not-allowed":""} ${T===s.id?"opacity-60 cursor-wait":""}`,children:[e.jsx(U,{size:14}),T===s.id?"Claiming...":W?N?"Sold Out":"Redeem":"Not Enough XP"]}),p&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>t(s),className:"p-2 rounded hover:bg-surface-raised transition-colors text-muted hover:text-sky","aria-label":"Edit reward",children:e.jsx(Ne,{size:16})}),e.jsx("button",{onClick:()=>I(s),className:"p-2 rounded hover:bg-surface-raised transition-colors text-muted hover:text-crimson","aria-label":"Delete reward",children:e.jsx(ie,{size:16})})]})]})]},s.id)})}),e.jsx(Z,{isOpen:P,onClose:j,title:o?"Edit Treasure":"New Treasure",actions:[{label:"Cancel",onClick:j,className:"game-btn game-btn-blue"},{label:A?"Saving...":o?"Update Treasure":"Add Treasure",onClick:X,className:"game-btn game-btn-gold",disabled:A}],children:e.jsxs("div",{className:"space-y-4",children:[r&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-sm",children:r}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Treasure Name"}),e.jsx("input",{type:"text",value:a.title,onChange:s=>E("title",s.target.value),placeholder:"Extra Screen Time",className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:s=>E("description",s.target.value),placeholder:"What does this treasure grant?",rows:3,className:"field-input resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Cost (XP)"}),e.jsx("input",{type:"number",min:1,value:a.point_cost,onChange:s=>E("point_cost",s.target.value),className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Icon (Emoji)"}),e.jsx("input",{type:"text",value:a.icon,onChange:s=>E("icon",s.target.value),placeholder:"e.g. trophy, star, gift",className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Stock (Optional)"}),e.jsx("input",{type:"number",min:0,value:a.stock,onChange:s=>E("stock",s.target.value),placeholder:"Leave empty for unlimited",className:"field-input"}),e.jsx("p",{className:"text-muted text-xs mt-1",children:"Leave empty for unlimited supply."})]})]})}),e.jsx(Z,{isOpen:!!$,onClose:()=>I(null),title:"Remove Treasure?",actions:[{label:"Keep Treasure",onClick:()=>I(null),className:"game-btn game-btn-blue"},{label:M?"Removing...":"Remove Treasure",onClick:ce,className:"game-btn game-btn-red",disabled:M}],children:e.jsxs("p",{className:"text-muted",children:["Are you sure you want to remove"," ",e.jsxs("span",{className:"text-gold font-bold",children:['"',$==null?void 0:$.title,'"']})," ","from the treasure shop? Heroes can no longer redeem this reward."]})})]})}function q({activeTab:i,setTab:m}){return e.jsx("div",{className:"flex gap-1 bg-surface-raised rounded-lg p-1",children:Pe.map(({key:c,label:C,icon:p})=>e.jsxs("button",{onClick:()=>m(c),className:`flex-1 flex items-center justify-center gap-1 sm:gap-2 py-2.5 px-1.5 sm:px-3 rounded-md text-xs sm:text-sm font-semibold transition-all ${i===c?"bg-sky/15 text-sky border border-sky/25":"text-muted hover:text-cream border border-transparent"}`,children:[e.jsx(p,{size:16,className:"shrink-0"}),e.jsx("span",{className:"truncate",children:C})]},c))})}export{We as default};
