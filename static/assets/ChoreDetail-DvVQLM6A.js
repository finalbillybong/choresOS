import{c as R,u as D,a as U,r as d,b as x,j as e,S as B}from"./index-DTGKdyC0.js";import{S as M}from"./scroll-text-CDeWZUKT.js";import{A as k,S as V}from"./shield-D7ob7eJs.js";import{C}from"./circle-x-DA35Y0EK.js";import{R as X}from"./refresh-cw-nAUZC_Dr.js";import{C as Y}from"./camera-CryJzx34.js";import{C as w}from"./circle-check-vT5263Uj.js";import{S as G,C as S}from"./skip-forward-C77oZ1Du.js";import{C as I}from"./clock-tDUiZ1gz.js";import{S as H}from"./star-da6YIFk3.js";const K=["Trivial","Easy","Medium","Hard","Legendary"],W=["text-muted","text-emerald","text-sky","text-purple","text-gold"],J=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],z={cleaning:"bg-sky/20 text-sky border-sky/40",cooking:"bg-gold/20 text-gold border-gold/40",outdoor:"bg-emerald/20 text-emerald border-emerald/40",homework:"bg-purple/20 text-purple border-purple/40",pet_care:"bg-crimson/20 text-crimson border-crimson/40",laundry:"bg-sky/20 text-sky border-sky/40",errands:"bg-gold/20 text-gold border-gold/40",default:"bg-cream/10 text-muted border-border"};function Z({level:r}){return e.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(a=>e.jsx(H,{size:18,className:a<=r?"text-gold fill-gold":"text-cream/20"},a)),e.jsx("span",{className:`ml-2 text-sm ${W[r-1]||"text-muted"}`,children:K[r-1]||"Unknown"})]})}function ee({status:r}){const a={pending:"bg-gold/20 text-gold border-gold/40",completed:"bg-emerald/20 text-emerald border-emerald/40",verified:"bg-sky/20 text-sky border-sky/40",skipped:"bg-cream/10 text-muted border-border",missed:"bg-crimson/20 text-crimson border-crimson/40"};return e.jsx("span",{className:`inline-block px-2 py-0.5 rounded-full text-sm border capitalize ${a[r]||a.pending}`,children:r||"pending"})}function me(){var y,v;const{id:r}=R(),{user:a}=D(),f=U(),T=(a==null?void 0:a.role)==="parent"||(a==null?void 0:a.role)==="admin",_=(a==null?void 0:a.role)==="kid",[t,$]=d.useState(null),[L,O]=d.useState(!0),[j,b]=d.useState(""),[c,o]=d.useState(""),[p,i]=d.useState(""),m=d.useCallback(async()=>{try{b("");const s=await x(`/api/chores/${r}`);$(s)}catch(s){b(s.message||"This quest scroll could not be found.")}finally{O(!1)}},[r]);d.useEffect(()=>{m()},[m]);const P=async()=>{o("complete"),i("");try{await x(`/api/chores/${r}/complete`,{method:"POST"}),i("Quest completed! XP has been awarded to your hero."),await m()}catch(s){i(s.message||"Failed to complete the quest.")}finally{o("")}},Q=async s=>{o("verify"),i("");try{const l=s?`/api/chores/assignments/${s}/verify`:`/api/chores/${r}/verify`;await x(l,{method:"POST"}),i("Quest verified! The hero has been rewarded."),await m()}catch(l){i(l.message||"Verification failed.")}finally{o("")}},q=async s=>{o("uncomplete"),i("");try{const l=s?`/api/chores/assignments/${s}/uncomplete`:`/api/chores/${r}/uncomplete`;await x(l,{method:"POST"}),i("Quest marked as incomplete."),await m()}catch(l){i(l.message||"Could not undo completion.")}finally{o("")}},A=async s=>{o("skip"),i("");try{const l=s?`/api/chores/assignments/${s}/skip`:`/api/chores/${r}/skip`;await x(l,{method:"POST"}),i("Quest skipped for today."),await m()}catch(l){i(l.message||"Could not skip the quest.")}finally{o("")}};if(L)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[e.jsx(M,{size:48,className:"text-sky animate-pulse"}),e.jsx("p",{className:"text-cream text-lg font-bold animate-pulse",children:"Unrolling the quest scroll..."})]});if(j)return e.jsxs("div",{className:"max-w-2xl mx-auto py-10",children:[e.jsxs("button",{onClick:()=>f("/chores"),className:"flex items-center gap-2 text-muted hover:text-cream transition-colors mb-6",children:[e.jsx(k,{size:18}),e.jsx("span",{className:"text-sm",children:"Back to Quest Board"})]}),e.jsxs("div",{className:"game-panel p-10 text-center",children:[e.jsx(C,{size:48,className:"mx-auto text-crimson mb-4"}),e.jsx("p",{className:"text-cream text-xl font-extrabold mb-2",children:"Quest Not Found"}),e.jsx("p",{className:"text-muted text-sm",children:j})]})]});if(!t)return null;const u=typeof t.category=="object"?(y=t.category)==null?void 0:y.name:t.category,E=z[u==null?void 0:u.toLowerCase()]||z.default,N=t.assignments||t.history||[],h=new Date().toISOString().split("T")[0],n=N.find(s=>s.date===h||s.assigned_date===h||s.due_date===h),F=n&&(n.status==="pending"||n.status==="assigned"),g=N.slice(0,10);return e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs("button",{onClick:()=>f("/chores"),className:"flex items-center gap-2 text-muted hover:text-cream transition-colors",children:[e.jsx(k,{size:18}),e.jsx("span",{className:"text-sm",children:"Back to Quest Board"})]}),e.jsxs("div",{className:"game-panel p-6 space-y-5",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(B,{size:28,className:"text-sky flex-shrink-0 mt-1"}),e.jsx("div",{className:"flex-1",children:e.jsx("h1",{className:"text-cream text-xl font-extrabold leading-relaxed",children:t.title})})]}),t.description&&e.jsx("div",{className:"pl-10",children:e.jsx("p",{className:"text-muted text-sm leading-relaxed",children:t.description})}),e.jsx("div",{className:"mx-auto w-full h-[1px] bg-gradient-to-r from-transparent via-border to-transparent"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gold/10 flex items-center justify-center",children:e.jsx("span",{className:"text-gold text-xl",children:"â˜…"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"XP Reward"}),e.jsxs("p",{className:"text-gold text-lg font-bold",children:[t.points," XP"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium mb-1",children:"Difficulty"}),e.jsx(Z,{level:t.difficulty||1})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-surface-raised flex items-center justify-center",children:e.jsx(V,{size:18,className:"text-muted"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Category"}),e.jsx("span",{className:`inline-block px-2 py-0.5 rounded-full text-sm border capitalize ${E}`,children:u||"General"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-surface-raised flex items-center justify-center",children:e.jsx(X,{size:18,className:"text-muted"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Recurrence"}),e.jsxs("p",{className:"text-cream text-sm capitalize",children:[t.recurrence||"Once",t.recurrence==="custom"&&((v=t.custom_days)==null?void 0:v.length)>0&&e.jsxs("span",{className:"text-muted text-xs ml-1",children:["(",t.custom_days.map(s=>J[s]||s).join(", "),")"]})]})]})]})]}),t.requires_photo&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded bg-purple/10 border border-purple/30",children:[e.jsx(Y,{size:16,className:"text-purple"}),e.jsx("span",{className:"text-purple text-xs",children:"Photo proof required upon completion"})]})]}),p&&e.jsx("div",{className:`p-3 rounded border-2 text-sm text-center ${p.toLowerCase().includes("fail")||p.toLowerCase().includes("could not")?"border-crimson/40 bg-crimson/10 text-crimson":"border-emerald/40 bg-emerald/10 text-emerald"}`,children:p}),_&&F&&e.jsx("div",{className:"game-panel p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-cream text-lg font-bold mb-1",children:"Today's Quest"}),e.jsx("p",{className:"text-muted text-xs",children:"This quest awaits your courage, adventurer!"})]}),e.jsxs("button",{onClick:P,disabled:!!c,className:`game-btn game-btn-blue flex items-center gap-2 ${c==="complete"?"opacity-60 cursor-wait":""}`,children:[e.jsx(w,{size:16}),c==="complete"?"Completing...":"Complete Quest"]})]})}),T&&e.jsxs("div",{className:"game-panel p-5",children:[e.jsx("p",{className:"text-cream text-lg font-bold mb-3",children:"Guild Master Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:()=>Q(n==null?void 0:n.id),disabled:!!c,className:`game-btn game-btn-blue flex items-center gap-2 ${c==="verify"?"opacity-60 cursor-wait":""}`,children:[e.jsx(w,{size:14}),c==="verify"?"Verifying...":"Verify"]}),e.jsxs("button",{onClick:()=>q(n==null?void 0:n.id),disabled:!!c,className:`game-btn game-btn-blue flex items-center gap-2 ${c==="uncomplete"?"opacity-60 cursor-wait":""}`,children:[e.jsx(C,{size:14}),c==="uncomplete"?"Undoing...":"Uncomplete"]}),e.jsxs("button",{onClick:()=>A(n==null?void 0:n.id),disabled:!!c,className:`game-btn game-btn-red flex items-center gap-2 ${c==="skip"?"opacity-60 cursor-wait":""}`,children:[e.jsx(G,{size:14}),c==="skip"?"Skipping...":"Skip Today"]})]})]}),g.length>0&&e.jsxs("div",{className:"game-panel p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{size:18,className:"text-sky"}),e.jsx("h2",{className:"text-cream text-lg font-bold",children:"Quest Log"})]}),e.jsx("div",{className:"space-y-2",children:g.map((s,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded bg-surface-raised/30 border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{size:14,className:"text-cream/30"}),e.jsx("span",{className:"text-muted text-xs",children:s.date||s.assigned_date||s.due_date||"N/A"}),s.assigned_to_name&&e.jsxs("span",{className:"text-muted text-xs",children:["- ",s.assigned_to_name]})]}),e.jsx(ee,{status:s.status})]},s.id||l))})]}),g.length===0&&e.jsxs("div",{className:"game-panel p-8 text-center",children:[e.jsx(S,{size:32,className:"mx-auto text-cream/20 mb-3"}),e.jsx("p",{className:"text-muted text-sm",children:"No entries in the quest log yet. Adventures await!"})]})]})}export{me as default};
