import{r as o,j as e,b as R,u as V,c as G,a as U,d as X}from"./index-CgOd0SBs.js";import{t as K}from"./questThemeText-CMgOkVTC.js";import{S as F}from"./star-CPCUo3Hi.js";import{m as z}from"./proxy-Dq3ACGF8.js";import{F as L}from"./flame-CE85vZ1y.js";import{A as $}from"./index-Dkb11lla.js";import{T as H}from"./triangle-alert-DPz37YIC.js";import{S as Q}from"./sword-CodRsXvw.js";import{C as Y}from"./chevron-right-DGAsanHX.js";import{C as Z}from"./camera-BUlMIaZx.js";function J({value:t=0,prefix:n="XP"}){const[a,r]=o.useState(t),s=o.useRef(t),l=o.useRef(null);return o.useEffect(()=>{const u=s.current,f=t;if(s.current=t,u===f){r(f);return}const S=f-u,M=Math.min(Math.abs(S)*15,1500),y=performance.now();function N(T){const A=T-y,v=Math.min(A/M,1),m=1-Math.pow(1-v,3),p=Math.round(u+S*m);r(p),v<1&&(l.current=requestAnimationFrame(N))}return l.current=requestAnimationFrame(N),()=>{l.current&&cancelAnimationFrame(l.current)}},[t]),e.jsxs("div",{className:"inline-flex items-center gap-1.5",children:[e.jsx(F,{size:16,className:"text-gold fill-gold"}),e.jsxs("span",{className:"font-heading text-gold text-sm font-bold tabular-nums",children:[a.toLocaleString()," ",n]})]})}const ee={scale:[1,1.1,.97,1.05,1],rotate:[-1,2,-2,1,0],transition:{duration:1,repeat:1/0,repeatType:"mirror",ease:"easeInOut"}};function te(t){return t>=30?{size:28,className:"text-orange-400 drop-shadow-[0_0_8px_rgba(251,146,60,0.5)]"}:t>=7?{size:22,className:"text-orange-400"}:{size:18,className:"text-orange-400/70"}}function se({streak:t=0,longest:n=0}){const[a,r]=o.useState(!1),s=te(t),l=t>=30;return e.jsxs("div",{className:"relative inline-flex items-center gap-1",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[l?e.jsx(z.div,{animate:ee,className:"flex items-center",children:e.jsx(L,{size:s.size,className:s.className})}):e.jsx(L,{size:s.size,className:s.className}),e.jsx("span",{className:"font-bold text-orange-400 text-sm tabular-nums",children:t}),a&&e.jsxs("div",{className:"absolute bottom-full right-0 mb-2 px-3 py-1.5 bg-surface-raised border border-border rounded-lg text-center whitespace-nowrap z-10 shadow-lg",children:[e.jsxs("p",{className:"text-cream text-xs font-medium",children:[t," day streak"]}),e.jsxs("p",{className:"text-muted text-[10px]",children:["Best: ",n]}),e.jsx("div",{className:"absolute top-full right-3 w-0 h-0 border-l-[5px] border-l-transparent border-r-[5px] border-r-transparent border-t-[5px] border-t-border"})]})]})}const O=["#3b82f6","#10b981","#f59e0b","#a855f7","#ef4444","#60a5fa"],ae=30,_=3;function P(t,n){return Math.random()*(n-t)+t}function ne(){return Array.from({length:ae},(t,n)=>{const a=P(0,Math.PI*2),r=P(200,500),s=P(6,14),l=Math.random()>.5?"circle":"rect";return{id:n,color:O[Math.floor(Math.random()*O.length)],x:Math.cos(a)*r,y:Math.sin(a)*r,rotation:P(0,720),size:s,shape:l}})}function q({onComplete:t}){const[n,a]=o.useState(!0),r=o.useMemo(()=>ne(),[]);return o.useEffect(()=>{const s=setTimeout(()=>{a(!1),t==null||t()},_*1e3);return()=>clearTimeout(s)},[t]),e.jsx($,{children:n&&e.jsx("div",{className:"fixed inset-0 z-[100] pointer-events-none overflow-hidden",children:r.map(s=>e.jsx(z.div,{className:"absolute",style:{left:"50%",top:"40%",width:s.shape==="circle"?s.size:s.size*.7,height:s.size,backgroundColor:s.color,borderRadius:s.shape==="circle"?"50%":"2px"},initial:{x:0,y:0,opacity:1,rotate:0,scale:1},animate:{x:s.x,y:[0,s.y*.4,s.y+300],opacity:[1,1,0],rotate:s.rotation,scale:[1,1.2,.5]},transition:{duration:_,ease:[.25,.46,.45,.94],y:{duration:_,ease:[.22,.61,.36,1]}}},s.id))})})}const I=[{value:1,color:"#ef4444"},{value:5,color:"#f59e0b"},{value:2,color:"#10b981"},{value:10,color:"#a855f7"},{value:3,color:"#3b82f6"},{value:15,color:"#f97316"},{value:1,color:"#ec4899"},{value:25,color:"#f59e0b"},{value:2,color:"#06b6d4"},{value:5,color:"#10b981"},{value:3,color:"#a855f7"},{value:10,color:"#ef4444"}],C=360/I.length;function D(t,n,a,r){const s=(r-90)*Math.PI/180;return{x:t+a*Math.cos(s),y:n+a*Math.sin(s)}}function re(t,n,a,r,s){const l=D(t,n,a,s),u=D(t,n,a,r),f=s-r<=180?"0":"1";return["M",t,n,"L",l.x,l.y,"A",a,a,0,f,0,u.x,u.y,"Z"].join(" ")}function oe({availability:t,onSpinComplete:n}){const[a,r]=o.useState(!1),[s,l]=o.useState(0),[u,f]=o.useState(null),[S,M]=o.useState(!1),[y,N]=o.useState(null),T=o.useRef(!1),A=(t==null?void 0:t.can_spin)??!0,v=(t==null?void 0:t.reason)??null,m=!A,p=o.useCallback(async()=>{if(!(a||m)){r(!0),f(null),N(null);try{const i=await R("/api/spin/spin",{method:"POST"}),c=i.points_won??i.points??i.result??5,x=I.reduce((w,W,B)=>(W.value===c&&w.push(B),w),[]),g=(x.length>0?x[Math.floor(Math.random()*x.length)]:Math.floor(Math.random()*I.length))*C+C/2,b=5+Math.floor(Math.random()*3),k=s+b*360+(360-g);l(k),setTimeout(()=>{f(c),M(!0),r(!1),T.current=!0,n==null||n(c)},3500)}catch(i){N(i.message||"Spin failed!"),r(!1)}}},[a,m,s,n]),j=150,h=150,E=140;return e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[S&&e.jsx(q,{onComplete:()=>M(!1)}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1 z-10",children:e.jsx("div",{className:"w-0 h-0 border-l-[12px] border-l-transparent border-r-[12px] border-r-transparent border-t-[20px] border-t-sky",style:{filter:"drop-shadow(0 2px 6px rgba(59,130,246,0.4))"}})}),e.jsx(z.div,{animate:{rotate:s},transition:{duration:3.5,ease:[.2,.8,.3,1]},className:"w-[260px] h-[260px] sm:w-[300px] sm:h-[300px]",children:e.jsxs("svg",{viewBox:"0 0 300 300",className:"w-full h-full drop-shadow-xl",children:[e.jsx("circle",{cx:j,cy:h,r:E+4,fill:"none",stroke:"#1e293b",strokeWidth:"4"}),I.map((i,c)=>{const x=c*C,d=x+C,g=x+C/2,b=D(j,h,E*.65,g);return e.jsxs("g",{children:[e.jsx("path",{d:re(j,h,E,x,d),fill:i.color,stroke:"#0a0e1a",strokeWidth:"2",opacity:m&&!a?.4:.9}),e.jsx("text",{x:b.x,y:b.y,textAnchor:"middle",dominantBaseline:"central",fill:"white",fontFamily:"Inter, system-ui, sans-serif",fontSize:"12",fontWeight:"800",transform:`rotate(${g}, ${b.x}, ${b.y})`,children:i.value})]},c)}),e.jsx("circle",{cx:j,cy:h,r:22,fill:"#111827",stroke:"#1e293b",strokeWidth:"3"}),e.jsx("circle",{cx:j,cy:h,r:10,fill:"#3b82f6"})]})})]}),u!==null&&e.jsxs("div",{className:"game-panel px-6 py-3 text-center",children:[e.jsx("p",{className:"text-muted text-xs",children:"You won"}),e.jsxs("p",{className:"text-gold text-lg font-bold mt-1",children:[u," XP"]})]}),m&&!a&&v&&e.jsx("p",{className:"text-gold text-sm text-center max-w-xs",children:v}),y&&e.jsx("p",{className:"text-crimson text-sm text-center",children:y}),e.jsx("button",{onClick:p,disabled:a||m,className:`game-btn game-btn-blue text-base px-10 py-3 ${a||m?"opacity-50 cursor-not-allowed":""}`,children:a?"SPINNING...":m?"LOCKED":"SPIN!"})]})}function ie(){const t=new Date,n=t.getDay(),a=n===0?-6:1-n,r=new Date(t);return r.setDate(t.getDate()+a),r.toISOString().slice(0,10)}function le(){return new Date().toISOString().slice(0,10)}function ce(t){switch(t){case"easy":return{text:"Easy",color:"text-emerald bg-emerald/10 border-emerald/20"};case"medium":return{text:"Medium",color:"text-gold bg-gold/10 border-gold/20"};case"hard":return{text:"Hard",color:"text-orange-400 bg-orange-400/10 border-orange-400/20"};case"expert":return{text:"Expert",color:"text-crimson bg-crimson/10 border-crimson/20"};default:return{text:"Easy",color:"text-emerald bg-emerald/10 border-emerald/20"}}}const de={hidden:{opacity:0,y:12},visible:t=>({opacity:1,y:0,transition:{delay:t*.05,type:"spring",stiffness:300,damping:28}})};function Ne(){const{user:t,updateUser:n}=V(),{colorTheme:a}=G(),r=U(),[s,l]=o.useState([]),[u,f]=o.useState([]),[S,M]=o.useState(null),[y,N]=o.useState(!0),[T,A]=o.useState(null),[v,m]=o.useState(!1),p=o.useCallback(async()=>{try{A(null);const i=ie(),c=le(),[x,d,g]=await Promise.all([R("/api/chores"),R(`/api/calendar?week_start=${i}`),R("/api/spin/availability")]);f(x);const k=(d.days&&d.days[c]||[]).filter(w=>w.user_id===(t==null?void 0:t.id));l(k),M(g)}catch(i){A(i.message||"Failed to load quest data")}finally{N(!1)}},[t==null?void 0:t.id]);if(o.useEffect(()=>{p()},[p]),o.useEffect(()=>{const i=()=>{p()};return window.addEventListener("ws:message",i),()=>window.removeEventListener("ws:message",i)},[p]),y)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(X,{className:"animate-spin text-sky",size:28})});const j=s.filter(i=>i.status==="verified"||i.status==="completed").length,h=s.length,E=h>0?Math.round(j/h*100):0;return e.jsxs("div",{className:"max-w-2xl mx-auto space-y-5",children:[e.jsx($,{children:v&&e.jsx(q,{onComplete:()=>m(!1)})}),e.jsxs("div",{className:"game-panel p-5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap mb-4",children:[e.jsx("h1",{className:"font-heading text-cream text-xl font-extrabold",children:"Quest Board"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(J,{value:(t==null?void 0:t.points_balance)??0}),e.jsx(se,{streak:(t==null?void 0:t.current_streak)??0})]})]}),h>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("span",{className:"text-muted text-xs font-medium",children:"Today's Progress"}),e.jsxs("span",{className:"text-cream text-xs font-bold",children:[j,"/",h]})]}),e.jsx("div",{className:"xp-bar",children:e.jsx(z.div,{className:"xp-bar-fill",initial:{width:0},animate:{width:`${E}%`},transition:{duration:.8,ease:[.22,1,.36,1]}})})]})]}),T&&e.jsxs("div",{className:"game-panel p-3 flex items-center gap-2 border-crimson/30 text-crimson text-sm",children:[e.jsx(H,{size:16}),e.jsx("span",{children:T})]}),(()=>{const i=s.filter(c=>c.status==="pending"||c.status==="assigned");return i.length===0&&!y?e.jsxs(z.div,{className:"game-panel p-10 flex flex-col items-center gap-3 text-center",initial:{opacity:0,y:12},animate:{opacity:1,y:0},children:[e.jsx(Q,{size:36,className:"text-muted"}),e.jsx("p",{className:"text-muted text-sm",children:s.length===0?"No quests for today. Take a break!":"All quests complete! Time to spin the wheel!"})]}):e.jsx("div",{className:"space-y-3",children:i.map((c,x)=>{var k,w;const d=c.chore;if(!d)return null;const g=ce(d.difficulty),b=((k=d.category)==null?void 0:k.colour)||"#3b82f6";return e.jsx(z.div,{className:"game-panel p-4 transition-all cursor-pointer hover:border-sky/40",variants:de,initial:"hidden",animate:"visible",custom:x,onClick:()=>r("/chores"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 w-1 h-12 rounded-full flex-shrink-0",style:{backgroundColor:b}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1.5",children:[e.jsx("h3",{className:"text-cream text-sm font-semibold truncate",children:K(d.title,a)}),e.jsx(Y,{size:16,className:"text-muted flex-shrink-0"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-gold text-xs font-semibold",children:[e.jsx(F,{size:12,fill:"currentColor"}),d.points," XP"]}),e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold border ${g.color}`,children:g.text}),((w=d.category)==null?void 0:w.name)&&e.jsx("span",{className:"text-muted text-xs",children:d.category.name}),d.requires_photo&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-muted text-xs",children:[e.jsx(Z,{size:10}),"Photo"]})]})]})]})},c.id)})})})(),e.jsx("div",{className:"pt-2",children:e.jsx(oe,{availability:S,onSpinComplete:()=>{p()}})})]})}export{Ne as default};
