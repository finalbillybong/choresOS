import{a as I,u as D,r as i,b as x,j as e,f as H,d as u}from"./index-CgOd0SBs.js";import{a as R,S as $,A as U}from"./settings-DG7G9fwZ.js";import{S as L}from"./shield-tnr04ZA7.js";function B(){const v=I(),{user:l}=D(),N=(l==null?void 0:l.role)==="parent"||(l==null?void 0:l.role)==="admin",[r,y]=i.useState(null),[S,p]=i.useState(!0),[c,d]=i.useState(""),[g,w]=i.useState(!1),[h,m]=i.useState(""),[_,b]=i.useState([]),[O,k]=i.useState(!1),[A,C]=i.useState({}),P=s=>{const t={};for(const[a,n]of Object.entries(s))n==="true"?t[a]=!0:n==="false"?t[a]=!1:/^\d+$/.test(n)?t[a]=parseInt(n,10):t[a]=n;return t},F=s=>{const t={};for(const[a,n]of Object.entries(s))t[a]=String(n);return t},z=i.useCallback(async()=>{var s,t,a;p(!0),d("");try{const n=await x("/api/admin/settings");y(P(n))}catch(n){(s=n.message)!=null&&s.includes("403")||(t=n.message)!=null&&t.includes("Forbidden")||(a=n.message)!=null&&a.includes("permission")?d("Access denied. Only parents and admins can access settings."):d(n.message||"Failed to load settings")}finally{p(!1)}},[]),T=i.useCallback(async()=>{k(!0);try{const s=await x("/api/stats/achievements/all");b(s.achievements||s||[])}catch{b([])}finally{k(!1)}},[]);i.useEffect(()=>{N?(z(),T()):(p(!1),d("Access denied. Only parents and admins can access settings."))},[N,z,T]);const o=(s,t)=>{y(a=>({...a,[s]:t}))},E=async()=>{w(!0),m("");try{await x("/api/admin/settings",{method:"PUT",body:{settings:F(r)}}),m("Settings saved!")}catch(s){m(s.message||"Failed to save settings")}finally{w(!1),setTimeout(()=>m(""),3e3)}},M=async s=>{C(t=>({...t,[s.id]:!0}));try{await x(`/api/stats/achievements/${s.id}`,{method:"PUT",body:{points_reward:s.points_reward}})}catch{}finally{C(t=>({...t,[s.id]:!1}))}},f=({enabled:s,onChange:t,label:a})=>e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("span",{className:"text-cream text-sm",children:a}),e.jsx("button",{onClick:()=>t(!s),className:`relative inline-flex h-6 w-11 items-center rounded-full border transition-colors flex-shrink-0 ${s?"bg-sky/30 border-sky/40":"bg-navy border-border"}`,"aria-label":`Toggle ${a}`,children:e.jsx("span",{className:`inline-block h-4 w-4 rounded-full transition-transform ${s?"translate-x-6 bg-sky":"translate-x-1 bg-muted/60"}`})})]});return e.jsxs("div",{className:"w-full max-w-2xl mx-auto overflow-hidden",children:[e.jsxs("button",{onClick:()=>v("/profile"),className:"flex items-center gap-1.5 text-muted hover:text-cream transition-colors mb-4 text-sm",children:[e.jsx(H,{size:16}),"Profile"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(R,{size:24,className:"text-cream"}),e.jsx("h1",{className:"text-cream text-lg font-bold",children:"Family Settings"})]}),c&&e.jsxs("div",{className:"game-panel p-8 text-center",children:[e.jsx(L,{size:48,className:"text-crimson/30 mx-auto mb-4"}),e.jsx("p",{className:"text-crimson text-sm",children:c}),e.jsx("p",{className:"text-muted text-xs mt-2",children:"Only guild leaders may alter the realm's configuration."})]}),S&&!c&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(u,{size:32,className:"text-sky animate-spin"})}),!S&&!c&&r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"game-panel p-4",children:[e.jsx("h2",{className:"text-cream text-base font-bold mb-3",children:"Feature Toggles"}),e.jsxs("div",{className:"divide-y divide-border",children:[e.jsx(f,{enabled:r.leaderboard_enabled??!0,onChange:s=>o("leaderboard_enabled",s),label:"Leaderboard"}),e.jsx(f,{enabled:r.spin_wheel_enabled??!0,onChange:s=>o("spin_wheel_enabled",s),label:"Spin Wheel"}),e.jsx(f,{enabled:r.chore_trading_enabled??!0,onChange:s=>o("chore_trading_enabled",s),label:"Chore Trading"})]})]}),e.jsxs("div",{className:"game-panel p-4",children:[e.jsx("h2",{className:"text-cream text-base font-bold mb-3",children:"Daily Reset Hour"}),e.jsx("p",{className:"text-muted text-xs mb-3",children:"Hour of day (0-23) when daily quests reset."}),e.jsx("input",{type:"number",min:0,max:23,value:r.daily_reset_hour??0,onChange:s=>{const t=Math.min(23,Math.max(0,parseInt(s.target.value,10)||0));o("daily_reset_hour",t)},className:"field-input max-w-[120px]"})]}),e.jsxs("button",{onClick:E,disabled:g,className:"game-btn game-btn-blue flex items-center gap-2",children:[g?e.jsx(u,{size:14,className:"animate-spin"}):e.jsx($,{size:14}),g?"Saving...":"Save Settings"]}),h&&e.jsx("p",{className:`text-sm ${h.includes("!")?"text-emerald":"text-crimson"}`,children:h}),e.jsxs("div",{className:"game-panel p-4",children:[e.jsxs("h2",{className:"text-cream text-base font-bold mb-3 flex items-center gap-2",children:[e.jsx(U,{size:16,className:"text-muted"}),"Achievement Point Values"]}),O?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(u,{size:20,className:"text-sky animate-spin"})}):_.length===0?e.jsx("p",{className:"text-muted text-xs",children:"No achievements configured yet."}):e.jsx("div",{className:"space-y-3",children:_.map(s=>e.jsxs("div",{className:"p-3 rounded-lg bg-surface-raised/30 border border-border space-y-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-cream text-sm truncate",children:s.title||s.name}),s.description&&e.jsx("p",{className:"text-muted text-xs",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:0,value:s.points_reward??0,onChange:t=>{const a=parseInt(t.target.value,10)||0;b(n=>n.map(j=>j.id===s.id?{...j,points_reward:a}:j))},className:"field-input !w-20 !p-2 text-center"}),e.jsx("span",{className:"text-muted text-xs",children:"pts"}),e.jsx("button",{onClick:()=>M(s),disabled:A[s.id],className:"game-btn game-btn-blue !py-2 !px-3 ml-auto",title:"Save",children:A[s.id]?e.jsx(u,{size:12,className:"animate-spin"}):e.jsx($,{size:12})})]})]},s.id))})]}),(l==null?void 0:l.role)==="admin"&&e.jsxs("div",{className:"game-panel p-4 text-center",children:[e.jsx("p",{className:"text-muted text-xs mb-3",children:"Need advanced controls?"}),e.jsxs("button",{onClick:()=>v("/admin"),className:"game-btn game-btn-purple",children:[e.jsx(L,{size:14,className:"inline mr-2"}),"Admin Dashboard"]})]})]})]})}export{B as default};
