import{u as G,r as s,b as p,j as e,G as K}from"./index-DTGKdyC0.js";import{M as Y}from"./Modal-DXyo7vZa.js";import{S as i}from"./star-da6YIFk3.js";import{P as B}from"./plus-9LnMCg8o.js";import{L as H}from"./loader-circle-CVHkdU46.js";import{C as X}from"./check-CZhMaMHn.js";import{E as q}from"./external-link-sl3sV_95.js";import{T as J}from"./trash-2-C-gHCGEc.js";import"./index-CkY4i-x6.js";import"./proxy-Cxb_o3gV.js";function ie(){const{user:f}=G(),r=(f==null?void 0:f.role)==="kid",[b,y]=s.useState([]),[g,w]=s.useState(!0),[C,o]=s.useState(""),[k,j]=s.useState(!1),[c,S]=s.useState(""),[N,E]=s.useState(""),[v,z]=s.useState(""),[A,W]=s.useState(!1),[O,d]=s.useState(!1),[m,M]=s.useState(null),[L,P]=s.useState(""),[T,_]=s.useState(!1),[F,x]=s.useState(""),h=s.useCallback(async()=>{w(!0),o("");try{const t=await p("/api/wishlist");y(t.items||t||[])}catch(t){o(t.message||"Failed to load wishlist")}finally{w(!1)}},[]);s.useEffect(()=>{h()},[h]);const R=async()=>{if(c.trim()){W(!0);try{const t={title:c.trim()};N.trim()&&(t.url=N.trim()),v.trim()&&(t.notes=v.trim()),await p("/api/wishlist",{method:"POST",body:t}),S(""),E(""),z(""),j(!1),h()}catch(t){o(t.message||"Failed to add item")}finally{W(!1)}}},U=async t=>{try{await p(`/api/wishlist/${t}`,{method:"DELETE"}),y(a=>a.filter(l=>l.id!==t))}catch(a){o(a.message||"Failed to delete item")}},$=t=>{M(t),P(""),x(""),d(!0)},D=async()=>{const t=parseInt(L,10);if(!t||t<=0){x("Enter a valid point cost");return}_(!0),x("");try{await p(`/api/wishlist/${m.id}/convert`,{method:"POST",body:{point_cost:t}}),d(!1),h()}catch(a){x(a.message||"Conversion failed")}finally{_(!1)}},n={};r||b.forEach(t=>{const a=t.user_display_name||t.username||t.user_id||"Unknown Hero";n[a]||(n[a]=[]),n[a].push(t)});const I=(t,a=!1,l=!1)=>{const u=t.converted||t.reward_id;return e.jsxs("div",{className:`game-panel p-4 flex items-start gap-3 ${u?"!border-emerald/40":""}`,children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:u?e.jsx(X,{size:18,className:"text-emerald"}):e.jsx(i,{size:18,className:"text-sky"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-cream text-sm leading-tight",children:t.title}),t.url&&e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-sky text-xs flex items-center gap-1 mt-1 hover:text-sky/80 transition-colors",children:[e.jsx(q,{size:12}),e.jsx("span",{className:"truncate",children:t.url})]}),t.notes&&e.jsx("p",{className:"text-muted text-xs mt-1",children:t.notes}),u&&e.jsx("span",{className:"inline-block mt-1 text-emerald text-xs font-medium",children:"Converted to Reward"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[l&&!u&&e.jsx("button",{onClick:()=>$(t),className:"game-btn game-btn-purple !py-2 !px-3 !text-[8px]",title:"Convert to Reward",children:e.jsx(K,{size:14})}),a&&e.jsx("button",{onClick:()=>U(t.id),className:"p-2 rounded hover:bg-crimson/10 text-crimson/60 hover:text-crimson transition-colors",title:"Delete",children:e.jsx(J,{size:16})})]})]},t.id)};return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{size:28,className:"text-sky"}),e.jsx("h1",{className:"text-cream text-xl font-extrabold leading-relaxed",children:"Wish List"})]}),r&&e.jsxs("button",{onClick:()=>j(!k),className:"game-btn game-btn-blue flex items-center gap-2",children:[e.jsx(B,{size:14}),"Add Wish"]})]}),C&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm text-center",children:C}),r&&k&&e.jsxs("div",{className:"game-panel p-5 mb-6 space-y-3",children:[e.jsx("h3",{className:"text-cream text-lg font-bold tracking-wide mb-3",children:"New Wish"}),e.jsx("input",{type:"text",value:c,onChange:t=>S(t.target.value),placeholder:"What do you wish for?",className:"field-input"}),e.jsx("input",{type:"url",value:N,onChange:t=>E(t.target.value),placeholder:"Link (optional)",className:"field-input"}),e.jsx("textarea",{value:v,onChange:t=>z(t.target.value),placeholder:"Notes (optional)",rows:2,className:"field-input resize-none"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>j(!1),className:"game-btn game-btn-red",children:"Cancel"}),e.jsx("button",{onClick:R,disabled:A||!c.trim(),className:"game-btn game-btn-blue",children:A?"Adding...":"Add Wish"})]})]}),g&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(H,{size:32,className:"text-sky animate-spin"})}),!g&&r&&e.jsx("div",{className:"space-y-3",children:b.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(i,{size:48,className:"text-muted mx-auto mb-4"}),e.jsx("p",{className:"text-cream text-lg font-bold",children:"Your wish list is empty"}),e.jsx("p",{className:"text-muted text-sm mt-2",children:"Every hero has dreams. Add your first wish!"})]}):b.map(t=>I(t,!0,!1))}),!g&&!r&&e.jsx("div",{className:"space-y-8",children:Object.keys(n).length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(i,{size:48,className:"text-muted mx-auto mb-4"}),e.jsx("p",{className:"text-cream text-lg font-bold",children:"No wishes yet"}),e.jsx("p",{className:"text-muted text-sm mt-2",children:"Your heroes haven't made any wishes yet. Encourage them to dream!"})]}):Object.entries(n).map(([t,a])=>e.jsxs("div",{children:[e.jsxs("h2",{className:"text-cream text-lg font-bold mb-3 tracking-wide flex items-center gap-2",children:[e.jsx(i,{size:14,className:"text-sky"}),t,"'s Wishes"]}),e.jsx("div",{className:"space-y-3",children:a.map(l=>I(l,!1,!0))})]},t))}),e.jsx(Y,{isOpen:O,onClose:()=>d(!1),title:"Convert to Reward",actions:[{label:"Cancel",onClick:()=>d(!1),className:"game-btn game-btn-red"},{label:T?"Converting...":"Convert",onClick:D,className:"game-btn game-btn-gold",disabled:T}],children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-muted text-sm",children:["Convert"," ",e.jsx("span",{className:"text-cream font-bold",children:m==null?void 0:m.title})," ","into a redeemable reward:"]}),F&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-sm",children:F}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold text-sm font-medium mb-2 tracking-wide",children:"Point Cost (XP)"}),e.jsx("input",{type:"number",min:"1",value:L,onChange:t=>P(t.target.value),placeholder:"e.g. 500",className:"field-input"})]})]})})]})}export{ie as default};
