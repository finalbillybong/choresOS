import{u as v,r as c,b,j as e,U as o,A as h,e as u,S as w}from"./index-DNZbfclw.js";import{S as j}from"./star-Dwc7CGDk.js";import{F as g}from"./flame-C27w4B61.js";function _(n){if(!n)return"";const r=Date.now()-new Date(n).getTime(),t=Math.floor(r/6e4);if(t<1)return"just now";if(t<60)return`${t}m ago`;const a=Math.floor(t/60);return a<24?`${a}h ago`:`${Math.floor(a/24)}d ago`}function S({completed:n,total:r,size:t=72}){const a=(t-8)/2,i=2*Math.PI*a,l=r>0?n/r:0,m=i*(1-l);return e.jsxs("svg",{width:t,height:t,className:"absolute inset-0",children:[e.jsx("circle",{cx:t/2,cy:t/2,r:a,fill:"none",stroke:"currentColor",strokeWidth:"3",className:"text-border/30"}),r>0&&e.jsx("circle",{cx:t/2,cy:t/2,r:a,fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeDasharray:i,strokeDashoffset:m,className:l>=1?"text-emerald":"text-sky",transform:`rotate(-90 ${t/2} ${t/2})`})]})}function E(){const{user:n}=v(),[r,t]=c.useState(null),[a,i]=c.useState(!0),l=c.useCallback(async()=>{try{const s=await b("/api/stats/party");t(s)}catch{t(null)}},[]);if(c.useEffect(()=>{l().finally(()=>i(!1))},[l]),c.useEffect(()=>{const s=()=>l();return window.addEventListener("ws:message",s),()=>window.removeEventListener("ws:message",s)},[l]),a)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[e.jsx(o,{size:48,className:"text-purple animate-pulse"}),e.jsx("p",{className:"text-cream text-lg font-bold animate-pulse",children:"Assembling the party..."})]});if(!r)return e.jsxs("div",{className:"text-center py-20 text-muted",children:[e.jsx(o,{size:48,className:"mx-auto mb-3 opacity-40"}),e.jsx("p",{className:"text-sm",children:"Could not load party data."})]});const{members:m,activity:d,family_streak:x,family_total_xp:N}=r,y=m.filter(s=>s.role==="kid"),p=m.filter(s=>s.role!=="kid");return e.jsxs("div",{className:"max-w-2xl mx-auto space-y-4",children:[e.jsxs("div",{className:"game-panel p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h1",{className:"font-heading text-cream text-lg font-extrabold flex items-center gap-2",children:[e.jsx(o,{size:20,className:"text-purple"}),"The Party"]}),e.jsxs("div",{className:"flex items-center gap-1 text-gold text-sm font-bold",children:[e.jsx(j,{size:14,className:"fill-gold"}),N.toLocaleString()," XP"]})]}),x>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 gap-y-1 px-3 py-2 rounded-lg bg-crimson/10 border border-crimson/20",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(g,{size:16,className:"text-crimson flex-shrink-0"}),e.jsxs("span",{className:"text-cream text-sm font-medium",children:["Family Streak: ",x," day",x!==1?"s":""]})]}),e.jsx("span",{className:"text-muted text-xs ml-auto",children:"Everyone completed at least one quest!"})]})]}),e.jsxs("div",{className:"game-panel p-4",children:[e.jsx("h2",{className:"text-cream text-sm font-bold mb-3",children:"Heroes"}),e.jsx("div",{className:"flex flex-wrap justify-center gap-4",children:y.map(s=>e.jsxs("div",{className:"flex flex-col items-center gap-2 min-w-[80px]",children:[e.jsxs("div",{className:"relative",style:{width:72,height:72},children:[e.jsx(S,{completed:s.today_completed||0,total:s.today_total||0,size:72}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(h,{config:s.avatar_config,size:"md",name:s.display_name})})]}),e.jsx("span",{className:"text-cream text-sm font-medium text-center leading-tight",children:s.display_name}),e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gold text-xs font-bold",children:[e.jsx(j,{size:10,className:"fill-gold"}),s.points_balance," XP"]}),e.jsxs("span",{className:"text-muted text-[11px]",children:[s.today_completed||0,"/",s.today_total||0," today"]}),s.current_streak>0&&e.jsxs("span",{className:"flex items-center gap-0.5 text-crimson text-[11px]",children:[e.jsx(g,{size:10}),s.current_streak,"d streak"]})]})]},s.id))}),p.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-border/50 my-3"}),e.jsx("div",{className:"flex flex-wrap justify-center gap-4",children:p.map(s=>e.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[e.jsx(h,{config:s.avatar_config,size:"md",name:s.display_name}),e.jsx("span",{className:"text-cream text-sm font-medium",children:s.display_name}),e.jsx("span",{className:"text-muted text-[11px] capitalize",children:s.role})]},s.id))})]})]}),e.jsxs("div",{className:"game-panel p-4",children:[e.jsxs("h2",{className:"text-cream text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(u,{size:14,className:"text-gold"}),"Recent Activity"]}),d.length===0?e.jsx("p",{className:"text-muted text-sm text-center py-6",children:"No activity yet. Complete some quests!"}):e.jsx("div",{className:"space-y-2",children:d.map((s,f)=>e.jsxs("div",{className:"flex items-start gap-3 px-3 py-2.5 rounded-lg border border-border/50 bg-surface-raised/20",children:[e.jsx("div",{className:"mt-0.5 flex-shrink-0",children:s.type==="avatar_drop"?e.jsx(u,{size:14,className:"text-purple"}):e.jsx(w,{size:14,className:"text-sky"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-cream text-sm",children:[e.jsx("span",{className:"font-medium",children:s.user_name})," ",s.type==="avatar_drop"?e.jsx("span",{className:"text-purple",children:s.description}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted",children:s.description}),s.xp&&e.jsxs("span",{className:"text-gold font-bold ml-1",children:["+",s.xp," XP"]})]})]}),e.jsx("p",{className:"text-muted/60 text-xs mt-0.5",children:_(s.timestamp)})]})]},f))})]})]})}export{E as default};
