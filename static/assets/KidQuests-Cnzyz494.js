import{g as R,a as V,c as K,r as i,b as p,j as e,d as h,A as O,S as X}from"./index-CgOd0SBs.js";import{t as B,a as Q}from"./questThemeText-CMgOkVTC.js";import{C as k}from"./circle-x-qVyTTwfd.js";import{S as w}from"./star-CPCUo3Hi.js";import{F as G}from"./flame-CE85vZ1y.js";import{S as I}from"./skip-forward-Z6VqFT9q.js";import{C as f}from"./circle-check-BvVmTZtO.js";import{C}from"./clock-CVIC_Bvd.js";import{m as U}from"./proxy-Dq3ACGF8.js";import{C as H}from"./camera-BUlMIaZx.js";const S={pending:{label:"Pending",color:"text-muted",icon:C},completed:{label:"Awaiting Approval",color:"text-gold",icon:C},verified:{label:"Approved",color:"text-emerald",icon:f},skipped:{label:"Skipped",color:"text-muted/50",icon:I}},J={hidden:{opacity:0,y:10},visible:n=>({opacity:1,y:0,transition:{delay:n*.05,type:"spring",stiffness:300,damping:28}})};function ce(){const{kidId:n}=R(),_=V(),{colorTheme:u}=K(),[x,z]=i.useState(null),[$,A]=i.useState(!0),[l,o]=i.useState(""),[j,E]=i.useState({}),r=i.useCallback(async()=>{try{o("");const s=await p(`/api/stats/family/${n}`);z(s)}catch(s){o(s.message||"Failed to load kid data")}finally{A(!1)}},[n]);i.useEffect(()=>{r()},[r]),i.useEffect(()=>{const s=()=>r();return window.addEventListener("ws:message",s),()=>window.removeEventListener("ws:message",s)},[r]);const m=(s,t)=>{E(a=>({...a,[s]:t}))},F=async s=>{const t=`verify-${s}`;m(t,!0);try{await p(`/api/chores/${s}/verify`,{method:"POST"}),await r()}catch(a){o(a.message||"Failed to verify quest")}finally{m(t,!1)}},L=async s=>{const t=`reject-${s}`;m(t,!0);try{await p(`/api/chores/${s}/uncomplete`,{method:"POST"}),await r()}catch(a){o(a.message||"Failed to reject quest")}finally{m(t,!1)}};if($)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(h,{className:"animate-spin text-sky",size:28})});if(l&&!x)return e.jsx("div",{className:"max-w-2xl mx-auto py-6",children:e.jsxs("div",{className:"game-panel p-8 text-center",children:[e.jsx(k,{size:36,className:"mx-auto text-crimson mb-3"}),e.jsx("p",{className:"text-cream text-lg font-extrabold mb-2",children:"Error"}),e.jsx("p",{className:"text-muted text-sm",children:l})]})});if(!x)return null;const{kid:c,assignments:d}=x,P=d.filter(s=>s.status==="completed"||s.status==="verified").length;return e.jsxs("div",{className:"max-w-2xl mx-auto space-y-4",children:[e.jsx("div",{className:"game-panel p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{config:c.avatar_config,size:"md",name:c.display_name}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h1",{className:"font-heading text-cream text-base sm:text-xl font-extrabold truncate",children:[c.display_name,"'s Quests"]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-gold text-xs sm:text-sm font-semibold",children:[e.jsx(w,{size:13,fill:"currentColor"}),c.points_balance.toLocaleString()," XP"]}),c.current_streak>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-orange-400 text-xs sm:text-sm font-semibold",children:[e.jsx(G,{size:13,fill:"currentColor"}),c.current_streak," day streak"]})]}),e.jsxs("p",{className:"text-muted text-xs mt-1",children:[P,"/",d.length," quests done today"]})]})]})}),l&&e.jsx("div",{className:"game-panel p-3 border-crimson/30 text-crimson text-sm",children:l}),d.length===0?e.jsxs("div",{className:"game-panel p-10 text-center",children:[e.jsx(X,{size:40,className:"mx-auto text-muted mb-4"}),e.jsx("p",{className:"text-muted text-sm",children:"No quests assigned for today."})]}):e.jsx("div",{className:"space-y-2.5",children:d.map((s,t)=>{const a=S[s.status]||S.pending,T=a.icon,g=s.status==="completed",y=s.status==="verified",q=`verify-${s.chore_id}`,D=`reject-${s.chore_id}`,N=j[q],v=j[D],b=N||v;return e.jsxs(U.div,{className:`game-panel p-3 sm:p-4 ${y?"opacity-50":""}`,variants:J,initial:"hidden",animate:"visible",custom:t,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1 cursor-pointer",onClick:()=>_(`/chores/${s.chore_id}`),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-cream text-sm font-bold truncate",children:B(s.chore.title,u)}),s.chore.requires_photo&&e.jsx(H,{size:12,className:"text-sky flex-shrink-0"})]}),s.chore.description&&e.jsx("p",{className:"text-muted text-xs line-clamp-1 mb-1.5",children:Q(s.chore.title,s.chore.description,u)}),e.jsxs("div",{className:"flex items-center flex-wrap gap-3",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gold text-xs font-semibold",children:[e.jsx(w,{size:11,fill:"currentColor"}),s.chore.points," XP"]}),s.chore.category&&e.jsx("span",{className:"text-muted text-xs capitalize",children:s.chore.category}),e.jsxs("span",{className:`flex items-center gap-1 text-xs font-medium ${a.color}`,children:[e.jsx(T,{size:12}),a.label]})]})]}),g&&e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{className:"game-btn game-btn-blue !px-3 !py-2",disabled:b,onClick:()=>F(s.chore_id),title:"Approve",children:N?e.jsx(h,{size:14,className:"animate-spin"}):e.jsx(f,{size:16})}),e.jsx("button",{className:"game-btn game-btn-red !px-3 !py-2",disabled:b,onClick:()=>L(s.chore_id),title:"Reject",children:v?e.jsx(h,{size:14,className:"animate-spin"}):e.jsx(k,{size:16})})]}),y&&e.jsx(f,{size:20,className:"text-emerald flex-shrink-0"})]}),s.photo_proof_path&&g&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:`/api/uploads/${s.photo_proof_path}`,alt:"Photo proof",className:"rounded-lg max-h-48 object-cover border border-border"})})]},s.id)})})]})}export{ce as default};
