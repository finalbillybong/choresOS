import{u as Q,a as U,r as a,b as l,j as e,A as G,d as H}from"./index-BrdgRyQB.js";import{M as J}from"./Modal-C5zO3N_b.js";import{L as j}from"./loader-circle-Dj6CXswZ.js";import{U as W}from"./users-DgIGFfKq.js";import{T as Y}from"./triangle-alert-NDUrog8u.js";import{m as b}from"./proxy-gvXsNLCl.js";import{S as Z}from"./star-zvCTsOAE.js";import{F as ee}from"./flame-BPiYS99I.js";import{C as se}from"./camera-DT9mwvrh.js";import{C as te}from"./circle-check-AfdOJZjS.js";import{C as ae}from"./circle-x-uZKc1gLd.js";import{P as ie}from"./plus-1xf3bQm7.js";import"./index-B_q95wpO.js";const ne={hidden:{opacity:0,y:12},visible:y=>({opacity:1,y:0,transition:{delay:y*.06,type:"spring",stiffness:300,damping:28}})},re={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.25}}};function ge(){const{user:y}=Q(),X=U(),[c,F]=a.useState([]),[g,L]=a.useState([]),[O,V]=a.useState(!0),[v,o]=a.useState(null),[N,R]=a.useState({}),[D,m]=a.useState(!1),[u,w]=a.useState(""),[C,S]=a.useState(""),[h,P]=a.useState(""),[_,A]=a.useState(!1),[z,r]=a.useState(""),n=a.useCallback(async()=>{try{o(null);const[s,t]=await Promise.all([l("/api/stats/family"),l("/api/calendar")]);F(s);const i=new Date().toISOString().slice(0,10),x=(t.days&&t.days[i]||[]).filter(p=>p.status==="completed");L(x)}catch(s){o(s.message||"Failed to load family data")}finally{V(!1)}},[]);a.useEffect(()=>{n()},[n]),a.useEffect(()=>{const s=()=>{n()};return window.addEventListener("ws:message",s),()=>window.removeEventListener("ws:message",s)},[n]);const d=(s,t)=>{R(i=>({...i,[s]:t}))},K=async s=>{const t=`verify-${s}`;d(t,!0);try{await l(`/api/chores/${s}/verify`,{method:"POST"}),await n()}catch(i){o(i.message||"Failed to verify chore")}finally{d(t,!1)}},T=async s=>{const t=`reject-${s}`;d(t,!0);try{await l(`/api/chores/${s}/uncomplete`,{method:"POST"}),await n()}catch(i){o(i.message||"Failed to reject chore")}finally{d(t,!1)}},M=async()=>{if(r(""),!u){r("Select a kid");return}const s=parseInt(C,10);if(!s||s<=0){r("Enter a positive XP amount");return}if(!h.trim()){r("Enter a description");return}A(!0);try{await l(`/api/points/${u}/bonus`,{method:"POST",body:{amount:s,description:h.trim()}}),w(""),S(""),P(""),m(!1),await n()}catch(t){r(t.message||"Failed to award bonus XP")}finally{A(!1)}};function I({completed:s,total:t}){const i=t>0?Math.round(s/t*100):0;return e.jsx("div",{className:"xp-bar",children:e.jsx(b.div,{className:"xp-bar-fill",initial:{width:0},animate:{width:`${i}%`},transition:{duration:.6,ease:[.22,1,.36,1]}})})}if(O)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(j,{className:"animate-spin text-sky",size:28})});const q=g.length>0;return e.jsxs("div",{className:"max-w-3xl mx-auto space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h1",{className:"font-heading text-cream text-xl font-extrabold",children:"Family Overview"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-muted text-sm",children:[e.jsx(W,{size:16}),e.jsxs("span",{children:[c.length," members"]})]})]}),v&&e.jsxs("div",{className:"game-panel p-3 flex items-center gap-2 border-crimson/30 text-crimson text-sm",children:[e.jsx(Y,{size:16}),e.jsx("span",{children:v})]}),c.length===0?e.jsx("div",{className:"game-panel p-10 text-center",children:e.jsx("p",{className:"text-muted text-sm",children:"No kids in your family yet."})}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:c.map((s,t)=>e.jsxs(b.div,{className:"game-panel p-4",variants:ne,initial:"hidden",animate:"visible",custom:t,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(G,{config:s.avatar_config,size:"md",name:s.display_name}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-cream text-sm font-semibold truncate",children:s.display_name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-gold text-xs font-semibold",children:[e.jsx(Z,{size:12,fill:"currentColor"}),s.points_balance.toLocaleString()," XP"]}),s.current_streak>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-orange-400 text-xs font-semibold",children:[e.jsx(ee,{size:12,fill:"currentColor"}),s.current_streak]})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-muted",children:"Today"}),e.jsxs("span",{className:"text-cream font-medium",children:[s.today_completed,"/",s.today_total," quests"]})]}),e.jsx(I,{completed:s.today_completed,total:s.today_total})]})]},s.id))}),q&&e.jsxs(b.section,{variants:re,initial:"hidden",animate:"visible",children:[e.jsx("h2",{className:"text-cream text-base font-bold mb-3",children:"Pending Quest Verifications"}),e.jsx("div",{className:"space-y-3",children:g.map(s=>{var B,E,k,$;const t=`verify-${s.chore_id}`,i=`reject-${s.chore_id}`,f=N[t],x=N[i],p=f||x;return e.jsxs("div",{className:"game-panel p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-cream text-sm font-medium truncate",children:((B=s.chore)==null?void 0:B.title)||"Chore"}),e.jsxs("p",{className:"text-muted text-xs mt-0.5",children:["by ",((E=s.user)==null?void 0:E.display_name)||"Kid",((k=s.chore)==null?void 0:k.requires_photo)&&e.jsxs("span",{className:"inline-flex items-center gap-1 ml-2 text-sky",children:[e.jsx(se,{size:10})," Photo"]}),e.jsxs("span",{className:"ml-2 text-gold font-medium",children:["+",($=s.chore)==null?void 0:$.points," XP"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{className:"game-btn game-btn-blue !px-3 !py-2",disabled:p,onClick:()=>K(s.chore_id),title:"Approve",children:f?e.jsx(j,{size:14,className:"animate-spin"}):e.jsx(te,{size:16})}),e.jsx("button",{className:"game-btn game-btn-red !px-3 !py-2",disabled:p,onClick:()=>T(s.chore_id),title:"Reject",children:x?e.jsx(j,{size:14,className:"animate-spin"}):e.jsx(ae,{size:16})})]})]}),s.photo_proof_path&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:`/api/uploads/${s.photo_proof_path}`,alt:"Photo proof",className:"rounded-lg max-h-48 object-cover border border-border"})})]},`chore-${s.id}`)})})]}),e.jsxs("section",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsxs("button",{className:"game-btn game-btn-blue flex items-center gap-2 justify-center flex-1",onClick:()=>X("/chores"),children:[e.jsx(ie,{size:16}),"Create Quest"]}),e.jsxs("button",{className:"game-btn game-btn-purple flex items-center gap-2 justify-center flex-1",onClick:()=>{r(""),m(!0)},children:[e.jsx(H,{size:16}),"Award Bonus XP"]})]}),e.jsx(J,{isOpen:D,onClose:()=>m(!1),title:"Award Bonus XP",actions:[{label:"Cancel",onClick:()=>m(!1),className:"game-btn game-btn-red"},{label:_?"Awarding...":"Award XP",onClick:M,disabled:_,className:"game-btn game-btn-gold"}],children:e.jsxs("div",{className:"space-y-4",children:[z&&e.jsx("div",{className:"p-2 rounded-lg border border-crimson/30 bg-crimson/10 text-crimson text-sm text-center",children:z}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream/80 text-sm font-medium mb-1.5",children:"Select Kid"}),e.jsxs("select",{value:u,onChange:s=>w(s.target.value),className:"field-input",children:[e.jsx("option",{value:"",children:"-- Choose --"}),c.map(s=>e.jsx("option",{value:s.id,children:s.display_name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream/80 text-sm font-medium mb-1.5",children:"XP Amount"}),e.jsx("input",{type:"number",min:"1",value:C,onChange:s=>S(s.target.value),placeholder:"50",className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream/80 text-sm font-medium mb-1.5",children:"Reason"}),e.jsx("input",{type:"text",value:h,onChange:s=>P(s.target.value),placeholder:"Great job helping out!",className:"field-input"})]})]})})]})}export{ge as default};
