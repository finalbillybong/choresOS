import{g as te,u as se,c as ae,a as re,r as d,b as m,j as e,f as L,S as ne}from"./index-Bc2Ug7Bv.js";import{t as ie,a as le}from"./questThemeText-DONF9YgA.js";import{S as oe}from"./scroll-text-DgtYr2lH.js";import{C as E}from"./circle-x-DmxTv1Nn.js";import{S as ce}from"./shield-C3hfMd-_.js";import{R as de}from"./refresh-cw-C_pu3Ag0.js";import{C as me}from"./camera-BEAUe0Qy.js";import{C as P}from"./circle-check-C21P6r_F.js";import{S as xe}from"./skip-forward-hzQao33T.js";import{R as D,C as O}from"./rotate-cw-CvvyBDg4.js";import{C as pe}from"./chevron-right-BSnHZOeU.js";import{T as ue}from"./trash-2-DuCuEvTi.js";import{C as he}from"./clock-qvHsUUHQ.js";import{S as ge}from"./star-QTksdWEx.js";const fe={easy:1,medium:2,hard:3,expert:4},je=["Trivial","Easy","Medium","Hard","Legendary"],be=["text-muted","text-emerald","text-sky","text-purple","text-gold"],ye=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],F={cleaning:"bg-sky/20 text-sky border-sky/40",cooking:"bg-gold/20 text-gold border-gold/40",outdoor:"bg-emerald/20 text-emerald border-emerald/40",homework:"bg-purple/20 text-purple border-purple/40",pet_care:"bg-crimson/20 text-crimson border-crimson/40",laundry:"bg-sky/20 text-sky border-sky/40",errands:"bg-gold/20 text-gold border-gold/40",default:"bg-cream/10 text-muted border-border"};function Ne({level:n}){const i=typeof n=="string"?fe[n]||1:n||1;return e.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(g=>e.jsx(ge,{size:18,className:g<=i?"text-gold fill-gold":"text-cream/20"},g)),e.jsx("span",{className:`ml-2 text-sm ${be[i-1]||"text-muted"}`,children:je[i-1]||"Unknown"})]})}function ve({status:n}){const i={pending:"bg-gold/20 text-gold border-gold/40",completed:"bg-emerald/20 text-emerald border-emerald/40",verified:"bg-sky/20 text-sky border-sky/40",skipped:"bg-cream/10 text-muted border-border",missed:"bg-crimson/20 text-crimson border-crimson/40"};return e.jsx("span",{className:`inline-block px-2 py-0.5 rounded-full text-sm border capitalize ${i[n]||i.pending}`,children:n||"pending"})}function Fe(){var R,_;const{id:n}=te(),{user:i}=se(),{colorTheme:g}=ae(),k=re(),h=(i==null?void 0:i.role)==="parent"||(i==null?void 0:i.role)==="admin",A=(i==null?void 0:i.role)==="kid",[a,Q]=d.useState(null),[U,q]=d.useState(!0),[w,S]=d.useState(""),[l,o]=d.useState(""),[b,s]=d.useState(""),[x,N]=d.useState(null),[f,M]=d.useState([]),[T,B]=d.useState("weekly"),u=d.useCallback(async()=>{if(h)try{const r=(await m("/api/rotations")||[]).find(j=>j.chore_id===parseInt(n));N(r||null)}catch{N(null)}},[n,h]),p=d.useCallback(async()=>{try{S("");const t=await m(`/api/chores/${n}`);Q(t)}catch(t){S(t.message||"This quest scroll could not be found.")}finally{q(!1)}},[n]);d.useEffect(()=>{p(),u(),h&&m("/api/stats/kids").then(t=>M(t||[])).catch(()=>{})},[p,u,h]),d.useEffect(()=>{const t=()=>{p(),u()};return window.addEventListener("ws:message",t),()=>window.removeEventListener("ws:message",t)},[p,u]);const K=async()=>{o("complete"),s("");try{await m(`/api/chores/${n}/complete`,{method:"POST"}),s("Quest completed! XP has been awarded to your hero."),await p()}catch(t){s(t.message||"Failed to complete the quest.")}finally{o("")}},V=async t=>{o("verify"),s("");try{const r=t?`/api/chores/assignments/${t}/verify`:`/api/chores/${n}/verify`;await m(r,{method:"POST"}),s("Quest verified! The hero has been rewarded."),await p()}catch(r){s(r.message||"Verification failed.")}finally{o("")}},Y=async t=>{o("uncomplete"),s("");try{const r=t?`/api/chores/assignments/${t}/uncomplete`:`/api/chores/${n}/uncomplete`;await m(r,{method:"POST"}),s("Quest marked as incomplete."),await p()}catch(r){s(r.message||"Could not undo completion.")}finally{o("")}},I=async t=>{o("skip"),s("");try{const r=t?`/api/chores/assignments/${t}/skip`:`/api/chores/${n}/skip`;await m(r,{method:"POST"}),s("Quest skipped for today."),await p()}catch(r){s(r.message||"Could not skip the quest.")}finally{o("")}},X=async()=>{if(f.length<2){s("Need at least 2 kids for a rotation.");return}o("rotation");try{await m("/api/rotations",{method:"POST",body:{chore_id:parseInt(n),kid_ids:f.map(t=>t.id),cadence:T}}),await u(),s("Rotation created.")}catch(t){s(t.message||"Could not create rotation.")}finally{o("")}},G=async()=>{if(x){o("rotation");try{await m(`/api/rotations/${x.id}/advance`,{method:"POST"}),await u(),s("Rotation advanced to next kid.")}catch(t){s(t.message||"Could not advance rotation.")}finally{o("")}}},W=async t=>{if(x){o("rotation");try{await m(`/api/rotations/${x.id}`,{method:"PUT",body:{cadence:t}}),await u(),s(`Cadence updated to ${t}.`)}catch(r){s(r.message||"Could not update cadence.")}finally{o("")}}},H=async()=>{if(x){o("rotation");try{await m(`/api/rotations/${x.id}`,{method:"DELETE"}),N(null),s("Rotation removed.")}catch(t){s(t.message||"Could not delete rotation.")}finally{o("")}}};if(U)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[e.jsx(oe,{size:48,className:"text-sky animate-pulse"}),e.jsx("p",{className:"text-cream text-lg font-bold animate-pulse",children:"Unrolling the quest scroll..."})]});if(w)return e.jsxs("div",{className:"max-w-2xl mx-auto py-10",children:[e.jsxs("button",{onClick:()=>k("/chores"),className:"flex items-center gap-2 text-muted hover:text-cream transition-colors mb-6",children:[e.jsx(L,{size:18}),e.jsx("span",{className:"text-sm",children:"Back to Quest Board"})]}),e.jsxs("div",{className:"game-panel p-10 text-center",children:[e.jsx(E,{size:48,className:"mx-auto text-crimson mb-4"}),e.jsx("p",{className:"text-cream text-xl font-extrabold mb-2",children:"Quest Not Found"}),e.jsx("p",{className:"text-muted text-sm",children:w})]})]});if(!a)return null;const y=typeof a.category=="object"?(R=a.category)==null?void 0:R.name:a.category,J=F[y==null?void 0:y.toLowerCase()]||F.default,z=a.assignments||a.history||[],v=new Date().toISOString().split("T")[0],c=z.find(t=>t.date===v||t.assigned_date===v||t.due_date===v),Z=c&&(c.status==="pending"||c.status==="assigned"),C=z.slice(0,10);return e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs("button",{onClick:()=>k("/chores"),className:"flex items-center gap-2 text-muted hover:text-cream transition-colors",children:[e.jsx(L,{size:18}),e.jsx("span",{className:"text-sm",children:"Back to Quest Board"})]}),e.jsxs("div",{className:"game-panel p-6 space-y-5",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ne,{size:28,className:"text-sky flex-shrink-0 mt-1"}),e.jsx("div",{className:"flex-1",children:e.jsx("h1",{className:"text-cream text-xl font-extrabold leading-relaxed",children:ie(a.title,g)})})]}),a.description&&e.jsx("div",{className:"pl-10",children:e.jsx("p",{className:"text-muted text-sm leading-relaxed",children:le(a.title,a.description,g)})}),e.jsx("div",{className:"mx-auto w-full h-[1px] bg-gradient-to-r from-transparent via-border to-transparent"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gold/10 flex items-center justify-center",children:e.jsx("span",{className:"text-gold text-xl",children:"â˜…"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"XP Reward"}),e.jsxs("p",{className:"text-gold text-lg font-bold",children:[a.points," XP"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium mb-1",children:"Difficulty"}),e.jsx(Ne,{level:a.difficulty||1})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-surface-raised flex items-center justify-center",children:e.jsx(ce,{size:18,className:"text-muted"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Category"}),e.jsx("span",{className:`inline-block px-2 py-0.5 rounded-full text-sm border capitalize ${J}`,children:y||"General"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-surface-raised flex items-center justify-center",children:e.jsx(de,{size:18,className:"text-muted"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Recurrence"}),e.jsxs("p",{className:"text-cream text-sm capitalize",children:[a.recurrence||"Once",a.recurrence==="custom"&&((_=a.custom_days)==null?void 0:_.length)>0&&e.jsxs("span",{className:"text-muted text-xs ml-1",children:["(",a.custom_days.map(t=>ye[t]||t).join(", "),")"]})]})]})]})]}),a.requires_photo&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded bg-purple/10 border border-purple/30",children:[e.jsx(me,{size:16,className:"text-purple"}),e.jsx("span",{className:"text-purple text-xs",children:"Photo proof required upon completion"})]})]}),b&&e.jsx("div",{className:`p-3 rounded border-2 text-sm text-center ${b.toLowerCase().includes("fail")||b.toLowerCase().includes("could not")?"border-crimson/40 bg-crimson/10 text-crimson":"border-emerald/40 bg-emerald/10 text-emerald"}`,children:b}),A&&Z&&e.jsx("div",{className:"game-panel p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-cream text-lg font-bold mb-1",children:"Today's Quest"}),e.jsx("p",{className:"text-muted text-xs",children:"This quest awaits your courage, adventurer!"})]}),e.jsxs("button",{onClick:K,disabled:!!l,className:`game-btn game-btn-blue flex items-center gap-2 ${l==="complete"?"opacity-60 cursor-wait":""}`,children:[e.jsx(P,{size:16}),l==="complete"?"Completing...":"Complete Quest"]})]})}),h&&e.jsxs("div",{className:"game-panel p-5",children:[e.jsx("p",{className:"text-cream text-lg font-bold mb-3",children:"Guild Master Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:()=>V(c==null?void 0:c.id),disabled:!!l,className:`game-btn game-btn-blue flex items-center gap-2 ${l==="verify"?"opacity-60 cursor-wait":""}`,children:[e.jsx(P,{size:14}),l==="verify"?"Verifying...":"Verify"]}),e.jsxs("button",{onClick:()=>Y(c==null?void 0:c.id),disabled:!!l,className:`game-btn game-btn-blue flex items-center gap-2 ${l==="uncomplete"?"opacity-60 cursor-wait":""}`,children:[e.jsx(E,{size:14}),l==="uncomplete"?"Undoing...":"Uncomplete"]}),e.jsxs("button",{onClick:()=>I(c==null?void 0:c.id),disabled:!!l,className:`game-btn game-btn-red flex items-center gap-2 ${l==="skip"?"opacity-60 cursor-wait":""}`,children:[e.jsx(xe,{size:14}),l==="skip"?"Skipping...":"Skip Today"]})]})]}),h&&a.recurrence&&a.recurrence!=="once"&&e.jsxs("div",{className:"game-panel p-5 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{size:18,className:"text-purple"}),e.jsx("h2",{className:"text-cream text-lg font-bold",children:"Kid Rotation"})]}),x?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-muted",children:"Cadence:"}),e.jsxs("select",{value:x.cadence,onChange:t=>W(t.target.value),disabled:l==="rotation",className:"bg-surface-raised text-cream text-sm rounded-lg border border-border px-2 py-1 focus:outline-none focus:ring-1 focus:ring-purple",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"fortnightly",children:"Fortnightly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(x.kid_ids||[]).map((t,r)=>{const j=f.find(ee=>ee.id===t),$=r===x.current_index;return e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${$?"border-purple bg-purple/20 text-purple":"border-border text-muted"}`,children:[(j==null?void 0:j.display_name)||`Kid #${t}`,$&&" (current)"]},t)})}),e.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[e.jsxs("button",{onClick:G,disabled:l==="rotation",className:"game-btn game-btn-purple flex items-center gap-1.5 !py-1.5 !px-3 !text-[11px]",children:[e.jsx(pe,{size:14}),"Advance"]}),e.jsxs("button",{onClick:H,disabled:l==="rotation",className:"game-btn game-btn-red flex items-center gap-1.5 !py-1.5 !px-3 !text-[11px]",children:[e.jsx(ue,{size:14}),"Remove Rotation"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-muted text-xs",children:"No rotation set. Create one to automatically rotate this quest between kids."}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-muted",children:"Cadence:"}),e.jsxs("select",{value:T,onChange:t=>B(t.target.value),className:"bg-surface-raised text-cream text-sm rounded-lg border border-border px-2 py-1 focus:outline-none focus:ring-1 focus:ring-purple",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"fortnightly",children:"Fortnightly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),e.jsxs("button",{onClick:X,disabled:l==="rotation"||f.length<2,className:"game-btn game-btn-purple flex items-center gap-1.5 !py-1.5 !px-3 !text-[11px]",children:[e.jsx(D,{size:14}),f.length<2?"Need 2+ kids":"Create Rotation"]})]})]}),C.length>0&&e.jsxs("div",{className:"game-panel p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{size:18,className:"text-sky"}),e.jsx("h2",{className:"text-cream text-lg font-bold",children:"Quest Log"})]}),e.jsx("div",{className:"space-y-2",children:C.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded bg-surface-raised/30 border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{size:14,className:"text-cream/30"}),e.jsx("span",{className:"text-muted text-xs",children:t.date||t.assigned_date||t.due_date||"N/A"}),t.assigned_to_name&&e.jsxs("span",{className:"text-muted text-xs",children:["- ",t.assigned_to_name]})]}),e.jsx(ve,{status:t.status})]},t.id||r))})]}),C.length===0&&e.jsxs("div",{className:"game-panel p-8 text-center",children:[e.jsx(O,{size:32,className:"mx-auto text-cream/20 mb-3"}),e.jsx("p",{className:"text-muted text-sm",children:"No entries in the quest log yet. Adventures await!"})]})]})}export{Fe as default};
