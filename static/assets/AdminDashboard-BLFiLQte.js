import{u as P,a as K,r as a,j as e,f as $,U,b,d as k}from"./index-DNZbfclw.js";import{M as T}from"./Modal-9JikIi0L.js";import{S as A}from"./shield-CQhcnMI_.js";import{K as F,T as L,R as M,C as D}from"./ticket-BOMoPLBE.js";import{S as I}from"./scroll-text-C81zc4NU.js";import{E as O,a as R}from"./eye-DoiWvJKV.js";import{P as _}from"./plus-CRo4NV07.js";import{T as E}from"./trash-2-iVzWod5p.js";import{C as V}from"./check-B4tMszzo.js";import{C as B}from"./chevron-left-B915NE6Z.js";import{C as J}from"./chevron-right-DRz-yEG_.js";import"./index-DNx_QacM.js";import"./proxy-CTpQfhFp.js";const q=[{key:"users",label:"Users",icon:U},{key:"api-keys",label:"API Keys",icon:F},{key:"invite-codes",label:"Invite Codes",icon:L},{key:"audit-log",label:"Audit Log",icon:I}];function G(){const[c,x]=a.useState([]),[p,u]=a.useState(!0),[o,n]=a.useState(""),d=a.useCallback(async()=>{u(!0),n("");try{const s=await b("/api/admin/users");x(Array.isArray(s)?s:s.users||[])}catch(s){n(s.message||"Failed to load users")}finally{u(!1)}},[]);a.useEffect(()=>{d()},[d]);const h=async(s,t)=>{try{await b(`/api/admin/users/${s}`,{method:"PUT",body:{role:t}}),x(l=>l.map(y=>y.id===s?{...y,role:t}:y))}catch(l){n(l.message||"Failed to update role")}},m=async s=>{const t=window.prompt(`New password for ${s.display_name||s.username} (min 6 chars):`);if(t){if(t.length<6){n("Password must be at least 6 characters");return}try{await b(`/api/admin/users/${s.id}/reset-password`,{method:"POST",body:{new_password:t}}),n(""),alert(`Password reset for ${s.display_name||s.username}`)}catch(l){n(l.message||"Failed to reset password")}}},f=async s=>{try{await b(`/api/admin/users/${s.id}`,{method:"PUT",body:{is_active:!s.is_active}}),x(t=>t.map(l=>l.id===s.id?{...l,is_active:!l.is_active}:l))}catch(t){n(t.message||"Failed to toggle user status")}};return p?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(k,{size:28,className:"text-sky animate-spin"})}):e.jsxs("div",{children:[o&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm",children:o}),c.length===0?e.jsx("p",{className:"text-muted text-center py-8 text-sm",children:"No heroes in the realm yet."}):e.jsx("div",{className:"space-y-3",children:c.map(s=>e.jsxs("div",{className:"p-3 rounded-lg bg-surface-raised/30 border border-border space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-cream text-sm font-medium truncate",children:s.username}),s.display_name&&e.jsx("p",{className:"text-muted text-xs truncate",children:s.display_name})]}),e.jsx("span",{className:`inline-block px-2 py-0.5 rounded text-xs font-medium flex-shrink-0 ${s.is_active!==!1?"bg-emerald/10 text-emerald border border-emerald/30":"bg-crimson/10 text-crimson border border-crimson/30"}`,children:s.is_active!==!1?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:s.role,onChange:t=>h(s.id,t.target.value),className:"field-input !py-1.5 !text-xs flex-1",children:[e.jsx("option",{value:"kid",children:"kid"}),e.jsx("option",{value:"parent",children:"parent"}),e.jsx("option",{value:"admin",children:"admin"})]}),e.jsxs("button",{onClick:()=>m(s),className:"game-btn game-btn-blue !py-1.5 !px-3 !text-[10px] flex-shrink-0",children:[e.jsx(M,{size:12,className:"inline mr-1"}),"Password"]}),e.jsx("button",{onClick:()=>f(s),className:`game-btn !py-1.5 !px-3 !text-[10px] flex-shrink-0 ${s.is_active!==!1?"game-btn-red":"game-btn-blue"}`,children:s.is_active!==!1?e.jsxs(e.Fragment,{children:[e.jsx(O,{size:12,className:"inline mr-1"}),"Deactivate"]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{size:12,className:"inline mr-1"}),"Activate"]})})]})]},s.id))})]})}function H(){const[c,x]=a.useState([]),[p,u]=a.useState(!0),[o,n]=a.useState(""),[d,h]=a.useState(!1),[m,f]=a.useState(""),[s,t]=a.useState(!1),[l,y]=a.useState(""),[g,j]=a.useState(!1),N=a.useCallback(async()=>{u(!0),n("");try{const i=await b("/api/admin/api-keys");x(Array.isArray(i)?i:i.keys||[])}catch(i){n(i.message||"Failed to load API keys")}finally{u(!1)}},[]);a.useEffect(()=>{N()},[N]);const r=async()=>{if(m.trim()){t(!0);try{const i=await b("/api/admin/api-keys",{method:"POST",body:{name:m.trim()}});y(i.key||i.api_key||i.token||""),N()}catch(i){n(i.message||"Failed to create key"),h(!1)}finally{t(!1)}}},v=async i=>{try{await b(`/api/admin/api-keys/${i}`,{method:"DELETE"}),x(S=>S.filter(z=>z.id!==i))}catch(S){n(S.message||"Failed to delete key")}},C=async i=>{try{await navigator.clipboard.writeText(i),j(!0),setTimeout(()=>j(!1),2e3)}catch{}},w=()=>{h(!1),f(""),y(""),j(!1)};return p?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(k,{size:28,className:"text-sky animate-spin"})}):e.jsxs("div",{children:[o&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm",children:o}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{onClick:()=>h(!0),className:"game-btn game-btn-blue flex items-center gap-2",children:[e.jsx(_,{size:14}),"Create Key"]})}),c.length===0?e.jsx("p",{className:"text-muted text-center py-8 text-sm",children:"No API keys forged yet."}):e.jsx("div",{className:"space-y-3",children:c.map(i=>e.jsxs("div",{className:"p-3 rounded-lg bg-surface-raised/30 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[e.jsx("p",{className:"text-cream text-sm font-medium truncate min-w-0",children:i.name}),e.jsx("button",{onClick:()=>v(i.id),className:"p-1.5 rounded hover:bg-crimson/10 text-crimson/60 hover:text-crimson transition-colors flex-shrink-0",title:"Delete key",children:e.jsx(E,{size:14})})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1",children:[e.jsxs("span",{className:"text-muted text-xs",children:["Prefix: ",e.jsx("span",{className:"text-sky",children:i.prefix||i.key_prefix||"***"})]}),i.scopes&&e.jsxs("span",{className:"text-muted text-xs",children:["Scopes: ",e.jsx("span",{className:"text-purple",children:Array.isArray(i.scopes)?i.scopes.join(", "):i.scopes})]})]})]},i.id))}),e.jsx(T,{isOpen:d,onClose:w,title:l?"Key Created!":"Create API Key",actions:l?[{label:"Done",onClick:w,className:"game-btn game-btn-blue"}]:[{label:"Cancel",onClick:w,className:"game-btn game-btn-red"},{label:s?"Creating...":"Create",onClick:r,className:"game-btn game-btn-blue",disabled:s||!m.trim()}],children:l?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-muted text-sm",children:"Copy this key now. It will not be shown again!"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 bg-navy p-3 rounded border border-sky/30 text-sky text-sm break-all",children:l}),e.jsx("button",{onClick:()=>C(l),className:"flex-shrink-0 p-2 rounded hover:bg-surface-raised transition-colors",title:"Copy",children:g?e.jsx(V,{size:18,className:"text-emerald"}):e.jsx(D,{size:18,className:"text-muted"})})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-2",children:"Key Name"}),e.jsx("input",{type:"text",value:m,onChange:i=>f(i.target.value),placeholder:"e.g. Mobile App",className:"field-input"})]})})]})}function Q(){const[c,x]=a.useState([]),[p,u]=a.useState(!0),[o,n]=a.useState(""),[d,h]=a.useState(!1),[m,f]=a.useState("kid"),[s,t]=a.useState(""),[l,y]=a.useState(!1),g=a.useCallback(async()=>{u(!0),n("");try{const r=await b("/api/admin/invite-codes");x(Array.isArray(r)?r:r.codes||[])}catch(r){n(r.message||"Failed to load invite codes")}finally{u(!1)}},[]);a.useEffect(()=>{g()},[g]);const j=async()=>{y(!0);try{const r={role:m};s&&(r.max_uses=parseInt(s,10)),await b("/api/admin/invite-codes",{method:"POST",body:r}),h(!1),f("kid"),t(""),g()}catch(r){n(r.message||"Failed to create code")}finally{y(!1)}},N=async r=>{try{await b(`/api/admin/invite-codes/${r}`,{method:"DELETE"}),x(v=>v.filter(C=>C.id!==r))}catch(v){n(v.message||"Failed to delete code")}};return p?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(k,{size:28,className:"text-sky animate-spin"})}):e.jsxs("div",{children:[o&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm",children:o}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{onClick:()=>h(!0),className:"game-btn game-btn-blue flex items-center gap-2",children:[e.jsx(_,{size:14}),"Create Code"]})}),c.length===0?e.jsx("p",{className:"text-muted text-center py-8 text-sm",children:"No invite scrolls crafted yet."}):e.jsx("div",{className:"space-y-3",children:c.map(r=>e.jsxs("div",{className:"p-3 rounded-lg bg-surface-raised/30 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[e.jsx("p",{className:"text-cream text-sm font-bold tracking-wider truncate min-w-0",children:r.code}),e.jsx("button",{onClick:()=>N(r.id),className:"p-1.5 rounded hover:bg-crimson/10 text-crimson/60 hover:text-crimson transition-colors flex-shrink-0",title:"Delete code",children:e.jsx(E,{size:14})})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1",children:[e.jsxs("span",{className:"text-muted text-xs",children:["Role: ",e.jsx("span",{className:"text-purple",children:r.role})]}),e.jsxs("span",{className:"text-muted text-xs",children:["Uses:"," ",e.jsxs("span",{className:"text-sky",children:[r.times_used??0,r.max_uses?` / ${r.max_uses}`:" / âˆž"]})]})]})]},r.id))}),e.jsx(T,{isOpen:d,onClose:()=>h(!1),title:"Create Invite Code",actions:[{label:"Cancel",onClick:()=>h(!1),className:"game-btn game-btn-red"},{label:l?"Creating...":"Create",onClick:j,className:"game-btn game-btn-blue",disabled:l}],children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-2",children:"Role"}),e.jsxs("select",{value:m,onChange:r=>f(r.target.value),className:"field-input",children:[e.jsx("option",{value:"kid",children:"kid"}),e.jsx("option",{value:"parent",children:"parent"}),e.jsx("option",{value:"admin",children:"admin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-2",children:"Max Uses (optional)"}),e.jsx("input",{type:"number",min:1,value:s,onChange:r=>t(r.target.value),placeholder:"Unlimited",className:"field-input"})]})]})})]})}function W(){const[c,x]=a.useState([]),[p,u]=a.useState(!0),[o,n]=a.useState(""),[d,h]=a.useState(0),m=50,f=a.useCallback(async()=>{u(!0),n("");try{const t=await b(`/api/admin/audit-log?limit=${m}&offset=${d}`);x(Array.isArray(t)?t:t.entries||t.logs||[])}catch(t){n(t.message||"Failed to load audit log")}finally{u(!1)}},[d]);a.useEffect(()=>{f()},[f]);const s=t=>t?new Date(t).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"--";return p?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(k,{size:28,className:"text-sky animate-spin"})}):e.jsxs("div",{children:[o&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm",children:o}),c.length===0?e.jsx("p",{className:"text-muted text-center py-8 text-sm",children:"The chronicle is empty. No deeds recorded yet."}):e.jsx("div",{className:"space-y-2",children:c.map((t,l)=>e.jsxs("div",{className:"p-3 rounded-lg bg-surface-raised/30 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[e.jsx("span",{className:"text-sky text-xs font-medium",children:t.action}),e.jsx("span",{className:"text-muted text-[10px] flex-shrink-0",children:s(t.created_at)})]}),e.jsxs("p",{className:"text-muted text-xs break-all",children:[t.user_id!=null?`User #${t.user_id}`:"--",t.details&&t.details!=="--"&&e.jsx("span",{className:"ml-2 text-muted/70",children:typeof t.details=="object"?JSON.stringify(t.details):t.details})]})]},t.id||l))}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-border",children:[e.jsxs("button",{onClick:()=>h(Math.max(0,d-m)),disabled:d===0,className:`game-btn game-btn-blue !py-2 !px-3 flex items-center gap-1 ${d===0?"opacity-30 cursor-not-allowed":""}`,children:[e.jsx(B,{size:14}),"Prev"]}),e.jsxs("span",{className:"text-muted text-xs",children:["Showing ",d+1," - ",d+c.length]}),e.jsxs("button",{onClick:()=>h(d+m),disabled:c.length<m,className:`game-btn game-btn-blue !py-2 !px-3 flex items-center gap-1 ${c.length<m?"opacity-30 cursor-not-allowed":""}`,children:["Next",e.jsx(J,{size:14})]})]})]})}function de(){const{user:c}=P(),x=K(),[p,u]=a.useState("users");return(c==null?void 0:c.role)!=="admin"?e.jsxs("div",{className:"max-w-xl mx-auto text-center py-20",children:[e.jsx(A,{size:48,className:"text-crimson/30 mx-auto mb-4"}),e.jsx("h1",{className:"text-cream text-xl font-extrabold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-muted text-sm",children:"Only realm administrators may enter this sanctum."})]}):e.jsxs("div",{className:"w-full max-w-2xl mx-auto overflow-hidden",children:[e.jsxs("button",{onClick:()=>x("/profile"),className:"flex items-center gap-1.5 text-muted hover:text-cream transition-colors mb-4 text-sm",children:[e.jsx($,{size:16}),"Profile"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(A,{size:24,className:"text-sky"}),e.jsx("h1",{className:"text-cream text-lg font-extrabold",children:"Admin Dashboard"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-1 mb-6",children:q.map(o=>{const n=o.icon,d=p===o.key;return e.jsxs("button",{onClick:()=>u(o.key),className:`flex flex-col items-center gap-1 px-1 py-2.5 rounded-lg border transition-colors text-[10px] sm:text-[11px] font-medium overflow-hidden ${d?"bg-sky/10 border-sky/30 text-sky":"border-border text-muted hover:text-cream hover:border-border-light"}`,children:[e.jsx(n,{size:16}),e.jsx("span",{className:"truncate w-full text-center leading-tight",children:o.label})]},o.key)})}),e.jsxs("div",{className:"game-panel p-4",children:[p==="users"&&e.jsx(G,{}),p==="api-keys"&&e.jsx(H,{}),p==="invite-codes"&&e.jsx(Q,{}),p==="audit-log"&&e.jsx(W,{})]})]})}export{de as default};
