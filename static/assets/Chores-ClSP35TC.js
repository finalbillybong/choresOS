import{r as l,b as v,j as e,A as Ce,u as we,c as Se,a as ke,S as se,d as _e}from"./index-BP9jYr5V.js";import{t as Ae,a as qe}from"./questThemeText-D39JdfZL.js";import{M as te}from"./Modal-Ci9GcnEk.js";import{B as Ee,C as Te,a as Pe,F as ze,S as De}from"./search-BUGci1ce.js";import{S as ae}from"./star-CnI-YIpS.js";import{U as V}from"./users-GPRdit3c.js";import{C as B}from"./camera-CXpkZsbZ.js";import{R as $e,a as Fe}from"./rotate-cw-D1TKK-kG.js";import{E as Qe,a as Le}from"./eye-DFYdyoY6.js";import{P as pe}from"./plus-BnQ8NSyB.js";import{S as Re}from"./scroll-text-BsGQBFAZ.js";import{Z as Oe}from"./zap-CwqSjoVx.js";import{P as Me}from"./pencil-Bh30lR-C.js";import{T as Ie}from"./trash-2-DsM5r18q.js";import{C as fe}from"./circle-check-B9j52tI0.js";import"./index-CAOCJhep.js";import"./proxy-DJ61Gw_t.js";const He=[{value:"easy",label:"Easy",level:1},{value:"medium",label:"Medium",level:2},{value:"hard",label:"Hard",level:3},{value:"expert",label:"Expert",level:4}],he="bg-navy-light border-2 border-border text-cream p-2 rounded text-sm focus:border-sky focus:outline-none transition-colors",ge={title:"",description:"",points:10,difficulty:"easy",category_id:""};function Ke({isOpen:r,onClose:u,onCreated:y,categories:n,editingChore:c}){const[x,j]=l.useState({...ge}),[$,w]=l.useState(""),[S,E]=l.useState(!1),[F,Q]=l.useState([]),[T,P]=l.useState(!1);l.useEffect(()=>{r&&(j(c?{title:c.title||"",description:c.description||"",points:c.points||10,difficulty:c.difficulty||"easy",category_id:c.category_id?String(c.category_id):""}:{...ge}),w(""),P(!1))},[r,c]),l.useEffect(()=>{r&&!c&&v("/api/chores/templates").then(a=>Q(Array.isArray(a)?a:[])).catch(()=>Q([]))},[r,c]);const N=(a,g)=>{j(m=>({...m,[a]:g}))},k=a=>{const g=n.find(m=>m.name.toLowerCase()===a.category_name.toLowerCase());j({title:a.title,description:a.description||"",points:a.suggested_points,difficulty:a.difficulty,category_id:g?String(g.id):""}),P(!1)},_=async()=>{if(!x.title.trim()){w("Every quest needs a name, adventurer!");return}if(x.points<1){w("The reward must be at least 1 XP.");return}if(!x.category_id){w("Please select a category for this quest.");return}E(!0),w("");const a={title:x.title.trim(),description:x.description.trim()||null,points:Number(x.points),difficulty:x.difficulty,category_id:Number(x.category_id),recurrence:"once",requires_photo:!1,assigned_user_ids:[]};try{c?await v(`/api/chores/${c.id}`,{method:"PUT",body:a}):await v("/api/chores",{method:"POST",body:a}),y(),u()}catch(g){w(g.message||"The quest scroll could not be saved.")}finally{E(!1)}},L=F.reduce((a,g)=>{const m=g.category_name||"Other";return a[m]||(a[m]=[]),a[m].push(g),a},{});return e.jsx(te,{isOpen:r,onClose:u,title:c?"Edit Quest Scroll":"New Quest Scroll",actions:[{label:"Cancel",onClick:u,className:"game-btn game-btn-blue"},{label:S?"Saving...":c?"Update Quest":"Create Quest",onClick:_,className:"game-btn game-btn-gold",disabled:S}],children:e.jsxs("div",{className:"space-y-4",children:[$&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-sm",children:$}),!c&&e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>P(!T),className:"flex items-center gap-2 text-sky text-sm hover:text-sky/80 transition-colors",children:[e.jsx(Ee,{size:14}),T?"Hide templates":"Choose from Quest Templates"]}),T&&e.jsxs("div",{className:"mt-3 max-h-60 overflow-y-auto space-y-3 border border-border rounded-lg p-3 bg-surface-raised/30",children:[Object.entries(L).map(([a,g])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-bold uppercase tracking-wider mb-1",children:a}),e.jsx("div",{className:"space-y-1",children:g.map(m=>e.jsxs("button",{onClick:()=>k(m),className:"w-full text-left px-3 py-2 rounded-lg hover:bg-surface-raised transition-colors border border-transparent hover:border-sky/30",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-cream text-sm font-medium",children:m.title}),e.jsxs("span",{className:"flex items-center gap-1 text-gold text-xs",children:[e.jsx(ae,{size:10,className:"fill-gold"}),m.suggested_points," XP"]})]}),m.description&&e.jsx("p",{className:"text-muted text-xs line-clamp-1 mt-0.5",children:m.description})]},m.id))})]},a)),F.length===0&&e.jsx("p",{className:"text-muted text-xs text-center py-3",children:"No templates available yet."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Quest Name"}),e.jsx("input",{type:"text",value:x.title,onChange:a=>N("title",a.target.value),placeholder:"Defeat the Dust Bunnies",className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Description"}),e.jsx("textarea",{value:x.description,onChange:a=>N("description",a.target.value),placeholder:"Describe the quest details...",rows:3,className:"field-input resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"XP Reward"}),e.jsx("input",{type:"number",min:1,value:x.points,onChange:a=>N("points",a.target.value),className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Difficulty"}),e.jsx("select",{value:x.difficulty,onChange:a=>N("difficulty",a.target.value),className:`${he} w-full p-3`,children:He.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Category"}),e.jsxs("select",{value:x.category_id,onChange:a=>N("category_id",a.target.value),className:`${he} w-full p-3`,children:[e.jsx("option",{value:"",children:"Select category..."}),n.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]})})}const Ue=[{value:"once",label:"One-time"},{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"custom",label:"Custom Days"}],Be=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"fortnightly",label:"Fortnightly"},{value:"monthly",label:"Monthly"}],We=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],be="bg-navy-light border-2 border-border text-cream p-2 rounded text-sm focus:border-sky focus:outline-none transition-colors";function Xe({isOpen:r,onClose:u,onAssigned:y,chore:n,kids:c}){const[x,j]=l.useState({}),[$,w]=l.useState(null),[S,E]=l.useState(!1),[F,Q]=l.useState("weekly"),[T,P]=l.useState(!1),[N,k]=l.useState(""),[_,L]=l.useState([]),[a,g]=l.useState(!1);l.useEffect(()=>{!r||!n||!c.length||(v(`/api/chores/${n.id}/rules`).then(t=>{const i=Array.isArray(t)?t:[];L(i);const o=i.some(f=>f.is_active);g(o);const d={};for(const f of c){const b=i.find(W=>W.user_id===f.id&&W.is_active);d[f.id]=b?{selected:!0,recurrence:b.recurrence||"daily",custom_days:b.custom_days||[],requires_photo:b.requires_photo||!1}:{selected:!1,recurrence:"daily",custom_days:[],requires_photo:!1}}j(d)}).catch(()=>{const t={};for(const i of c)t[i.id]={selected:!1,recurrence:"daily",custom_days:[],requires_photo:!1};j(t),L([]),g(!1)}),E(!1),Q("weekly"),k(""))},[r,n,c]);const m=Object.entries(x).filter(([,t])=>t.selected),A=m.length,z=a&&A===0,Z=t=>{j(i=>{var o;return{...i,[t]:{...i[t],selected:!((o=i[t])!=null&&o.selected)}}})},I=(t,i,o)=>{j(d=>({...d,[t]:{...d[t],[i]:o}}))},G=(t,i)=>{j(o=>{var f;const d=((f=o[t])==null?void 0:f.custom_days)||[];return{...o,[t]:{...o[t],custom_days:d.includes(i)?d.filter(b=>b!==i):[...d,i]}}})},J=()=>{const i=!m.some(([,o])=>o.requires_photo);j(o=>{const d={...o};for(const[f,b]of Object.entries(d))b.selected&&(d[f]={...b,requires_photo:i});return d})},H=async()=>{P(!0),k("");const i={assignments:m.map(([o,d])=>({user_id:Number(o),recurrence:d.recurrence,custom_days:d.recurrence==="custom"?d.custom_days:null,requires_photo:d.requires_photo}))};S&&A>=2&&(i.rotation={enabled:!0,cadence:F});try{await v(`/api/chores/${n.id}/assign`,{method:"POST",body:i}),y(),u()}catch(o){k(o.message||"Failed to assign quest.")}finally{P(!1)}};if(!n)return null;const U=A>0&&m.every(([,t])=>t.requires_photo),D=A>0&&m.some(([,t])=>t.requires_photo);return e.jsx(te,{isOpen:r,onClose:u,title:"Quest Assignment Scroll",actions:[{label:"Cancel",onClick:u,className:"game-btn game-btn-blue"},{label:T?"Saving...":z?"Unassign All":A===0?"Save":"Assign Quest",onClick:H,className:z?"game-btn game-btn-red":"game-btn game-btn-gold",disabled:T}],children:e.jsxs("div",{className:"space-y-4",children:[N&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-sm",children:N}),e.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface-raised/30",children:[e.jsx("h3",{className:"text-cream font-bold text-base",children:n.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gold text-sm font-bold",children:[e.jsx(ae,{size:12,className:"fill-gold"}),n.points," XP"]}),e.jsx("span",{className:"text-muted text-xs capitalize",children:n.difficulty}),n.category&&e.jsx("span",{className:"text-muted text-xs",children:n.category.name||n.category})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-cream text-sm font-medium mb-2",children:[e.jsx(V,{size:14}),"Select Heroes"]}),e.jsx("div",{className:"space-y-2",children:c.map(t=>{const i=x[t.id];if(!i)return null;const o=i.selected,d=$===t.id&&o;return e.jsxs("div",{className:`rounded-lg border transition-colors ${o?"border-sky/40 bg-sky/5":"border-border"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 p-3",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:()=>Z(t.id),className:"w-4 h-4 accent-sky flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(Ce,{config:t.avatar_config,size:"xs",name:t.display_name||t.username}),e.jsx("span",{className:"text-cream text-sm font-medium truncate",children:t.display_name||t.username})]}),o&&i.requires_photo&&e.jsx(B,{size:14,className:"text-sky flex-shrink-0"}),o&&e.jsx("button",{type:"button",onClick:()=>w(d?null:t.id),className:"p-1 rounded hover:bg-surface-raised text-muted hover:text-cream transition-colors",children:d?e.jsx(Te,{size:16}):e.jsx(Pe,{size:16})})]}),d&&e.jsxs("div",{className:"px-3 pb-3 space-y-3 border-t border-border/50 pt-3 ml-7",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-muted text-xs font-medium mb-1",children:"Recurrence"}),e.jsx("select",{value:i.recurrence,onChange:f=>I(t.id,"recurrence",f.target.value),className:`${be} w-full`,children:Ue.map(f=>e.jsx("option",{value:f.value,children:f.label},f.value))})]}),i.recurrence==="custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-muted text-xs font-medium mb-1",children:"Quest Days"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:We.map((f,b)=>e.jsx("button",{type:"button",onClick:()=>G(t.id,b),className:`px-2 py-1 rounded border text-xs transition-colors ${i.custom_days.includes(b)?"border-sky bg-sky/20 text-sky":"border-border text-muted hover:border-cream/30"}`,children:f},f))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-muted text-xs font-medium flex items-center gap-1.5",children:[e.jsx(B,{size:12}),"Photo Proof"]}),e.jsx("button",{type:"button",onClick:()=>I(t.id,"requires_photo",!i.requires_photo),className:`relative w-10 h-5 rounded-full border-2 transition-colors ${i.requires_photo?"bg-sky/20 border-sky":"bg-navy-light border-border"}`,children:e.jsx("div",{className:`absolute top-0.5 w-3.5 h-3.5 rounded-full transition-all ${i.requires_photo?"left-5 bg-sky":"left-0.5 bg-muted"}`})})]})]})]},t.id)})})]}),z&&e.jsx("div",{className:"p-3 rounded-lg border border-crimson/30 bg-crimson/10 text-crimson text-sm",children:"No heroes selected. Saving will remove all assignments from this quest."}),A>0&&e.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface-raised/20",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-cream text-sm font-medium flex items-center gap-2",children:[e.jsx(B,{size:14}),"Require Photo Proof"]}),e.jsx("button",{type:"button",onClick:J,className:`relative w-12 h-6 rounded-full border-2 transition-colors ${U?"bg-sky/20 border-sky":D?"bg-sky/10 border-sky/50":"bg-navy-light border-border"}`,children:e.jsx("div",{className:`absolute top-0.5 w-4 h-4 rounded-full transition-all ${U?"left-6 bg-sky":D?"left-6 bg-sky/50":"left-0.5 bg-muted"}`})})]}),e.jsx("p",{className:"text-muted text-xs mt-1",children:U?"All heroes must attach a photo when completing this quest.":D?"Some heroes require photo proof. Expand individual settings to adjust.":"Heroes can complete this quest without attaching a photo."})]}),A>=2&&e.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface-raised/20 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-cream text-sm font-medium flex items-center gap-2",children:[e.jsx($e,{size:14}),"Kid Rotation"]}),e.jsx("button",{type:"button",onClick:()=>E(!S),className:`relative w-12 h-6 rounded-full border-2 transition-colors ${S?"bg-purple/20 border-purple":"bg-navy-light border-border"}`,children:e.jsx("div",{className:`absolute top-0.5 w-4 h-4 rounded-full transition-all ${S?"left-6 bg-purple":"left-0.5 bg-muted"}`})})]}),S&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-muted text-xs font-medium mb-1",children:"Rotation Cadence"}),e.jsx("select",{value:F,onChange:t=>Q(t.target.value),className:`${be} w-full`,children:Be.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("p",{className:"text-muted text-xs mt-1",children:"The quest will rotate between the selected heroes on this schedule."})]})]})]})})}const Ye=[{value:"easy",label:"Easy",level:1},{value:"medium",label:"Medium",level:2},{value:"hard",label:"Hard",level:3},{value:"expert",label:"Expert",level:4}],Ve={easy:1,medium:2,hard:3,expert:4},Ze=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],ye="bg-navy-light border-2 border-border text-cream p-2 rounded text-sm focus:border-sky focus:outline-none transition-colors";function Ge({level:r}){const u=typeof r=="string"?Ve[r]||1:r||1;return e.jsx("div",{className:"flex items-center gap-0.5",children:[1,2,3,4].map(y=>e.jsx(ae,{size:14,className:y<=u?"text-gold fill-gold":"text-muted"},y))})}function Je({category:r}){const u=typeof r=="object"?r==null?void 0:r.name:r;return e.jsx("span",{className:"inline-block px-2 py-0.5 rounded-full text-xs border bg-cream/10 text-muted border-border capitalize",children:u||"General"})}function es({recurrence:r,customDays:u}){return!r||r==="once"?null:e.jsxs("div",{className:"flex items-center gap-1 text-muted text-xs",children:[e.jsx(Fe,{size:12}),e.jsx("span",{className:"capitalize",children:r}),r==="custom"&&(u==null?void 0:u.length)>0&&e.jsxs("span",{className:"text-muted",children:["(",u.map(y=>Ze[y]||y).join(", "),")"]})]})}function ss(){const r=new Date,u=r.getDay(),y=u===0?-6:1-u,n=new Date(r);return n.setDate(r.getDate()+y),n.toISOString().slice(0,10)}function ts(){return new Date().toISOString().slice(0,10)}function vs(){var ue;const{user:r}=we(),{colorTheme:u}=Se(),y=ke(),n=(r==null?void 0:r.role)==="parent"||(r==null?void 0:r.role)==="admin",c=(r==null?void 0:r.role)==="kid",[x,j]=l.useState([]),[$,w]=l.useState([]),[S,E]=l.useState([]),[F,Q]=l.useState([]),[T,P]=l.useState(!0),[N,k]=l.useState(""),[_,L]=l.useState("library"),[a,g]=l.useState(""),[m,A]=l.useState(""),[z,Z]=l.useState(""),[I,G]=l.useState(!1),[J,H]=l.useState(!1),[U,D]=l.useState(null),[t,i]=l.useState(null),[o,d]=l.useState(null),[f,b]=l.useState(!1),[W,le]=l.useState(null),[R,re]=l.useState({}),O=l.useCallback(async()=>{try{k("");const s=await v("/api/chores");j(Array.isArray(s)?s:s.chores||s.items||[])}catch(s){k(s.message||"Failed to load quests from the guild board.")}},[]),X=l.useCallback(async()=>{if(c)try{const s=ss(),p=ts(),h=await v(`/api/calendar?week_start=${s}`),q=h.days&&h.days[p]||[];Q(q)}catch{}},[c]),ie=l.useCallback(async()=>{try{const s=await v("/api/chores/categories");w(Array.isArray(s)?s:s.categories||[])}catch{}},[]),ne=l.useCallback(async()=>{if(n)try{const s=await v("/api/stats/family");E(Array.isArray(s)?s:[])}catch{try{const s=await v("/api/admin/users"),p=Array.isArray(s)?s:s.users||[];E(p.filter(h=>h.role==="kid"))}catch{}}},[n]),ee=l.useCallback(async()=>{await Promise.all([O(),X(),ie(),ne()])},[O,X,ie,ne]);l.useEffect(()=>{ee().finally(()=>P(!1))},[ee]),l.useEffect(()=>{const s=()=>{O(),X()};return window.addEventListener("ws:message",s),()=>window.removeEventListener("ws:message",s)},[O,X]);const je=async s=>{const p=s.id;if(!(s.requires_photo&&!R[p])){le(p);try{if(s.requires_photo&&R[p]){const h=new FormData;h.append("file",R[p]),await v(`/api/chores/${p}/complete`,{method:"POST",body:h})}else await v(`/api/chores/${p}/complete`,{method:"POST"});re(h=>{const q={...h};return delete q[p],q}),await ee()}catch(h){k(h.message||"Failed to complete quest")}finally{le(null)}}},Y={};if(c)for(const s of F){const p=s.chore_id||((ue=s.chore)==null?void 0:ue.id);p&&(Y[p]=s.status)}const oe=x,ce=x.filter(s=>(s.assignment_count||0)>0),de=(n?_==="library"?oe:ce:x).filter(s=>{var p,h,q;if(a&&((p=s.category)==null?void 0:p.name)!==a||m&&s.difficulty!==m||z&&!((h=s.title)!=null&&h.toLowerCase().includes(z.toLowerCase()))&&!((q=s.description)!=null&&q.toLowerCase().includes(z.toLowerCase())))return!1;if(c&&!I){const K=Y[s.id];if(K==="completed"||K==="verified")return!1}return!0}),me=c?Object.values(Y).filter(s=>s==="completed"||s==="verified").length:0,ve=async()=>{if(o){b(!0);try{await v(`/api/chores/${o.id}`,{method:"DELETE"}),d(null),await O()}catch(s){k(s.message||"Failed to remove the quest.")}finally{b(!1)}}};return T?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[e.jsx(se,{size:48,className:"text-sky animate-pulse"}),e.jsx("p",{className:"text-cream text-lg font-bold animate-pulse",children:"Loading quests from the guild board..."})]}):e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{size:28,className:"text-sky"}),e.jsx("h1",{className:"text-cream text-xl font-extrabold leading-relaxed",children:n?"Quest Management":"My Quests"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[c&&me>0&&e.jsxs("button",{onClick:()=>G(s=>!s),className:"flex items-center gap-1.5 text-muted hover:text-cream text-sm transition-colors",children:[I?e.jsx(Qe,{size:16}):e.jsx(Le,{size:16}),I?"Hide":"Show"," completed (",me,")"]}),n&&e.jsxs("button",{onClick:()=>{D(null),H(!0)},className:"game-btn game-btn-blue flex items-center gap-2",children:[e.jsx(pe,{size:16}),"Create Quest"]})]})]}),N&&e.jsx("div",{className:"p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm text-center",children:N}),n&&e.jsxs("div",{className:"flex gap-1 bg-surface-raised/50 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>L("library"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-md text-sm font-medium transition-colors ${_==="library"?"bg-sky/20 text-sky border border-sky/30":"text-muted hover:text-cream"}`,children:[e.jsx(Re,{size:16}),"Quest Library",e.jsxs("span",{className:"text-xs opacity-70",children:["(",oe.length,")"]})]}),e.jsxs("button",{onClick:()=>L("active"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-md text-sm font-medium transition-colors ${_==="active"?"bg-emerald/20 text-emerald border border-emerald/30":"text-muted hover:text-cream"}`,children:[e.jsx(Oe,{size:16}),"Active Quests",e.jsxs("span",{className:"text-xs opacity-70",children:["(",ce.length,")"]})]})]}),e.jsx("div",{className:"game-panel p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted",children:[e.jsx(ze,{size:16}),e.jsx("span",{className:"text-sm",children:"Filters:"})]}),e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(De,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted"}),e.jsx("input",{type:"text",placeholder:"Search quests...",value:z,onChange:s=>Z(s.target.value),className:"field-input pl-9 py-2"})]}),e.jsxs("select",{value:a,onChange:s=>g(s.target.value),className:ye,children:[e.jsx("option",{value:"",children:"All Categories"}),$.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]}),e.jsxs("select",{value:m,onChange:s=>A(s.target.value),className:ye,children:[e.jsx("option",{value:"",children:"All Difficulties"}),Ye.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]})}),de.length===0?e.jsxs("div",{className:"game-panel p-10 text-center",children:[e.jsx(se,{size:40,className:"mx-auto text-muted mb-4"}),e.jsx("p",{className:"text-muted text-sm",children:x.length===0?"The quest board is empty. No adventures await... yet!":n&&_==="active"?"No active quests. Assign some from the Quest Library!":"No quests match your search. Try adjusting the filters."}),n&&x.length===0&&e.jsxs("button",{onClick:()=>{D(null),H(!0)},className:"game-btn game-btn-blue mt-4 inline-flex items-center gap-2",children:[e.jsx(pe,{size:16}),"Post First Quest"]})]}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:de.map(s=>{const p=c?Y[s.id]:null,h=p==="completed"||p==="verified",q=c&&(p==="pending"||p==="assigned"),K=W===s.id,M=s.assignment_count||0;return e.jsxs("div",{className:`game-panel p-4 flex flex-col gap-3 cursor-pointer hover:border-sky/40 transition-colors ${h?"opacity-50":""}`,onClick:()=>{n&&_==="library"&&M===0?i(s):y(`/chores/${s.id}`)},children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"text-cream text-lg font-bold leading-relaxed flex-1",children:Ae(s.title,u)}),n&&e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("button",{onClick:C=>{C.stopPropagation(),D(s),H(!0)},className:"p-1.5 rounded hover:bg-surface-raised transition-colors text-muted hover:text-sky","aria-label":"Edit quest",children:e.jsx(Me,{size:14})}),e.jsx("button",{onClick:C=>{C.stopPropagation(),d(s)},className:"p-1.5 rounded hover:bg-surface-raised transition-colors text-muted hover:text-crimson","aria-label":"Delete quest",children:e.jsx(Ie,{size:14})})]}),h&&e.jsx(fe,{size:18,className:"text-emerald flex-shrink-0"})]}),s.description&&e.jsx("p",{className:"text-muted text-sm line-clamp-2",children:qe(s.title,s.description,u)}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2 mt-auto",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gold font-bold text-sm",children:[e.jsx("span",{className:"text-lg",children:"â˜…"}),s.points," XP"]}),e.jsx(Ge,{level:s.difficulty||1})]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[e.jsx(Je,{category:s.category}),e.jsx(es,{recurrence:s.recurrence,customDays:s.custom_days}),s.requires_photo&&e.jsxs("span",{className:"flex items-center gap-1 text-muted text-xs",children:[e.jsx(B,{size:12}),"Photo"]}),n&&M>0&&e.jsxs("span",{className:"flex items-center gap-1 text-emerald text-xs font-medium",children:[e.jsx(V,{size:12}),M," ",M===1?"hero":"heroes"]}),n&&M===0&&e.jsx("span",{className:"text-muted/60 text-xs italic",children:"Not assigned"})]}),n&&_==="library"&&M===0&&e.jsxs("button",{onClick:C=>{C.stopPropagation(),i(s)},className:"game-btn game-btn-gold w-full flex items-center justify-center gap-2 !text-xs !py-1.5",children:[e.jsx(V,{size:14}),"Assign to Heroes"]}),n&&M>0&&e.jsxs("button",{onClick:C=>{C.stopPropagation(),i(s)},className:"game-btn game-btn-purple w-full flex items-center justify-center gap-2 !text-xs !py-1.5",children:[e.jsx(V,{size:14}),"Manage Assignments"]}),q&&e.jsxs("div",{className:"mt-1 space-y-2",onClick:C=>C.stopPropagation(),children:[s.requires_photo&&e.jsxs("label",{className:"inline-flex items-center gap-1.5 text-xs text-muted cursor-pointer hover:text-cream transition-colors bg-surface-raised px-3 py-1.5 rounded-lg border border-border",children:[e.jsx(B,{size:14}),e.jsx("span",{children:R[s.id]?R[s.id].name:"Attach proof photo"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:C=>re(Ne=>{var xe;return{...Ne,[s.id]:((xe=C.target.files)==null?void 0:xe[0])||null}})})]}),e.jsx("button",{onClick:()=>je(s),disabled:K||s.requires_photo&&!R[s.id],className:`game-btn game-btn-blue w-full flex items-center justify-center gap-2 ${K?"opacity-60 cursor-wait":""} ${s.requires_photo&&!R[s.id]?"opacity-40 cursor-not-allowed":""}`,children:K?e.jsxs(e.Fragment,{children:[e.jsx(_e,{size:14,className:"animate-spin"}),"Completing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{size:14}),"Complete Quest"]})})]})]},s.id)})}),e.jsx(Ke,{isOpen:J,onClose:()=>{H(!1),D(null)},onCreated:O,categories:$,editingChore:U}),e.jsx(Xe,{isOpen:!!t,onClose:()=>i(null),onAssigned:()=>{O()},chore:t,kids:S}),e.jsx(te,{isOpen:!!o,onClose:()=>d(null),title:"Abandon Quest?",actions:[{label:"Keep Quest",onClick:()=>d(null),className:"game-btn game-btn-blue"},{label:f?"Removing...":"Remove Quest",onClick:ve,className:"game-btn game-btn-red",disabled:f}],children:e.jsxs("p",{className:"text-muted",children:["Are you sure you want to remove the quest"," ",e.jsxs("span",{className:"text-cream text-lg font-bold",children:['"',o==null?void 0:o.title,'"']}),"? This action cannot be undone. All associated records will be archived."]})})]})}export{vs as default};
